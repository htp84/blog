<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Write something here">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Data-Sci Wannabe</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://htp84.github.io/blog/">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/python-cleaning-excel-files-from-imf/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="https://htp84.github.io/blog/">

            <span id="blog-title">Data-Sci Wannabe</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="#" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="pages/about-me/" class="nav-link">About me</a>
                </li>
<li class="nav-item">
<a href="https://github.com/htp84" class="nav-link">Github</a>
                </li>
<li class="nav-item">
<a href="https://www.linkedin.com/in/henric-sundberg-65260913b/" class="nav-link">LinkedIn</a>
                </li>
<li class="nav-item">
<a href="archive.html" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="categories/index.html" class="nav-link">Tags</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/python-cleaning-excel-files-from-imf/" class="u-url">Python - Cleaning excel files from the International Monetary Fund</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Henric Sundberg
            </span></p>
            <p class="dateline">
            <a href="posts/python-cleaning-excel-files-from-imf/" rel="bookmark">
            <time class="published dt-published" datetime="2019-05-12T00:00:00Z" itemprop="datePublished" title="2019-05-12 00:00">2019-05-12 00:00</time></a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Often when I browse different publically available datasets on for example <a href="https://www.kaggle.com/">Kaggle</a> I find most of them are already <a href="https://garrettgman.github.io/tidying/">tidy</a>. Sure, to use the data for machine learning you must do feature engineering, but most of the data cleaning is already done. I believe that this bad, since most of the data in the "real" world is messy.</p>
<p>So, in this post, I will use <a href="https://pandas.pydata.org/">pandas</a> to clean messy data from the <a href="https://www.imf.org/en/Data">IMF data</a> homepage (International Financial Statistics) with the ultimate goal of producing a tidy dataframe.</p>
<p>I have downloaded 8 excel files and they contain the following data:</p>
<ul>
<li>Financial Market Prices, Equities, End of Period, Index</li>
<li>Prices, Consumer Price Index, All items, Index</li>
<li>Prices, Producer Price Index, All Commodities, Index</li>
<li>Economic Activity, Industrial Production, Index</li>
<li>Labor Force, Persons, Number of</li>
<li>Unemployment, Persons, Number of</li>
<li>Employment, Persons, Number of</li>
<li>Labor Markets, Unemployment Rate, Percent</li>
</ul>
<p>The post consists of the following four parts:</p>
<ol>
<li>Setup and the first glance at a file</li>
<li>Parse and clean all files</li>
<li>Merge with external data</li>
<li>Save data</li>
</ol>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.-Setup-and-a-first-look-at-one-file">1. Setup and a first look at one file<a class="anchor-link" href="posts/python-cleaning-excel-files-from-imf/#1.-Setup-and-a-first-look-at-one-file">¶</a>
</h3>
<p>First I import the libraries I need. Beyond pandas, I will use <a href="https://docs.python.org/3/library/pathlib.html">pathlib</a>, which is in the standard library, and the third party library <a href="https://github.com/htp84/neat_panda">neat_panda</a> to clean the data.</p>
<p>I also create a custom print function to add newlines, write in bold and colorize the printed text. A good explanation on how to modify the appearance of printed text in jupyter can be found <a href="https://stackoverflow.com/questions/23271575/printing-bold-colored-etc-text-in-ipython-qtconsole">here</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">neat_panda</span> <span class="k">import</span> <span class="n">spread</span><span class="p">,</span> <span class="n">gather</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">print2</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"</span><span class="se">\n\n\n\x1b</span><span class="s2">[1;30;47m</span><span class="si">{value}</span><span class="se">\x1b</span><span class="s2">[0m"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To see which excel files I have in the current directory I use the <em>Path</em> function from <em>pathlib</em> and its <em>glob</em> method. Since <em>glob</em> returns a generator I use the <em>list</em> function to transform it to a list called <strong>files</strong>.</p>
<p>The files are named poorly, as seen below. However, I know there is information in the files that will help to identify them. Therefore, I parse the first file in <strong>files</strong>. I view its first 10 rows using the <em>head</em> method.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"../../imf/"</span><span class="p">)</span>

<span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.xlsx"</span><span class="p">))</span>
<span class="n">print2</span><span class="p">(</span><span class="s2">"Files:"</span><span class="p">)</span>
<span class="n">files</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Data from the first file:"</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Files:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[3]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[PosixPath('../../imf/Prices_Production_and_Labor (1).xlsx'),
 PosixPath('../../imf/Prices_Production_and_Labor (2).xlsx'),
 PosixPath('../../imf/Prices_Production_and_Labor (3).xlsx'),
 PosixPath('../../imf/Prices_Production_and_Labor (4).xlsx'),
 PosixPath('../../imf/Prices_Production_and_Labor (5).xlsx'),
 PosixPath('../../imf/Prices_Production_and_Labor (6).xlsx'),
 PosixPath('../../imf/Prices_Production_and_Labor (7).xlsx'),
 PosixPath('../../imf/Prices_Production_and_Labor.xlsx')]</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Data from the first file:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[3]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>Unnamed: 0</th>
      <th>Unnamed: 1</th>
      <th>Unnamed: 2</th>
      <th>Unnamed: 3</th>
      <th>Unnamed: 4</th>
      <th>Unnamed: 5</th>
      <th>Unnamed: 6</th>
      <th>Unnamed: 7</th>
      <th>Unnamed: 8</th>
      <th>Unnamed: 9</th>
      <th>...</th>
      <th>Unnamed: 96</th>
      <th>Unnamed: 97</th>
      <th>Unnamed: 98</th>
      <th>Unnamed: 99</th>
      <th>Unnamed: 100</th>
      <th>Unnamed: 101</th>
      <th>Unnamed: 102</th>
      <th>Unnamed: 103</th>
      <th>Unnamed: 104</th>
      <th>Unnamed: 105</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>NaN</td>
      <td>Prices, Production and Labor selected indicators</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>1</th>
      <td>NaN</td>
      <td>Prices, Consumer Price Index, All items, Index</td>
      <td>getSelectionEl(0,1,"Indicator")</td>
      <td>getSelectionEl(0,1,"Indicator")</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>3</th>
      <td>NaN</td>
      <td>Source: International Financial Statistics (IFS)</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>5</th>
      <td>NaN</td>
      <td>Country</td>
      <td>Scale</td>
      <td>Base Year</td>
      <td>2013</td>
      <td>2013Q1</td>
      <td>2013M01</td>
      <td>2013M02</td>
      <td>2013M03</td>
      <td>2013Q2</td>
      <td>...</td>
      <td>2018M05</td>
      <td>2018M06</td>
      <td>2018Q3</td>
      <td>2018M07</td>
      <td>2018M08</td>
      <td>2018M09</td>
      <td>2018Q4</td>
      <td>2018M10</td>
      <td>2018M11</td>
      <td>2018M12</td>
    </tr>
<tr>
<th>6</th>
      <td>NaN</td>
      <td>Afghanistan, Islamic Republic of</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>127.795</td>
      <td>125.223</td>
      <td>125.191</td>
      <td>125.516</td>
      <td>124.962</td>
      <td>126.717</td>
      <td>...</td>
      <td>145.343</td>
      <td>145.191</td>
      <td>145.512</td>
      <td>145.385</td>
      <td>145.297</td>
      <td>145.855</td>
      <td>...</td>
      <td>147.255</td>
      <td>148.218</td>
      <td>...</td>
    </tr>
<tr>
<th>7</th>
      <td>NaN</td>
      <td>Albania</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>107.582</td>
      <td>108.463</td>
      <td>107.572</td>
      <td>108.797</td>
      <td>109.02</td>
      <td>107.944</td>
      <td>...</td>
      <td>116.843</td>
      <td>116.778</td>
      <td>116.844</td>
      <td>116.471</td>
      <td>116.897</td>
      <td>117.166</td>
      <td>117.183</td>
      <td>116.963</td>
      <td>116.673</td>
      <td>117.912</td>
    </tr>
<tr>
<th>8</th>
      <td>NaN</td>
      <td>Algeria</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>117.522</td>
      <td>117.774</td>
      <td>117.691</td>
      <td>117.514</td>
      <td>118.116</td>
      <td>117.346</td>
      <td>...</td>
      <td>149.534</td>
      <td>151.156</td>
      <td>148.866</td>
      <td>148.257</td>
      <td>148.932</td>
      <td>149.409</td>
      <td>...</td>
      <td>151.193</td>
      <td>150.518</td>
      <td>...</td>
    </tr>
<tr>
<th>9</th>
      <td>NaN</td>
      <td>Angola</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>136.131</td>
      <td>132.31</td>
      <td>131.299</td>
      <td>132.379</td>
      <td>133.254</td>
      <td>135.115</td>
      <td>...</td>
      <td>329.144</td>
      <td>332.962</td>
      <td>342.883</td>
      <td>337.051</td>
      <td>341.111</td>
      <td>350.486</td>
      <td>...</td>
      <td>355.287</td>
      <td>360.209</td>
      <td>...</td>
    </tr>
</tbody>
</table>
<p>10 rows × 106 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The interesting data starts at index 5 in the Unnamed:1 column. The first column does not include data so it is unnecessary. The row at index 5 is the header. Also, the KPI ID is at index 1 column Unnamed:1. This information is useful.</p>
<p>I will import the data again and then clean the dataframe. In the code cell below I explain the purpose of every line.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># parse excel file</span>
<span class="n">kpi</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># get the kpi name</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">6</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="c1"># get the data</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="c1"># get columnnames</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span> <span class="c1"># set columnnames</span>
<span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">column</span><span class="o">=</span><span class="s2">"kpi"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">kpi</span><span class="p">)</span> <span class="c1"># add kpi at position 1</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># reset the index and delete the old index</span>
<span class="n">print2</span><span class="p">(</span><span class="s2">"Cleaned data v1 (one file):"</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Cleaned data v1 (one file):</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[4]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>Country</th>
      <th>kpi</th>
      <th>Scale</th>
      <th>Base Year</th>
      <th>2013</th>
      <th>2013Q1</th>
      <th>2013M01</th>
      <th>2013M02</th>
      <th>2013M03</th>
      <th>2013Q2</th>
      <th>...</th>
      <th>2018M05</th>
      <th>2018M06</th>
      <th>2018Q3</th>
      <th>2018M07</th>
      <th>2018M08</th>
      <th>2018M09</th>
      <th>2018Q4</th>
      <th>2018M10</th>
      <th>2018M11</th>
      <th>2018M12</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>Afghanistan, Islamic Republic of</td>
      <td>Prices, Consumer Price Index, All items, Index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>127.795</td>
      <td>125.223</td>
      <td>125.191</td>
      <td>125.516</td>
      <td>124.962</td>
      <td>126.717</td>
      <td>...</td>
      <td>145.343</td>
      <td>145.191</td>
      <td>145.512</td>
      <td>145.385</td>
      <td>145.297</td>
      <td>145.855</td>
      <td>...</td>
      <td>147.255</td>
      <td>148.218</td>
      <td>...</td>
    </tr>
<tr>
<th>1</th>
      <td>Albania</td>
      <td>Prices, Consumer Price Index, All items, Index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>107.582</td>
      <td>108.463</td>
      <td>107.572</td>
      <td>108.797</td>
      <td>109.02</td>
      <td>107.944</td>
      <td>...</td>
      <td>116.843</td>
      <td>116.778</td>
      <td>116.844</td>
      <td>116.471</td>
      <td>116.897</td>
      <td>117.166</td>
      <td>117.183</td>
      <td>116.963</td>
      <td>116.673</td>
      <td>117.912</td>
    </tr>
<tr>
<th>2</th>
      <td>Algeria</td>
      <td>Prices, Consumer Price Index, All items, Index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>117.522</td>
      <td>117.774</td>
      <td>117.691</td>
      <td>117.514</td>
      <td>118.116</td>
      <td>117.346</td>
      <td>...</td>
      <td>149.534</td>
      <td>151.156</td>
      <td>148.866</td>
      <td>148.257</td>
      <td>148.932</td>
      <td>149.409</td>
      <td>...</td>
      <td>151.193</td>
      <td>150.518</td>
      <td>...</td>
    </tr>
<tr>
<th>3</th>
      <td>Angola</td>
      <td>Prices, Consumer Price Index, All items, Index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>136.131</td>
      <td>132.31</td>
      <td>131.299</td>
      <td>132.379</td>
      <td>133.254</td>
      <td>135.115</td>
      <td>...</td>
      <td>329.144</td>
      <td>332.962</td>
      <td>342.883</td>
      <td>337.051</td>
      <td>341.111</td>
      <td>350.486</td>
      <td>...</td>
      <td>355.287</td>
      <td>360.209</td>
      <td>...</td>
    </tr>
<tr>
<th>4</th>
      <td>Anguilla</td>
      <td>Prices, Consumer Price Index, All items, Index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>106.355</td>
      <td>106.065</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>106.63</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
</tbody>
</table>
<p>5 rows × 106 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As can be seen in the last row above, missing data is coded with three dots (...). This must be replaced with NaN. Also, in my opinion, the kpi column and all column names will look better if comma and spaces were replaced with underscores and if they were set to lowercase. Since I have added the kpi column I need to remove it again before renaming the columns. Otherwise, there will be a Value Error since there is a length mismatch between the <em>cols</em> list and the <em>df</em> columns. I reset the kpi column using the kpi variable set in the previous code cell.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">"kpi"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># drop kpi column</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span> <span class="c1"># clean columnnames</span>
<span class="n">kpi</span> <span class="o">=</span> <span class="n">kpi</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">", "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="c1"># clean kpi string</span>
<span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">column</span><span class="o">=</span><span class="s2">"kpi"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">kpi</span><span class="p">)</span> <span class="c1"># reset kpi column</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"..."</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="c1"># replace missing data with NaN</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Cleaned data v2 (one file):"</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Cleaned data v2 (one file):</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[5]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>kpi</th>
      <th>scale</th>
      <th>base_year</th>
      <th>2013</th>
      <th>2013q1</th>
      <th>2013m01</th>
      <th>2013m02</th>
      <th>2013m03</th>
      <th>2013q2</th>
      <th>...</th>
      <th>2018m05</th>
      <th>2018m06</th>
      <th>2018q3</th>
      <th>2018m07</th>
      <th>2018m08</th>
      <th>2018m09</th>
      <th>2018q4</th>
      <th>2018m10</th>
      <th>2018m11</th>
      <th>2018m12</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>Afghanistan, Islamic Republic of</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>127.795223</td>
      <td>125.223096</td>
      <td>125.191195</td>
      <td>125.515928</td>
      <td>124.962165</td>
      <td>126.716991</td>
      <td>...</td>
      <td>145.342948</td>
      <td>145.191142</td>
      <td>145.512463</td>
      <td>145.385089</td>
      <td>145.297193</td>
      <td>145.855109</td>
      <td>NaN</td>
      <td>147.255013</td>
      <td>148.217621</td>
      <td>NaN</td>
    </tr>
<tr>
<th>1</th>
      <td>Albania</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>107.581663</td>
      <td>108.463252</td>
      <td>107.572383</td>
      <td>108.797327</td>
      <td>109.020045</td>
      <td>107.943578</td>
      <td>...</td>
      <td>116.843122</td>
      <td>116.777638</td>
      <td>116.844480</td>
      <td>116.470825</td>
      <td>116.896941</td>
      <td>117.165674</td>
      <td>117.182718</td>
      <td>116.963307</td>
      <td>116.672751</td>
      <td>117.912095</td>
    </tr>
<tr>
<th>2</th>
      <td>Algeria</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>117.521838</td>
      <td>117.773863</td>
      <td>117.690670</td>
      <td>117.514498</td>
      <td>118.116421</td>
      <td>117.345665</td>
      <td>...</td>
      <td>149.533877</td>
      <td>151.156133</td>
      <td>148.865889</td>
      <td>148.256625</td>
      <td>148.931953</td>
      <td>149.409088</td>
      <td>NaN</td>
      <td>151.192836</td>
      <td>150.517507</td>
      <td>NaN</td>
    </tr>
<tr>
<th>3</th>
      <td>Angola</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>136.131179</td>
      <td>132.310430</td>
      <td>131.299063</td>
      <td>132.378692</td>
      <td>133.253535</td>
      <td>135.114554</td>
      <td>...</td>
      <td>329.144088</td>
      <td>332.961741</td>
      <td>342.882827</td>
      <td>337.051456</td>
      <td>341.111302</td>
      <td>350.485724</td>
      <td>NaN</td>
      <td>355.286582</td>
      <td>360.208527</td>
      <td>NaN</td>
    </tr>
<tr>
<th>4</th>
      <td>Anguilla</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>106.355020</td>
      <td>106.065480</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>106.629711</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
</tbody>
</table>
<p>5 rows × 106 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.-Parse-and-clean-all-files">2. Parse and clean all files<a class="anchor-link" href="posts/python-cleaning-excel-files-from-imf/#2.-Parse-and-clean-all-files">¶</a>
</h3>
<p>Now the dataframe looks pretty good. But I have only imported one excel file. Let's summarise the steps above in one cell and read in all excel files in <strong>files</strong>. This can be done with a for loop iterating over the list.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">financial_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span> <span class="c1"># initialize empty dataframe to fill</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="c1"># parse excel file i</span>
    <span class="n">kpi</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># get kpi</span>
    <span class="n">kpi</span> <span class="o">=</span> <span class="n">kpi</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">", "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="c1"># clean kpi and get string</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">6</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="c1"># get data</span>
    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">:]]</span> <span class="c1"># set columns</span>
    <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">column</span><span class="o">=</span><span class="s2">"kpi"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">kpi</span><span class="p">)</span> <span class="c1"># add information column</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"..."</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="c1"># replace missing data with NaN</span>
    <span class="n">financial_data</span> <span class="o">=</span> <span class="n">financial_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># append columns on information, period and country</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Cleaned data v2 (all files):"</span><span class="p">)</span>    
<span class="n">financial_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Cleaned data v2 (all files):</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[6]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>kpi</th>
      <th>scale</th>
      <th>base_year</th>
      <th>2013</th>
      <th>2013q1</th>
      <th>2013m01</th>
      <th>2013m02</th>
      <th>2013m03</th>
      <th>2013q2</th>
      <th>...</th>
      <th>2018m08</th>
      <th>2018m09</th>
      <th>2018q4</th>
      <th>2018m10</th>
      <th>2018m11</th>
      <th>2018m12</th>
      <th>2013.0</th>
      <th>2014.0</th>
      <th>2015.0</th>
      <th>2016.0</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>Afghanistan, Islamic Republic of</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>127.795223</td>
      <td>125.223096</td>
      <td>125.191195</td>
      <td>125.515928</td>
      <td>124.962165</td>
      <td>126.716991</td>
      <td>...</td>
      <td>145.297193</td>
      <td>145.855109</td>
      <td>NaN</td>
      <td>147.255013</td>
      <td>148.217621</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>1</th>
      <td>Albania</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>107.581663</td>
      <td>108.463252</td>
      <td>107.572383</td>
      <td>108.797327</td>
      <td>109.020045</td>
      <td>107.943578</td>
      <td>...</td>
      <td>116.896941</td>
      <td>117.165674</td>
      <td>117.182718</td>
      <td>116.963307</td>
      <td>116.672751</td>
      <td>117.912095</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>2</th>
      <td>Algeria</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>117.521838</td>
      <td>117.773863</td>
      <td>117.690670</td>
      <td>117.514498</td>
      <td>118.116421</td>
      <td>117.345665</td>
      <td>...</td>
      <td>148.931953</td>
      <td>149.409088</td>
      <td>NaN</td>
      <td>151.192836</td>
      <td>150.517507</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>3</th>
      <td>Angola</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>136.131179</td>
      <td>132.310430</td>
      <td>131.299063</td>
      <td>132.378692</td>
      <td>133.253535</td>
      <td>135.114554</td>
      <td>...</td>
      <td>341.111302</td>
      <td>350.485724</td>
      <td>NaN</td>
      <td>355.286582</td>
      <td>360.208527</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>4</th>
      <td>Anguilla</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>106.355020</td>
      <td>106.065480</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>106.629711</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
</tbody>
</table>
<p>5 rows × 110 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All excel files are now parsed and appended to the <strong>financial_data</strong> dataframe. But the dataframe is still not easy to analyze. Every period has its own column. Period is a variable so it should only be one column. Hence, the dataframe must be unpivoted/melted/gathered. This can be done with the pandas <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html">melt</a> method. However, I have written a library called <em>neat_panda</em> which mimics the R  package <em>tidyr</em> and I think it is easier to use. But for brevity, I include both methods. I also use the <em>unique</em> method to see which periods are included.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"country"</span><span class="p">,</span> <span class="s2">"kpi"</span><span class="p">,</span> <span class="s2">"scale"</span><span class="p">,</span> <span class="s2">"base_year"</span><span class="p">]</span>
<span class="n">financial_data</span> <span class="o">=</span> <span class="n">gather</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">financial_data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"period"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">"value"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">invert_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># financial_data = financial_data.melt(id_vars=id_vars, var_name="period", value_name="value")</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Unique periods"</span><span class="p">)</span>
<span class="n">financial_data</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Cleaned data v3 (all files):"</span><span class="p">)</span>
<span class="n">financial_data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Unique periods</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>array(['2013', '2013q1', '2013m01', '2013m02', '2013m03', '2013q2',
       '2013m04', '2013m05', '2013m06', '2013q3', '2013m07', '2013m08',
       '2013m09', '2013q4', '2013m10', '2013m11', '2013m12', '2014',
       '2014q1', '2014m01', '2014m02', '2014m03', '2014q2', '2014m04',
       '2014m05', '2014m06', '2014q3', '2014m07', '2014m08', '2014m09',
       '2014q4', '2014m10', '2014m11', '2014m12', '2015', '2015q1',
       '2015m01', '2015m02', '2015m03', '2015q2', '2015m04', '2015m05',
       '2015m06', '2015q3', '2015m07', '2015m08', '2015m09', '2015q4',
       '2015m10', '2015m11', '2015m12', '2016', '2016q1', '2016m01',
       '2016m02', '2016m03', '2016q2', '2016m04', '2016m05', '2016m06',
       '2016q3', '2016m07', '2016m08', '2016m09', '2016q4', '2016m10',
       '2016m11', '2016m12', '2017', '2017q1', '2017m01', '2017m02',
       '2017m03', '2017q2', '2017m04', '2017m05', '2017m06', '2017q3',
       '2017m07', '2017m08', '2017m09', '2017q4', '2017m10', '2017m11',
       '2017m12', '2018', '2018q1', '2018m01', '2018m02', '2018m03',
       '2018q2', '2018m04', '2018m05', '2018m06', '2018q3', '2018m07',
       '2018m08', '2018m09', '2018q4', '2018m10', '2018m11', '2018m12',
       '2013.0', '2014.0', '2015.0', '2016.0'], dtype=object)</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Cleaned data v3 (all files):</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>kpi</th>
      <th>scale</th>
      <th>base_year</th>
      <th>period</th>
      <th>value</th>
    </tr></thead>
<tbody>
<tr>
<th>42428</th>
      <td>Angola</td>
      <td>economic_activity_industrial_production_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>2015m11</td>
      <td>NaN</td>
    </tr>
<tr>
<th>45384</th>
      <td>New Zealand</td>
      <td>employment_persons_number_of</td>
      <td>Thousands</td>
      <td>NaN</td>
      <td>2016q1</td>
      <td>2401.000000</td>
    </tr>
<tr>
<th>40394</th>
      <td>Macedonia, FYR</td>
      <td>financial_market_prices_equities_end_of_period...</td>
      <td>Units</td>
      <td>NaN</td>
      <td>2015m09</td>
      <td>74.792446</td>
    </tr>
<tr>
<th>37253</th>
      <td>Spain</td>
      <td>prices_producer_price_index_all_commodities_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>2015q3</td>
      <td>108.515529</td>
    </tr>
<tr>
<th>77383</th>
      <td>Philippines</td>
      <td>financial_market_prices_equities_end_of_period...</td>
      <td>Units</td>
      <td>NaN</td>
      <td>2018m03</td>
      <td>161.007444</td>
    </tr>
<tr>
<th>64991</th>
      <td>Brunei Darussalam</td>
      <td>unemployment_persons_number_of</td>
      <td>Thousands</td>
      <td>NaN</td>
      <td>2017m05</td>
      <td>NaN</td>
    </tr>
<tr>
<th>24815</th>
      <td>Denmark</td>
      <td>labor_markets_unemployment_rate_percent</td>
      <td>Units</td>
      <td>NaN</td>
      <td>2014m08</td>
      <td>6.500000</td>
    </tr>
<tr>
<th>11523</th>
      <td>Poland</td>
      <td>economic_activity_industrial_production_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>2013q4</td>
      <td>115.676306</td>
    </tr>
<tr>
<th>26159</th>
      <td>United Kingdom</td>
      <td>economic_activity_industrial_production_index</td>
      <td>Units</td>
      <td>2010=100</td>
      <td>2014q4</td>
      <td>99.802761</td>
    </tr>
<tr>
<th>83106</th>
      <td>Myanmar</td>
      <td>unemployment_persons_number_of</td>
      <td>Thousands</td>
      <td>NaN</td>
      <td>2018m08</td>
      <td>NaN</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The periods include quarters (e.g. 2013q1), year (e.g. 2015) and months (e.g. 2018m06). There is one problem, the last four periods in unique periods array have a dot and a zero after the year. This problem is most likely caused by a datatype error when the excel files are parsed. This is easily fixed with pandas, see below. I also set the value column to float and count the number of null values in the <em>value</em> column.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">financial_data</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">financial_data</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">".0"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># fix problem with year</span>
<span class="n">financial_data</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">financial_data</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Control periods:"</span><span class="p">)</span>
<span class="n">financial_data</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Number of nulls in the value column:"</span><span class="p">)</span>
<span class="n">financial_data</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Control periods:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>array(['2013', '2013q1', '2013m01', '2013m02', '2013m03', '2013q2',
       '2013m04', '2013m05', '2013m06', '2013q3', '2013m07', '2013m08',
       '2013m09', '2013q4', '2013m10', '2013m11', '2013m12', '2014',
       '2014q1', '2014m01', '2014m02', '2014m03', '2014q2', '2014m04',
       '2014m05', '2014m06', '2014q3', '2014m07', '2014m08', '2014m09',
       '2014q4', '2014m10', '2014m11', '2014m12', '2015', '2015q1',
       '2015m01', '2015m02', '2015m03', '2015q2', '2015m04', '2015m05',
       '2015m06', '2015q3', '2015m07', '2015m08', '2015m09', '2015q4',
       '2015m10', '2015m11', '2015m12', '2016', '2016q1', '2016m01',
       '2016m02', '2016m03', '2016q2', '2016m04', '2016m05', '2016m06',
       '2016q3', '2016m07', '2016m08', '2016m09', '2016q4', '2016m10',
       '2016m11', '2016m12', '2017', '2017q1', '2017m01', '2017m02',
       '2017m03', '2017q2', '2017m04', '2017m05', '2017m06', '2017q3',
       '2017m07', '2017m08', '2017m09', '2017q4', '2017m10', '2017m11',
       '2017m12', '2018', '2018q1', '2018m01', '2018m02', '2018m03',
       '2018q2', '2018m04', '2018m05', '2018m06', '2018q3', '2018m07',
       '2018m08', '2018m09', '2018q4', '2018m10', '2018m11', '2018m12'],
      dtype=object)</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Number of nulls in the value column:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>91160</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are 91160 rows with null values. One should always be careful when handling null values. But in this case, they are just in the way, so I will drop them and then control if there are any left.</p>
<p>The period column is not optimal, it would be nice if one easily could distinguish the time period. Also, it would be nice if year and period (month, quarter) were separate columns. This can be accomplished with the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html">apply</a> method and a <a href="https://www.w3schools.com/python/python_lambda.asp">lambda</a> function.</p>
<p>I do all the above operations based on the period column. Then I replace the old period column with the new column that specifies the current month/quarter. NaN is set if the data is yearly.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">financial_data</span> <span class="o">=</span> <span class="n">financial_data</span><span class="p">[</span><span class="n">financial_data</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span> <span class="c1"># remova NaN's</span>

<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"country"</span><span class="p">,</span> <span class="s2">"kpi"</span><span class="p">,</span> <span class="s2">"period"</span><span class="p">,</span> <span class="s2">"value"</span><span class="p">]</span>
<span class="n">financial_data</span> <span class="o">=</span> <span class="n">financial_data</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="c1"># filter out interesting columns</span>

<span class="n">financial_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">"year"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">financial_data</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span> <span class="c1"># insert year column</span>

<span class="n">_period2</span> <span class="o">=</span> <span class="p">(</span><span class="n">financial_data</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="s2">"q"</span> <span class="ow">in</span> <span class="n">x</span>
                                        <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="k">if</span> <span class="s2">"m"</span> <span class="ow">in</span> <span class="n">x</span>
                                        <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)))</span> <span class="c1"># create _period2 series</span>

<span class="n">financial_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">"period2"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">_period2</span><span class="p">)</span> <span class="c1"># insert _period2 into financial data</span>

<span class="n">_time_period</span> <span class="o">=</span> <span class="n">financial_data</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">"quarter"</span> <span class="k">if</span> <span class="s2">"q"</span> <span class="ow">in</span> <span class="n">x</span>
                                           <span class="k">else</span> <span class="p">(</span><span class="s2">"month"</span> <span class="k">if</span> <span class="s2">"m"</span> <span class="ow">in</span> <span class="n">x</span>
                                           <span class="k">else</span> <span class="s2">"year"</span><span class="p">))</span> <span class="c1"># create _time_period series</span>

<span class="n">financial_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">"time_period"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">_time_period</span><span class="p">)</span> <span class="c1"># insert _time_period series into financial data</span>

<span class="n">financial_data</span><span class="p">[</span><span class="s2">"period"</span><span class="p">]</span> <span class="o">=</span> <span class="n">financial_data</span><span class="p">[</span><span class="s2">"period2"</span><span class="p">]</span> <span class="c1"># overwrite old period column with period2</span>

<span class="n">financial_data</span> <span class="o">=</span> <span class="n">financial_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">"period2"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># drop period2 column</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Cleaned data v4 (all files):"</span><span class="p">)</span>

<span class="n">financial_data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Cleaned data v4 (all files):</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[9]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>kpi</th>
      <th>year</th>
      <th>period</th>
      <th>time_period</th>
      <th>value</th>
    </tr></thead>
<tbody>
<tr>
<th>20045</th>
      <td>Poland</td>
      <td>prices_producer_price_index_all_commodities_index</td>
      <td>2014</td>
      <td>04</td>
      <td>month</td>
      <td>108.300000</td>
    </tr>
<tr>
<th>49825</th>
      <td>Thailand</td>
      <td>labor_markets_unemployment_rate_percent</td>
      <td>2016</td>
      <td>04</td>
      <td>month</td>
      <td>1.040000</td>
    </tr>
<tr>
<th>25655</th>
      <td>Belarus</td>
      <td>labor_markets_unemployment_rate_percent</td>
      <td>2014</td>
      <td>09</td>
      <td>month</td>
      <td>0.500000</td>
    </tr>
<tr>
<th>68523</th>
      <td>United Kingdom</td>
      <td>unemployment_persons_number_of</td>
      <td>2017</td>
      <td>08</td>
      <td>month</td>
      <td>1500.673000</td>
    </tr>
<tr>
<th>5115</th>
      <td>Vietnam</td>
      <td>labor_markets_unemployment_rate_percent</td>
      <td>2013</td>
      <td>2</td>
      <td>quarter</td>
      <td>1.944700</td>
    </tr>
<tr>
<th>25082</th>
      <td>Qatar</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>2014</td>
      <td>09</td>
      <td>month</td>
      <td>111.397903</td>
    </tr>
<tr>
<th>58776</th>
      <td>Brazil</td>
      <td>economic_activity_industrial_production_index</td>
      <td>2017</td>
      <td>NaN</td>
      <td>year</td>
      <td>85.441020</td>
    </tr>
<tr>
<th>53638</th>
      <td>Iceland</td>
      <td>economic_activity_industrial_production_index</td>
      <td>2016</td>
      <td>08</td>
      <td>month</td>
      <td>119.448972</td>
    </tr>
<tr>
<th>62004</th>
      <td>Ireland</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>2017</td>
      <td>03</td>
      <td>month</td>
      <td>105.105680</td>
    </tr>
<tr>
<th>82540</th>
      <td>Morocco</td>
      <td>financial_market_prices_equities_end_of_period...</td>
      <td>2018</td>
      <td>07</td>
      <td>month</td>
      <td>92.816708</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now there are two steps left until the dataframe is tidy. First, the kpi column needs to be spread/pivoted. This because the kpi column contains multiple kpis and every kpi is a variable.  For this, I will use the spread function from <em>neat_panda</em>.</p>
<p>Also, the dataframe contains three different time periods (year, month, quarter). The time periods need to be split into three separate dataframes.</p>
<h3 id="3.-Merge-with-external-data">3. Merge with external data<a class="anchor-link" href="posts/python-cleaning-excel-files-from-imf/#3.-Merge-with-external-data">¶</a>
</h3>
<p>However, it would help the analysis if the dataframe contained more information about the country, for example, region. This <a href="https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv">link</a> contains a csv with countries and their region. Let's look at the data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">region</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv"</span><span class="p">)</span>
<span class="n">print2</span><span class="p">(</span><span class="s2">"Region data:"</span><span class="p">)</span>
<span class="n">region</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Regions and sub-regions:"</span><span class="p">)</span>
<span class="n">region</span><span class="p">[[</span><span class="s2">"region"</span><span class="p">,</span> <span class="s2">"sub-region"</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">"region"</span><span class="p">,</span><span class="s2">"sub-region"</span><span class="p">])</span> <span class="c1"># show region</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Region data:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[10]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>name</th>
      <th>alpha-2</th>
      <th>alpha-3</th>
      <th>country-code</th>
      <th>iso_3166-2</th>
      <th>region</th>
      <th>sub-region</th>
      <th>intermediate-region</th>
      <th>region-code</th>
      <th>sub-region-code</th>
      <th>intermediate-region-code</th>
    </tr></thead>
<tbody>
<tr>
<th>44</th>
      <td>Chile</td>
      <td>CL</td>
      <td>CHL</td>
      <td>152</td>
      <td>ISO 3166-2:CL</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
      <td>South America</td>
      <td>19.0</td>
      <td>419.0</td>
      <td>5.0</td>
    </tr>
<tr>
<th>162</th>
      <td>Niue</td>
      <td>NU</td>
      <td>NIU</td>
      <td>570</td>
      <td>ISO 3166-2:NU</td>
      <td>Oceania</td>
      <td>Polynesia</td>
      <td>NaN</td>
      <td>9.0</td>
      <td>61.0</td>
      <td>NaN</td>
    </tr>
<tr>
<th>46</th>
      <td>Christmas Island</td>
      <td>CX</td>
      <td>CXR</td>
      <td>162</td>
      <td>ISO 3166-2:CX</td>
      <td>Oceania</td>
      <td>Australia and New Zealand</td>
      <td>NaN</td>
      <td>9.0</td>
      <td>53.0</td>
      <td>NaN</td>
    </tr>
<tr>
<th>221</th>
      <td>Timor-Leste</td>
      <td>TL</td>
      <td>TLS</td>
      <td>626</td>
      <td>ISO 3166-2:TL</td>
      <td>Asia</td>
      <td>South-eastern Asia</td>
      <td>NaN</td>
      <td>142.0</td>
      <td>35.0</td>
      <td>NaN</td>
    </tr>
<tr>
<th>208</th>
      <td>South Sudan</td>
      <td>SS</td>
      <td>SSD</td>
      <td>728</td>
      <td>ISO 3166-2:SS</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
      <td>Eastern Africa</td>
      <td>2.0</td>
      <td>202.0</td>
      <td>14.0</td>
    </tr>
<tr>
<th>120</th>
      <td>Kuwait</td>
      <td>KW</td>
      <td>KWT</td>
      <td>414</td>
      <td>ISO 3166-2:KW</td>
      <td>Asia</td>
      <td>Western Asia</td>
      <td>NaN</td>
      <td>142.0</td>
      <td>145.0</td>
      <td>NaN</td>
    </tr>
<tr>
<th>88</th>
      <td>Grenada</td>
      <td>GD</td>
      <td>GRD</td>
      <td>308</td>
      <td>ISO 3166-2:GD</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
      <td>Caribbean</td>
      <td>19.0</td>
      <td>419.0</td>
      <td>29.0</td>
    </tr>
<tr>
<th>124</th>
      <td>Lebanon</td>
      <td>LB</td>
      <td>LBN</td>
      <td>422</td>
      <td>ISO 3166-2:LB</td>
      <td>Asia</td>
      <td>Western Asia</td>
      <td>NaN</td>
      <td>142.0</td>
      <td>145.0</td>
      <td>NaN</td>
    </tr>
<tr>
<th>27</th>
      <td>Bonaire, Sint Eustatius and Saba</td>
      <td>BQ</td>
      <td>BES</td>
      <td>535</td>
      <td>ISO 3166-2:BQ</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
      <td>Caribbean</td>
      <td>19.0</td>
      <td>419.0</td>
      <td>29.0</td>
    </tr>
<tr>
<th>18</th>
      <td>Bangladesh</td>
      <td>BD</td>
      <td>BGD</td>
      <td>50</td>
      <td>ISO 3166-2:BD</td>
      <td>Asia</td>
      <td>Southern Asia</td>
      <td>NaN</td>
      <td>142.0</td>
      <td>34.0</td>
      <td>NaN</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Regions and sub-regions:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[10]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>region</th>
      <th>sub-region</th>
    </tr></thead>
<tbody>
<tr>
<th>3</th>
      <td>Africa</td>
      <td>Northern Africa</td>
    </tr>
<tr>
<th>6</th>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>7</th>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>24</th>
      <td>Americas</td>
      <td>Northern America</td>
    </tr>
<tr>
<th>115</th>
      <td>Asia</td>
      <td>Central Asia</td>
    </tr>
<tr>
<th>45</th>
      <td>Asia</td>
      <td>Eastern Asia</td>
    </tr>
<tr>
<th>33</th>
      <td>Asia</td>
      <td>South-eastern Asia</td>
    </tr>
<tr>
<th>0</th>
      <td>Asia</td>
      <td>Southern Asia</td>
    </tr>
<tr>
<th>11</th>
      <td>Asia</td>
      <td>Western Asia</td>
    </tr>
<tr>
<th>20</th>
      <td>Europe</td>
      <td>Eastern Europe</td>
    </tr>
<tr>
<th>1</th>
      <td>Europe</td>
      <td>Northern Europe</td>
    </tr>
<tr>
<th>2</th>
      <td>Europe</td>
      <td>Southern Europe</td>
    </tr>
<tr>
<th>14</th>
      <td>Europe</td>
      <td>Western Europe</td>
    </tr>
<tr>
<th>13</th>
      <td>Oceania</td>
      <td>Australia and New Zealand</td>
    </tr>
<tr>
<th>74</th>
      <td>Oceania</td>
      <td>Melanesia</td>
    </tr>
<tr>
<th>90</th>
      <td>Oceania</td>
      <td>Micronesia</td>
    </tr>
<tr>
<th>4</th>
      <td>Oceania</td>
      <td>Polynesia</td>
    </tr>
<tr>
<th>8</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are many columns, but I find the <em>name</em>, <em>region</em> and <em>sub-region</em> columns most interesting. The <em>name</em> column can be used as a key when joining with the <em>financial_data</em> dataframe. Optimal would have been if the original data had contained one of the other columns since it would have increased the likelihood for a perfect match. But I have to take what I have got and deal with it.</p>
<p>So, I filter the columns in the <em>region</em> dataframe and rename the <em>name</em> column to <em>country</em>. Then I use the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html">merge</a> method to join the <em>financial_data</em> and <em>region</em> dataframes using country as key. I create a new dataframe called <em>financial_data2</em>. This is a temporary dataframe, I will use it to see which countries in <em>financial_data</em> that do not have a match in the <em>region</em> dataframe.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">region</span> <span class="o">=</span> <span class="n">region</span><span class="p">[[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"region"</span><span class="p">,</span> <span class="s2">"sub-region"</span><span class="p">]]</span> <span class="c1"># filter columns</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"country"</span><span class="p">}</span> <span class="p">)</span> <span class="c1"># rename column</span>
<span class="n">print2</span><span class="p">(</span><span class="s2">"Cleaned region data:"</span><span class="p">)</span>
<span class="n">region</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">financial_data2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">financial_data</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">"country"</span><span class="p">)</span> <span class="c1"># join dataframes</span>
<span class="n">print2</span><span class="p">(</span><span class="s2">"Countries with no match in region dataframe:"</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">financial_data2</span><span class="o">.</span><span class="n">country</span><span class="p">[</span><span class="n">financial_data2</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="c1"># show countries with no region</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Cleaned region data:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[11]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>region</th>
      <th>sub-region</th>
    </tr></thead>
<tbody>
<tr>
<th>129</th>
      <td>Lithuania</td>
      <td>Europe</td>
      <td>Northern Europe</td>
    </tr>
<tr>
<th>244</th>
      <td>Wallis and Futuna</td>
      <td>Oceania</td>
      <td>Polynesia</td>
    </tr>
<tr>
<th>211</th>
      <td>Sudan</td>
      <td>Africa</td>
      <td>Northern Africa</td>
    </tr>
<tr>
<th>23</th>
      <td>Benin</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>79</th>
      <td>French Southern Territories</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>17</th>
      <td>Bahrain</td>
      <td>Asia</td>
      <td>Western Asia</td>
    </tr>
<tr>
<th>144</th>
      <td>Micronesia (Federated States of)</td>
      <td>Oceania</td>
      <td>Micronesia</td>
    </tr>
<tr>
<th>120</th>
      <td>Kuwait</td>
      <td>Asia</td>
      <td>Western Asia</td>
    </tr>
<tr>
<th>73</th>
      <td>Faroe Islands</td>
      <td>Europe</td>
      <td>Northern Europe</td>
    </tr>
<tr>
<th>13</th>
      <td>Australia</td>
      <td>Oceania</td>
      <td>Australia and New Zealand</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Countries with no match in region dataframe:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[11]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>0</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>Afghanistan, Islamic Republic of</td>
    </tr>
<tr>
<th>1</th>
      <td>Armenia, Republic of</td>
    </tr>
<tr>
<th>2</th>
      <td>Azerbaijan, Republic of</td>
    </tr>
<tr>
<th>3</th>
      <td>Bahamas, The</td>
    </tr>
<tr>
<th>4</th>
      <td>Bahrain, Kingdom of</td>
    </tr>
<tr>
<th>5</th>
      <td>Bolivia</td>
    </tr>
<tr>
<th>6</th>
      <td>China, P.R.: Hong Kong</td>
    </tr>
<tr>
<th>7</th>
      <td>China, P.R.: Macao</td>
    </tr>
<tr>
<th>8</th>
      <td>China, P.R.: Mainland</td>
    </tr>
<tr>
<th>9</th>
      <td>Congo, Democratic Republic of</td>
    </tr>
<tr>
<th>10</th>
      <td>Congo, Republic of</td>
    </tr>
<tr>
<th>11</th>
      <td>Czech Republic</td>
    </tr>
<tr>
<th>12</th>
      <td>Eswatini, Kingdom of</td>
    </tr>
<tr>
<th>13</th>
      <td>French Territories: New Caledonia</td>
    </tr>
<tr>
<th>14</th>
      <td>Gambia, The</td>
    </tr>
<tr>
<th>15</th>
      <td>Iran, Islamic Republic of</td>
    </tr>
<tr>
<th>16</th>
      <td>Kosovo, Republic of</td>
    </tr>
<tr>
<th>17</th>
      <td>Kyrgyz Republic</td>
    </tr>
<tr>
<th>18</th>
      <td>Macedonia, FYR</td>
    </tr>
<tr>
<th>19</th>
      <td>Micronesia, Federated States of</td>
    </tr>
<tr>
<th>20</th>
      <td>Moldova</td>
    </tr>
<tr>
<th>21</th>
      <td>São Tomé and Príncipe</td>
    </tr>
<tr>
<th>22</th>
      <td>Serbia, Republic of</td>
    </tr>
<tr>
<th>23</th>
      <td>Sint Maarten</td>
    </tr>
<tr>
<th>24</th>
      <td>Slovak Republic</td>
    </tr>
<tr>
<th>25</th>
      <td>St. Kitts and Nevis</td>
    </tr>
<tr>
<th>26</th>
      <td>St. Lucia</td>
    </tr>
<tr>
<th>27</th>
      <td>St. Vincent and the Grenadines</td>
    </tr>
<tr>
<th>28</th>
      <td>Tanzania</td>
    </tr>
<tr>
<th>29</th>
      <td>Timor-Leste, Dem. Rep. of</td>
    </tr>
<tr>
<th>30</th>
      <td>United Kingdom</td>
    </tr>
<tr>
<th>31</th>
      <td>United States</td>
    </tr>
<tr>
<th>32</th>
      <td>Venezuela, Republica Bolivariana de</td>
    </tr>
<tr>
<th>33</th>
      <td>Vietnam</td>
    </tr>
<tr>
<th>34</th>
      <td>West Bank and Gaza</td>
    </tr>
<tr>
<th>35</th>
      <td>Yemen, Republic of</td>
    </tr>
<tr>
<th>36</th>
      <td>Advanced Economies</td>
    </tr>
<tr>
<th>37</th>
      <td>CIS</td>
    </tr>
<tr>
<th>38</th>
      <td>Emerging and Developing Asia</td>
    </tr>
<tr>
<th>39</th>
      <td>Emerging and Developing Countries</td>
    </tr>
<tr>
<th>40</th>
      <td>Emerging and Developing Europe</td>
    </tr>
<tr>
<th>41</th>
      <td>Europe</td>
    </tr>
<tr>
<th>42</th>
      <td>Middle East, North Africa, Afghanistan, and Pa...</td>
    </tr>
<tr>
<th>43</th>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>44</th>
      <td>Western Hemisphere</td>
    </tr>
<tr>
<th>45</th>
      <td>World</td>
    </tr>
<tr>
<th>46</th>
      <td>Euro Area</td>
    </tr>
<tr>
<th>47</th>
      <td>Netherlands Antilles</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are 48 <em>"countries"</em> that do not have a match. But, as can be seen above, the <em>"countries"</em> from index 36 to 46 are not countries. They are regions. These can be removed. This is done in the missing dataframe below.</p>
<p>Also, many of the countries in the financial_data dataframe that have no match in the region dataframe have longer names, often split by a comma, e.g. <em>Bahamas, The</em>. Therefore I create a new column in the missing dataframe called country2 where I split the country name on comma (,).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">missing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">financial_data2</span><span class="o">.</span><span class="n">country</span><span class="p">[</span><span class="n">financial_data2</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"country"</span><span class="p">])</span>
<span class="n">missing</span> <span class="o">=</span> <span class="n">missing</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"index&lt;36 | index==47"</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># remove regions</span>

<span class="n">missing</span><span class="p">[</span><span class="s2">"country2"</span><span class="p">]</span> <span class="o">=</span> <span class="n">missing</span><span class="p">[</span><span class="s2">"country"</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># split on comma</span>
<span class="n">print2</span><span class="p">(</span><span class="s2">"Countries with no match v2:"</span><span class="p">)</span>
<span class="n">missing</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Countries with no match v2:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[12]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>country2</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>Afghanistan, Islamic Republic of</td>
      <td>Afghanistan</td>
    </tr>
<tr>
<th>1</th>
      <td>Armenia, Republic of</td>
      <td>Armenia</td>
    </tr>
<tr>
<th>2</th>
      <td>Azerbaijan, Republic of</td>
      <td>Azerbaijan</td>
    </tr>
<tr>
<th>3</th>
      <td>Bahamas, The</td>
      <td>Bahamas</td>
    </tr>
<tr>
<th>4</th>
      <td>Bahrain, Kingdom of</td>
      <td>Bahrain</td>
    </tr>
<tr>
<th>5</th>
      <td>Bolivia</td>
      <td>Bolivia</td>
    </tr>
<tr>
<th>6</th>
      <td>China, P.R.: Hong Kong</td>
      <td>China</td>
    </tr>
<tr>
<th>7</th>
      <td>China, P.R.: Macao</td>
      <td>China</td>
    </tr>
<tr>
<th>8</th>
      <td>China, P.R.: Mainland</td>
      <td>China</td>
    </tr>
<tr>
<th>9</th>
      <td>Congo, Democratic Republic of</td>
      <td>Congo</td>
    </tr>
<tr>
<th>10</th>
      <td>Congo, Republic of</td>
      <td>Congo</td>
    </tr>
<tr>
<th>11</th>
      <td>Czech Republic</td>
      <td>Czech Republic</td>
    </tr>
<tr>
<th>12</th>
      <td>Eswatini, Kingdom of</td>
      <td>Eswatini</td>
    </tr>
<tr>
<th>13</th>
      <td>French Territories: New Caledonia</td>
      <td>French Territories: New Caledonia</td>
    </tr>
<tr>
<th>14</th>
      <td>Gambia, The</td>
      <td>Gambia</td>
    </tr>
<tr>
<th>15</th>
      <td>Iran, Islamic Republic of</td>
      <td>Iran</td>
    </tr>
<tr>
<th>16</th>
      <td>Kosovo, Republic of</td>
      <td>Kosovo</td>
    </tr>
<tr>
<th>17</th>
      <td>Kyrgyz Republic</td>
      <td>Kyrgyz Republic</td>
    </tr>
<tr>
<th>18</th>
      <td>Macedonia, FYR</td>
      <td>Macedonia</td>
    </tr>
<tr>
<th>19</th>
      <td>Micronesia, Federated States of</td>
      <td>Micronesia</td>
    </tr>
<tr>
<th>20</th>
      <td>Moldova</td>
      <td>Moldova</td>
    </tr>
<tr>
<th>21</th>
      <td>São Tomé and Príncipe</td>
      <td>São Tomé and Príncipe</td>
    </tr>
<tr>
<th>22</th>
      <td>Serbia, Republic of</td>
      <td>Serbia</td>
    </tr>
<tr>
<th>23</th>
      <td>Sint Maarten</td>
      <td>Sint Maarten</td>
    </tr>
<tr>
<th>24</th>
      <td>Slovak Republic</td>
      <td>Slovak Republic</td>
    </tr>
<tr>
<th>25</th>
      <td>St. Kitts and Nevis</td>
      <td>St. Kitts and Nevis</td>
    </tr>
<tr>
<th>26</th>
      <td>St. Lucia</td>
      <td>St. Lucia</td>
    </tr>
<tr>
<th>27</th>
      <td>St. Vincent and the Grenadines</td>
      <td>St. Vincent and the Grenadines</td>
    </tr>
<tr>
<th>28</th>
      <td>Tanzania</td>
      <td>Tanzania</td>
    </tr>
<tr>
<th>29</th>
      <td>Timor-Leste, Dem. Rep. of</td>
      <td>Timor-Leste</td>
    </tr>
<tr>
<th>30</th>
      <td>United Kingdom</td>
      <td>United Kingdom</td>
    </tr>
<tr>
<th>31</th>
      <td>United States</td>
      <td>United States</td>
    </tr>
<tr>
<th>32</th>
      <td>Venezuela, Republica Bolivariana de</td>
      <td>Venezuela</td>
    </tr>
<tr>
<th>33</th>
      <td>Vietnam</td>
      <td>Vietnam</td>
    </tr>
<tr>
<th>34</th>
      <td>West Bank and Gaza</td>
      <td>West Bank and Gaza</td>
    </tr>
<tr>
<th>35</th>
      <td>Yemen, Republic of</td>
      <td>Yemen</td>
    </tr>
<tr>
<th>36</th>
      <td>Netherlands Antilles</td>
      <td>Netherlands Antilles</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now I probably will get a match on for example Afghanistan, but many of the countries in the missing dataframe did not have a comma, hence I will not find a match for them. To solve this problem I will use <a href="https://docs.python.org/3/library/difflib.html">difflib</a> and the method <em>get_close_matches</em>. This method returns a list of the best “good enough” matches.  A good explanation of this method can be found at <a href="https://stackoverflow.com/questions/13636848/is-it-possible-to-do-fuzzy-match-merge-with-python-pandas">stackoverflow</a>.</p>
<p>I will only use the first match from the <em>get_close_matches</em> list, i.e. the best match. Then I map this a new column, country3, in the <em>missing</em> dataframe.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">difflib</span>

<span class="n">matches</span> <span class="o">=</span> <span class="n">missing</span><span class="p">[</span><span class="s2">"country2"</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">difflib</span><span class="o">.</span><span class="n">get_close_matches</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">region</span><span class="p">[</span><span class="s1">'country'</span><span class="p">]))</span>
<span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span><span class="o">!=</span><span class="p">[]</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>
<span class="n">matches</span>

<span class="n">missing</span><span class="p">[</span><span class="s2">"country3"</span><span class="p">]</span> <span class="o">=</span> <span class="n">matches</span>
<span class="n">print2</span><span class="p">(</span><span class="s2">"Countries with no match v3:"</span><span class="p">)</span>
<span class="n">missing</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>['Afghanistan',
 'Armenia',
 'Azerbaijan',
 'Bahamas',
 'Bahrain',
 nan,
 'China',
 'China',
 'China',
 'Congo',
 'Congo',
 'Central African Republic',
 'Eswatini',
 'French Southern Territories',
 'Gambia',
 'Iraq',
 nan,
 'Korea, Republic of',
 'North Macedonia',
 'Indonesia',
 nan,
 'Sao Tome and Principe',
 'Serbia',
 'Sint Maarten (Dutch part)',
 'Moldova, Republic of',
 'Saint Kitts and Nevis',
 'Saint Lucia',
 'Saint Vincent and the Grenadines',
 nan,
 'Timor-Leste',
 nan,
 'United States of America',
 nan,
 'Viet Nam',
 nan,
 'Yemen',
 'Netherlands']</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Countries with no match v3:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[13]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>country2</th>
      <th>country3</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>Afghanistan, Islamic Republic of</td>
      <td>Afghanistan</td>
      <td>Afghanistan</td>
    </tr>
<tr>
<th>1</th>
      <td>Armenia, Republic of</td>
      <td>Armenia</td>
      <td>Armenia</td>
    </tr>
<tr>
<th>2</th>
      <td>Azerbaijan, Republic of</td>
      <td>Azerbaijan</td>
      <td>Azerbaijan</td>
    </tr>
<tr>
<th>3</th>
      <td>Bahamas, The</td>
      <td>Bahamas</td>
      <td>Bahamas</td>
    </tr>
<tr>
<th>4</th>
      <td>Bahrain, Kingdom of</td>
      <td>Bahrain</td>
      <td>Bahrain</td>
    </tr>
<tr>
<th>5</th>
      <td>Bolivia</td>
      <td>Bolivia</td>
      <td>NaN</td>
    </tr>
<tr>
<th>6</th>
      <td>China, P.R.: Hong Kong</td>
      <td>China</td>
      <td>China</td>
    </tr>
<tr>
<th>7</th>
      <td>China, P.R.: Macao</td>
      <td>China</td>
      <td>China</td>
    </tr>
<tr>
<th>8</th>
      <td>China, P.R.: Mainland</td>
      <td>China</td>
      <td>China</td>
    </tr>
<tr>
<th>9</th>
      <td>Congo, Democratic Republic of</td>
      <td>Congo</td>
      <td>Congo</td>
    </tr>
<tr>
<th>10</th>
      <td>Congo, Republic of</td>
      <td>Congo</td>
      <td>Congo</td>
    </tr>
<tr>
<th>11</th>
      <td>Czech Republic</td>
      <td>Czech Republic</td>
      <td>Central African Republic</td>
    </tr>
<tr>
<th>12</th>
      <td>Eswatini, Kingdom of</td>
      <td>Eswatini</td>
      <td>Eswatini</td>
    </tr>
<tr>
<th>13</th>
      <td>French Territories: New Caledonia</td>
      <td>French Territories: New Caledonia</td>
      <td>French Southern Territories</td>
    </tr>
<tr>
<th>14</th>
      <td>Gambia, The</td>
      <td>Gambia</td>
      <td>Gambia</td>
    </tr>
<tr>
<th>15</th>
      <td>Iran, Islamic Republic of</td>
      <td>Iran</td>
      <td>Iraq</td>
    </tr>
<tr>
<th>16</th>
      <td>Kosovo, Republic of</td>
      <td>Kosovo</td>
      <td>NaN</td>
    </tr>
<tr>
<th>17</th>
      <td>Kyrgyz Republic</td>
      <td>Kyrgyz Republic</td>
      <td>Korea, Republic of</td>
    </tr>
<tr>
<th>18</th>
      <td>Macedonia, FYR</td>
      <td>Macedonia</td>
      <td>North Macedonia</td>
    </tr>
<tr>
<th>19</th>
      <td>Micronesia, Federated States of</td>
      <td>Micronesia</td>
      <td>Indonesia</td>
    </tr>
<tr>
<th>20</th>
      <td>Moldova</td>
      <td>Moldova</td>
      <td>NaN</td>
    </tr>
<tr>
<th>21</th>
      <td>São Tomé and Príncipe</td>
      <td>São Tomé and Príncipe</td>
      <td>Sao Tome and Principe</td>
    </tr>
<tr>
<th>22</th>
      <td>Serbia, Republic of</td>
      <td>Serbia</td>
      <td>Serbia</td>
    </tr>
<tr>
<th>23</th>
      <td>Sint Maarten</td>
      <td>Sint Maarten</td>
      <td>Sint Maarten (Dutch part)</td>
    </tr>
<tr>
<th>24</th>
      <td>Slovak Republic</td>
      <td>Slovak Republic</td>
      <td>Moldova, Republic of</td>
    </tr>
<tr>
<th>25</th>
      <td>St. Kitts and Nevis</td>
      <td>St. Kitts and Nevis</td>
      <td>Saint Kitts and Nevis</td>
    </tr>
<tr>
<th>26</th>
      <td>St. Lucia</td>
      <td>St. Lucia</td>
      <td>Saint Lucia</td>
    </tr>
<tr>
<th>27</th>
      <td>St. Vincent and the Grenadines</td>
      <td>St. Vincent and the Grenadines</td>
      <td>Saint Vincent and the Grenadines</td>
    </tr>
<tr>
<th>28</th>
      <td>Tanzania</td>
      <td>Tanzania</td>
      <td>NaN</td>
    </tr>
<tr>
<th>29</th>
      <td>Timor-Leste, Dem. Rep. of</td>
      <td>Timor-Leste</td>
      <td>Timor-Leste</td>
    </tr>
<tr>
<th>30</th>
      <td>United Kingdom</td>
      <td>United Kingdom</td>
      <td>NaN</td>
    </tr>
<tr>
<th>31</th>
      <td>United States</td>
      <td>United States</td>
      <td>United States of America</td>
    </tr>
<tr>
<th>32</th>
      <td>Venezuela, Republica Bolivariana de</td>
      <td>Venezuela</td>
      <td>NaN</td>
    </tr>
<tr>
<th>33</th>
      <td>Vietnam</td>
      <td>Vietnam</td>
      <td>Viet Nam</td>
    </tr>
<tr>
<th>34</th>
      <td>West Bank and Gaza</td>
      <td>West Bank and Gaza</td>
      <td>NaN</td>
    </tr>
<tr>
<th>35</th>
      <td>Yemen, Republic of</td>
      <td>Yemen</td>
      <td>Yemen</td>
    </tr>
<tr>
<th>36</th>
      <td>Netherlands Antilles</td>
      <td>Netherlands Antilles</td>
      <td>Netherlands</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now it looks pretty good. But it is not perfect. There are some errors (e.g. is the Czech Republic not the same as the Central African Republic), I set these errors as NaN. Then I create a new dataframe called corrected which contains all corrected countries. I then overwrite the missing dataframe with the countries that do have NaN in the country3 column.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">36</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_index</span><span class="p">:</span>
    <span class="n">missing</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">corrected</span> <span class="o">=</span> <span class="n">missing</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"any"</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">missing</span> <span class="o">=</span> <span class="n">missing</span><span class="p">[</span><span class="n">missing</span><span class="p">[</span><span class="s2">"country3"</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">print2</span><span class="p">(</span><span class="s2">"Corrected:"</span><span class="p">)</span>
<span class="n">corrected</span>
<span class="n">print2</span><span class="p">(</span><span class="s2">"Countries with no match v4:"</span><span class="p">)</span>
<span class="n">missing</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Corrected:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[14]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>country2</th>
      <th>country3</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>Afghanistan, Islamic Republic of</td>
      <td>Afghanistan</td>
      <td>Afghanistan</td>
    </tr>
<tr>
<th>1</th>
      <td>Armenia, Republic of</td>
      <td>Armenia</td>
      <td>Armenia</td>
    </tr>
<tr>
<th>2</th>
      <td>Azerbaijan, Republic of</td>
      <td>Azerbaijan</td>
      <td>Azerbaijan</td>
    </tr>
<tr>
<th>3</th>
      <td>Bahamas, The</td>
      <td>Bahamas</td>
      <td>Bahamas</td>
    </tr>
<tr>
<th>4</th>
      <td>Bahrain, Kingdom of</td>
      <td>Bahrain</td>
      <td>Bahrain</td>
    </tr>
<tr>
<th>6</th>
      <td>China, P.R.: Hong Kong</td>
      <td>China</td>
      <td>China</td>
    </tr>
<tr>
<th>7</th>
      <td>China, P.R.: Macao</td>
      <td>China</td>
      <td>China</td>
    </tr>
<tr>
<th>8</th>
      <td>China, P.R.: Mainland</td>
      <td>China</td>
      <td>China</td>
    </tr>
<tr>
<th>9</th>
      <td>Congo, Democratic Republic of</td>
      <td>Congo</td>
      <td>Congo</td>
    </tr>
<tr>
<th>10</th>
      <td>Congo, Republic of</td>
      <td>Congo</td>
      <td>Congo</td>
    </tr>
<tr>
<th>12</th>
      <td>Eswatini, Kingdom of</td>
      <td>Eswatini</td>
      <td>Eswatini</td>
    </tr>
<tr>
<th>13</th>
      <td>French Territories: New Caledonia</td>
      <td>French Territories: New Caledonia</td>
      <td>French Southern Territories</td>
    </tr>
<tr>
<th>14</th>
      <td>Gambia, The</td>
      <td>Gambia</td>
      <td>Gambia</td>
    </tr>
<tr>
<th>21</th>
      <td>São Tomé and Príncipe</td>
      <td>São Tomé and Príncipe</td>
      <td>Sao Tome and Principe</td>
    </tr>
<tr>
<th>22</th>
      <td>Serbia, Republic of</td>
      <td>Serbia</td>
      <td>Serbia</td>
    </tr>
<tr>
<th>23</th>
      <td>Sint Maarten</td>
      <td>Sint Maarten</td>
      <td>Sint Maarten (Dutch part)</td>
    </tr>
<tr>
<th>24</th>
      <td>Slovak Republic</td>
      <td>Slovak Republic</td>
      <td>Moldova, Republic of</td>
    </tr>
<tr>
<th>25</th>
      <td>St. Kitts and Nevis</td>
      <td>St. Kitts and Nevis</td>
      <td>Saint Kitts and Nevis</td>
    </tr>
<tr>
<th>26</th>
      <td>St. Lucia</td>
      <td>St. Lucia</td>
      <td>Saint Lucia</td>
    </tr>
<tr>
<th>27</th>
      <td>St. Vincent and the Grenadines</td>
      <td>St. Vincent and the Grenadines</td>
      <td>Saint Vincent and the Grenadines</td>
    </tr>
<tr>
<th>29</th>
      <td>Timor-Leste, Dem. Rep. of</td>
      <td>Timor-Leste</td>
      <td>Timor-Leste</td>
    </tr>
<tr>
<th>31</th>
      <td>United States</td>
      <td>United States</td>
      <td>United States of America</td>
    </tr>
<tr>
<th>33</th>
      <td>Vietnam</td>
      <td>Vietnam</td>
      <td>Viet Nam</td>
    </tr>
<tr>
<th>35</th>
      <td>Yemen, Republic of</td>
      <td>Yemen</td>
      <td>Yemen</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Countries with no match v4:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[14]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>country2</th>
      <th>country3</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>Bolivia</td>
      <td>Bolivia</td>
      <td>NaN</td>
    </tr>
<tr>
<th>1</th>
      <td>Czech Republic</td>
      <td>Czech Republic</td>
      <td>NaN</td>
    </tr>
<tr>
<th>2</th>
      <td>Iran, Islamic Republic of</td>
      <td>Iran</td>
      <td>NaN</td>
    </tr>
<tr>
<th>3</th>
      <td>Kosovo, Republic of</td>
      <td>Kosovo</td>
      <td>NaN</td>
    </tr>
<tr>
<th>4</th>
      <td>Kyrgyz Republic</td>
      <td>Kyrgyz Republic</td>
      <td>NaN</td>
    </tr>
<tr>
<th>5</th>
      <td>Macedonia, FYR</td>
      <td>Macedonia</td>
      <td>NaN</td>
    </tr>
<tr>
<th>6</th>
      <td>Micronesia, Federated States of</td>
      <td>Micronesia</td>
      <td>NaN</td>
    </tr>
<tr>
<th>7</th>
      <td>Moldova</td>
      <td>Moldova</td>
      <td>NaN</td>
    </tr>
<tr>
<th>8</th>
      <td>Tanzania</td>
      <td>Tanzania</td>
      <td>NaN</td>
    </tr>
<tr>
<th>9</th>
      <td>United Kingdom</td>
      <td>United Kingdom</td>
      <td>NaN</td>
    </tr>
<tr>
<th>10</th>
      <td>Venezuela, Republica Bolivariana de</td>
      <td>Venezuela</td>
      <td>NaN</td>
    </tr>
<tr>
<th>11</th>
      <td>West Bank and Gaza</td>
      <td>West Bank and Gaza</td>
      <td>NaN</td>
    </tr>
<tr>
<th>12</th>
      <td>Netherlands Antilles</td>
      <td>Netherlands Antilles</td>
      <td>NaN</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are only 13 countries left. Below I try to find a match using the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.contains.html">contains</a> method from pandas. This method works similarly to the <strong>LIKE</strong> keyword in SQL. I will only use the first 8 letters in the country column. Why 8? Well, because I got the best result this way :). I create a new dictionary where I set the key to the country from the country column in missing and the value to the mactched country. If there is no match, NaN is set as value.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mapping</span> <span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">[</span><span class="s2">"country"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="n">_i</span> <span class="o">=</span> <span class="n">i</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"country.str.contains(@_i)"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"python"</span><span class="p">)[[</span><span class="s2">"country"</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
<span class="n">mapping</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[15]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>{'Bolivia': 'Bolivia (Plurinational State of)',
 'Czech Republic': nan,
 'Iran, Islamic Republic of': nan,
 'Kosovo, Republic of': nan,
 'Kyrgyz Republic': nan,
 'Macedonia, FYR': 'North Macedonia',
 'Micronesia, Federated States of': 'Micronesia (Federated States of)',
 'Moldova': 'Moldova, Republic of',
 'Tanzania': 'Tanzania, United Republic of',
 'United Kingdom': 'United Kingdom of Great Britain and Northern Ireland',
 'Venezuela, Republica Bolivariana de': 'Venezuela (Bolivarian Republic of)',
 'West Bank and Gaza': nan,
 'Netherlands Antilles': 'Netherlands'}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now there is only 5 countries with no match (inlcuding Netherlands Antilles, that is not situated in the Netherlands. I correct these countries manuallaly by searching for a substring in the region dataframe.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">print2</span><span class="p">(</span><span class="s2">"Czech Republic"</span><span class="p">)</span>
<span class="n">region</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"country.str.slice(0,3) == 'Cze'"</span><span class="p">)</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Iran"</span><span class="p">)</span>
<span class="n">region</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"country.str.contains('Iran')"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"python"</span><span class="p">)</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Kosovo"</span><span class="p">)</span>
<span class="n">region</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"country.str.contains('Koso')"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"python"</span><span class="p">)</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Kyrgyz Republic"</span><span class="p">)</span>
<span class="n">region</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"country.str.contains('Kyrg')"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"python"</span><span class="p">)</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"West Bank and Gaza"</span><span class="p">)</span>
<span class="n">region</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"country.str.contains('Gaza')"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"python"</span><span class="p">)</span>
<span class="n">region</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"country.str.contains('Bank')"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"python"</span><span class="p">)</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Antilles"</span><span class="p">)</span>
<span class="n">region</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"country.str.slice(0,3) == 'Ant'"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Czech Republic</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[16]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>region</th>
      <th>sub-region</th>
    </tr></thead>
<tbody><tr>
<th>59</th>
      <td>Czechia</td>
      <td>Europe</td>
      <td>Eastern Europe</td>
    </tr></tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Iran</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[16]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>region</th>
      <th>sub-region</th>
    </tr></thead>
<tbody><tr>
<th>105</th>
      <td>Iran (Islamic Republic of)</td>
      <td>Asia</td>
      <td>Southern Asia</td>
    </tr></tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Kosovo</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[16]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>region</th>
      <th>sub-region</th>
    </tr></thead>
<tbody></tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Kyrgyz Republic</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[16]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>region</th>
      <th>sub-region</th>
    </tr></thead>
<tbody><tr>
<th>121</th>
      <td>Kyrgyzstan</td>
      <td>Asia</td>
      <td>Central Asia</td>
    </tr></tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">West Bank and Gaza</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[16]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>region</th>
      <th>sub-region</th>
    </tr></thead>
<tbody></tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[16]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>region</th>
      <th>sub-region</th>
    </tr></thead>
<tbody></tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Antilles</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[16]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>region</th>
      <th>sub-region</th>
    </tr></thead>
<tbody>
<tr>
<th>8</th>
      <td>Antarctica</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>9</th>
      <td>Antigua and Barbuda</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Based on the result above I manually set the value of the mapping dictionary.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mapping</span><span class="p">[</span><span class="s2">"Czech Republic"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Czechia"</span>
<span class="n">mapping</span><span class="p">[</span><span class="s2">"Iran, Islamic Republic of"</span><span class="p">]</span><span class="o">=</span> <span class="s2">"Iran (Islamic Republic of)"</span>
<span class="n">mapping</span><span class="p">[</span><span class="s2">"Macedonia, FYR"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"North Macedonia"</span>
<span class="n">mapping</span><span class="p">[</span><span class="s2">"Kyrgyz Republic"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Kyrgyzstan"</span>

<span class="n">mapping</span><span class="p">[</span><span class="s2">"Netherlands Antilles"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">mapping</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[17]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>{'Bolivia': 'Bolivia (Plurinational State of)',
 'Czech Republic': 'Czechia',
 'Iran, Islamic Republic of': 'Iran (Islamic Republic of)',
 'Kosovo, Republic of': nan,
 'Kyrgyz Republic': 'Kyrgyzstan',
 'Macedonia, FYR': 'North Macedonia',
 'Micronesia, Federated States of': 'Micronesia (Federated States of)',
 'Moldova': 'Moldova, Republic of',
 'Tanzania': 'Tanzania, United Republic of',
 'United Kingdom': 'United Kingdom of Great Britain and Northern Ireland',
 'Venezuela, Republica Bolivariana de': 'Venezuela (Bolivarian Republic of)',
 'West Bank and Gaza': nan,
 'Netherlands Antilles': nan}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now only Kosovo and West Bank and Gaza have missing values. I know that Kosovo is a neighbor to Serbia, and West Bank is a neighbor to Israel, so I set these countries as values. This can be done since I will use this value as a key when joining the financial_data and region dataframes.</p>
<p>Then I use the <em>mapping</em> dictionary to map the countries in the missing dataframe and append these to the corrected dataframe.</p>
<p>Then, to get correct regions in the region dataframe, I merge the corrected dataframe with the region dataframe. Since I previously dropped countries with no matching keys from the region dataframe I can append the corrected dataframe to the region dataframe.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">region</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"country=='Israel' | country=='Serbia'"</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

<span class="n">mapping</span><span class="p">[</span><span class="s1">'West Bank and Gaza'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Israel"</span>
<span class="n">mapping</span><span class="p">[</span><span class="s2">"Kosovo, Republic of"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Serbia"</span>

<span class="n">missing</span><span class="p">[</span><span class="s2">"country3"</span><span class="p">]</span> <span class="o">=</span> <span class="n">missing</span><span class="p">[</span><span class="s2">"country"</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>

<span class="n">corrected</span> <span class="o">=</span> <span class="n">corrected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>

<span class="n">corrected</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">corrected</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">"country3"</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">"country"</span><span class="p">)</span>
             <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">"country_y"</span><span class="p">,</span> <span class="s2">"country2"</span><span class="p">,</span> <span class="s2">"country3"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
             <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"country_x"</span><span class="p">:</span><span class="s2">"country"</span><span class="p">})</span>
            <span class="p">)</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corrected</span><span class="p">)</span>

<span class="n">region</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span> <span class="c1"># ändra denna så den kollar om det är duplicates</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[18]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>region</th>
      <th>sub-region</th>
    </tr></thead>
<tbody>
<tr>
<th>109</th>
      <td>Israel</td>
      <td>Asia</td>
      <td>Western Asia</td>
    </tr>
<tr>
<th>197</th>
      <td>Serbia</td>
      <td>Europe</td>
      <td>Southern Europe</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[18]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>region</th>
      <th>sub-region</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>Afghanistan</td>
      <td>Asia</td>
      <td>Southern Asia</td>
    </tr>
<tr>
<th>1</th>
      <td>Åland Islands</td>
      <td>Europe</td>
      <td>Northern Europe</td>
    </tr>
<tr>
<th>2</th>
      <td>Albania</td>
      <td>Europe</td>
      <td>Southern Europe</td>
    </tr>
<tr>
<th>3</th>
      <td>Algeria</td>
      <td>Africa</td>
      <td>Northern Africa</td>
    </tr>
<tr>
<th>4</th>
      <td>American Samoa</td>
      <td>Oceania</td>
      <td>Polynesia</td>
    </tr>
<tr>
<th>5</th>
      <td>Andorra</td>
      <td>Europe</td>
      <td>Southern Europe</td>
    </tr>
<tr>
<th>6</th>
      <td>Angola</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>7</th>
      <td>Anguilla</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>8</th>
      <td>Antarctica</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>9</th>
      <td>Antigua and Barbuda</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>10</th>
      <td>Argentina</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>11</th>
      <td>Armenia</td>
      <td>Asia</td>
      <td>Western Asia</td>
    </tr>
<tr>
<th>12</th>
      <td>Aruba</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>13</th>
      <td>Australia</td>
      <td>Oceania</td>
      <td>Australia and New Zealand</td>
    </tr>
<tr>
<th>14</th>
      <td>Austria</td>
      <td>Europe</td>
      <td>Western Europe</td>
    </tr>
<tr>
<th>15</th>
      <td>Azerbaijan</td>
      <td>Asia</td>
      <td>Western Asia</td>
    </tr>
<tr>
<th>16</th>
      <td>Bahamas</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>17</th>
      <td>Bahrain</td>
      <td>Asia</td>
      <td>Western Asia</td>
    </tr>
<tr>
<th>18</th>
      <td>Bangladesh</td>
      <td>Asia</td>
      <td>Southern Asia</td>
    </tr>
<tr>
<th>19</th>
      <td>Barbados</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>20</th>
      <td>Belarus</td>
      <td>Europe</td>
      <td>Eastern Europe</td>
    </tr>
<tr>
<th>21</th>
      <td>Belgium</td>
      <td>Europe</td>
      <td>Western Europe</td>
    </tr>
<tr>
<th>22</th>
      <td>Belize</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>23</th>
      <td>Benin</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>24</th>
      <td>Bermuda</td>
      <td>Americas</td>
      <td>Northern America</td>
    </tr>
<tr>
<th>25</th>
      <td>Bhutan</td>
      <td>Asia</td>
      <td>Southern Asia</td>
    </tr>
<tr>
<th>26</th>
      <td>Bolivia (Plurinational State of)</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>27</th>
      <td>Bonaire, Sint Eustatius and Saba</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>28</th>
      <td>Bosnia and Herzegovina</td>
      <td>Europe</td>
      <td>Southern Europe</td>
    </tr>
<tr>
<th>29</th>
      <td>Botswana</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
<tr>
<th>6</th>
      <td>China, P.R.: Macao</td>
      <td>Asia</td>
      <td>Eastern Asia</td>
    </tr>
<tr>
<th>7</th>
      <td>China, P.R.: Mainland</td>
      <td>Asia</td>
      <td>Eastern Asia</td>
    </tr>
<tr>
<th>8</th>
      <td>Congo, Democratic Republic of</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>9</th>
      <td>Congo, Republic of</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>10</th>
      <td>Eswatini, Kingdom of</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>11</th>
      <td>French Territories: New Caledonia</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>12</th>
      <td>Gambia, The</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>13</th>
      <td>São Tomé and Príncipe</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>14</th>
      <td>Serbia, Republic of</td>
      <td>Europe</td>
      <td>Southern Europe</td>
    </tr>
<tr>
<th>15</th>
      <td>Kosovo, Republic of</td>
      <td>Europe</td>
      <td>Southern Europe</td>
    </tr>
<tr>
<th>16</th>
      <td>Sint Maarten</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>17</th>
      <td>Slovak Republic</td>
      <td>Europe</td>
      <td>Eastern Europe</td>
    </tr>
<tr>
<th>18</th>
      <td>Moldova</td>
      <td>Europe</td>
      <td>Eastern Europe</td>
    </tr>
<tr>
<th>19</th>
      <td>St. Kitts and Nevis</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>20</th>
      <td>St. Lucia</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>21</th>
      <td>St. Vincent and the Grenadines</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>22</th>
      <td>Timor-Leste, Dem. Rep. of</td>
      <td>Asia</td>
      <td>South-eastern Asia</td>
    </tr>
<tr>
<th>23</th>
      <td>United States</td>
      <td>Americas</td>
      <td>Northern America</td>
    </tr>
<tr>
<th>24</th>
      <td>Vietnam</td>
      <td>Asia</td>
      <td>South-eastern Asia</td>
    </tr>
<tr>
<th>25</th>
      <td>Yemen, Republic of</td>
      <td>Asia</td>
      <td>Western Asia</td>
    </tr>
<tr>
<th>26</th>
      <td>Bolivia</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>27</th>
      <td>Czech Republic</td>
      <td>Europe</td>
      <td>Eastern Europe</td>
    </tr>
<tr>
<th>28</th>
      <td>Iran, Islamic Republic of</td>
      <td>Asia</td>
      <td>Southern Asia</td>
    </tr>
<tr>
<th>29</th>
      <td>Kyrgyz Republic</td>
      <td>Asia</td>
      <td>Central Asia</td>
    </tr>
<tr>
<th>30</th>
      <td>Macedonia, FYR</td>
      <td>Europe</td>
      <td>Southern Europe</td>
    </tr>
<tr>
<th>31</th>
      <td>Micronesia, Federated States of</td>
      <td>Oceania</td>
      <td>Micronesia</td>
    </tr>
<tr>
<th>32</th>
      <td>Tanzania</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>33</th>
      <td>United Kingdom</td>
      <td>Europe</td>
      <td>Northern Europe</td>
    </tr>
<tr>
<th>34</th>
      <td>Venezuela, Republica Bolivariana de</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>35</th>
      <td>West Bank and Gaza</td>
      <td>Asia</td>
      <td>Western Asia</td>
    </tr>
</tbody>
</table>
<p>285 rows × 3 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now the region dataframe is cleaned. I join the financial dataframe with the region dataframe. Then I control that there are no missing countries. As can be seen below there are none.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">financial_data2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">financial_data</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">"country"</span><span class="p">)</span>

<span class="n">print2</span><span class="p">(</span><span class="s2">"Countries with no match in region dataframe:"</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">financial_data2</span><span class="o">.</span><span class="n">country</span><span class="p">[</span><span class="n">financial_data2</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">financial_data2</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>


<span class="ansi-black-intense-fg ansi-white-bg ansi-bold">Countries with no match in region dataframe:</span>

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[19]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>0</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>Advanced Economies</td>
    </tr>
<tr>
<th>1</th>
      <td>CIS</td>
    </tr>
<tr>
<th>2</th>
      <td>Emerging and Developing Asia</td>
    </tr>
<tr>
<th>3</th>
      <td>Emerging and Developing Countries</td>
    </tr>
<tr>
<th>4</th>
      <td>Emerging and Developing Europe</td>
    </tr>
<tr>
<th>5</th>
      <td>Europe</td>
    </tr>
<tr>
<th>6</th>
      <td>Middle East, North Africa, Afghanistan, and Pa...</td>
    </tr>
<tr>
<th>7</th>
      <td>Sub-Saharan Africa</td>
    </tr>
<tr>
<th>8</th>
      <td>Western Hemisphere</td>
    </tr>
<tr>
<th>9</th>
      <td>World</td>
    </tr>
<tr>
<th>10</th>
      <td>Euro Area</td>
    </tr>
<tr>
<th>11</th>
      <td>Netherlands Antilles</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[19]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>kpi</th>
      <th>year</th>
      <th>period</th>
      <th>time_period</th>
      <th>value</th>
      <th>region</th>
      <th>sub-region</th>
    </tr></thead>
<tbody>
<tr>
<th>53937</th>
      <td>France</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>2018</td>
      <td>07</td>
      <td>month</td>
      <td>109.042918</td>
      <td>Europe</td>
      <td>Western Europe</td>
    </tr>
<tr>
<th>27450</th>
      <td>Nicaragua</td>
      <td>prices_producer_price_index_all_commodities_index</td>
      <td>2015</td>
      <td>07</td>
      <td>month</td>
      <td>151.984147</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>43605</th>
      <td>Brunei Darussalam</td>
      <td>prices_consumer_price_index_all_items_index</td>
      <td>2017</td>
      <td>03</td>
      <td>month</td>
      <td>99.253150</td>
      <td>Asia</td>
      <td>South-eastern Asia</td>
    </tr>
<tr>
<th>47236</th>
      <td>Montenegro</td>
      <td>economic_activity_industrial_production_index</td>
      <td>2017</td>
      <td>07</td>
      <td>month</td>
      <td>86.489667</td>
      <td>Europe</td>
      <td>Southern Europe</td>
    </tr>
<tr>
<th>3102</th>
      <td>Canada</td>
      <td>financial_market_prices_equities_end_of_period...</td>
      <td>2013</td>
      <td>03</td>
      <td>month</td>
      <td>94.842605</td>
      <td>Americas</td>
      <td>Northern America</td>
    </tr>
<tr>
<th>16401</th>
      <td>Ireland</td>
      <td>economic_activity_industrial_production_index</td>
      <td>2014</td>
      <td>3</td>
      <td>quarter</td>
      <td>114.257145</td>
      <td>Europe</td>
      <td>Northern Europe</td>
    </tr>
<tr>
<th>46154</th>
      <td>Euro Area</td>
      <td>unemployment_persons_number_of</td>
      <td>2017</td>
      <td>06</td>
      <td>month</td>
      <td>14114.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>375</th>
      <td>Trinidad and Tobago</td>
      <td>labor_force_persons_number_of</td>
      <td>2013</td>
      <td>NaN</td>
      <td>year</td>
      <td>650.150000</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
    </tr>
<tr>
<th>692</th>
      <td>Tunisia</td>
      <td>labor_markets_unemployment_rate_percent</td>
      <td>2013</td>
      <td>NaN</td>
      <td>year</td>
      <td>15.844975</td>
      <td>Africa</td>
      <td>Northern Africa</td>
    </tr>
<tr>
<th>53527</th>
      <td>United States</td>
      <td>labor_force_persons_number_of</td>
      <td>2018</td>
      <td>06</td>
      <td>month</td>
      <td>163277.000000</td>
      <td>Americas</td>
      <td>Northern America</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now I need to spread the financial dataframe to get all the kpis in separate columns. Also, I only use the time period month.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imf</span> <span class="o">=</span> <span class="p">(</span><span class="n">spread</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">financial_data2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"kpi"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">"value"</span><span class="p">,</span> <span class="n">convert</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
       <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"time_period=='month'"</span><span class="p">)</span>
       <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">"time_period"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
       <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">imf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">"year_period"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">imf</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="s2">"-"</span> <span class="o">+</span>  <span class="n">imf</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>

<span class="n">imf</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[20]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>country</th>
      <th>year</th>
      <th>period</th>
      <th>year_period</th>
      <th>region</th>
      <th>sub-region</th>
      <th>economic_activity_industrial_production_index</th>
      <th>employment_persons_number_of</th>
      <th>financial_market_prices_equities_end_of_period_index</th>
      <th>labor_force_persons_number_of</th>
      <th>labor_markets_unemployment_rate_percent</th>
      <th>prices_consumer_price_index_all_items_index</th>
      <th>prices_producer_price_index_all_commodities_index</th>
      <th>unemployment_persons_number_of</th>
    </tr></thead>
<tbody>
<tr>
<th>12972</th>
      <td>West Bank and Gaza</td>
      <td>2017</td>
      <td>04</td>
      <td>2017-04</td>
      <td>Asia</td>
      <td>Western Asia</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>111.984373</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>10515</th>
      <td>Sierra Leone</td>
      <td>2016</td>
      <td>12</td>
      <td>2016-12</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>162.664931</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>4100</th>
      <td>Eswatini, Kingdom of</td>
      <td>2014</td>
      <td>06</td>
      <td>2014-06</td>
      <td>Africa</td>
      <td>Sub-Saharan Africa</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>128.459869</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>4305</th>
      <td>Europe</td>
      <td>2014</td>
      <td>06</td>
      <td>2014-06</td>
      <td>nan</td>
      <td>nan</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>116.180510</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>4540</th>
      <td>France</td>
      <td>2016</td>
      <td>04</td>
      <td>2016-04</td>
      <td>Europe</td>
      <td>Western Europe</td>
      <td>102.477333</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>9.900000</td>
      <td>105.674919</td>
      <td>100.572023</td>
      <td>2911.000</td>
    </tr>
<tr>
<th>11473</th>
      <td>Suriname</td>
      <td>2013</td>
      <td>04</td>
      <td>2013-04</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>124.459491</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>214</th>
      <td>Algeria</td>
      <td>2013</td>
      <td>02</td>
      <td>2013-02</td>
      <td>Africa</td>
      <td>Northern Africa</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>117.514498</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
<tr>
<th>9405</th>
      <td>Paraguay</td>
      <td>2013</td>
      <td>05</td>
      <td>2013-05</td>
      <td>Americas</td>
      <td>Latin America and the Caribbean</td>
      <td>123.995600</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1356.143</td>
      <td>NaN</td>
      <td>113.665559</td>
      <td>114.789300</td>
      <td>NaN</td>
    </tr>
<tr>
<th>11673</th>
      <td>Switzerland</td>
      <td>2018</td>
      <td>09</td>
      <td>2018-09</td>
      <td>Europe</td>
      <td>Western Europe</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.372137</td>
      <td>99.394526</td>
      <td>94.439775</td>
      <td>106.586</td>
    </tr>
<tr>
<th>2499</th>
      <td>China, P.R.: Macao</td>
      <td>2017</td>
      <td>04</td>
      <td>2017-04</td>
      <td>Asia</td>
      <td>Eastern Asia</td>
      <td>NaN</td>
      <td>381.8</td>
      <td>NaN</td>
      <td>389.400</td>
      <td>2.000000</td>
      <td>135.269881</td>
      <td>NaN</td>
      <td>7.600</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imf</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[21]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>(13290, 14)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="4.-Save-data">4. Save data<a class="anchor-link" href="posts/python-cleaning-excel-files-from-imf/#4.-Save-data">¶</a>
</h3>
<p>I choose to save data as csv file with the pandas method <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_csv.html">to_csv</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"../../imf/clean/imf_monthly.csv"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Closing-comments">Closing comments<a class="anchor-link" href="posts/python-cleaning-excel-files-from-imf/#Closing-comments">¶</a>
</h3>
<p>Now the dataframe is tidy. In a future post, I will use R to do the same data tidying.</p>

</div>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/python-r-tsql-comparison-cleaning-data/" class="u-url">Python, R and TSQL comparison - Cleaning data</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Henric Sundberg
            </span></p>
            <p class="dateline">
            <a href="posts/python-r-tsql-comparison-cleaning-data/" rel="bookmark">
            <time class="published dt-published" datetime="2019-04-19T06:00:00Z" itemprop="datePublished" title="2019-04-19 06:00">2019-04-19 06:00</time><span class="updated"> (updated
                    <time class="dt-updated" datetime="2019-05-02T08:10:00Z" itemprop="dateUpdated" title="2019-05-02 08:10">2019-05-02 08:10</time>)</span>
            </a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>This is the third and last part of a series of posts showing data wrangling code in Python, R and TSQL. This part show different options for cleaning data.<br></p>
<p class="more"><a href="posts/python-r-tsql-comparison-cleaning-data/">Read more…</a></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/python-r-tsql-comparison-reading-and-writing-files/" class="u-url">Python, R and TSQL comparison - Reading and writing files</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Henric Sundberg
            </span></p>
            <p class="dateline">
            <a href="posts/python-r-tsql-comparison-reading-and-writing-files/" rel="bookmark">
            <time class="published dt-published" datetime="2019-03-30T00:00:00Z" itemprop="datePublished" title="2019-03-30 00:00">2019-03-30 00:00</time><span class="updated"> (updated
                    <time class="dt-updated" datetime="2019-05-05T08:10:00Z" itemprop="dateUpdated" title="2019-05-05 08:10">2019-05-05 08:10</time>)</span>
            </a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>This is the second part of a series of posts showing data wrangling code in Python, R, and TSQL. This part shows read/write options for Excel and CSV. This is not directly applicable to SQL. Therefore, there is no column for TSQL in the table below.</p>
<p class="more"><a href="posts/python-r-tsql-comparison-reading-and-writing-files/">Read more…</a></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/python-r-and-tsql-basic/" class="u-url">Python, R and TSQL - Basic</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Henric Sundberg
            </span></p>
            <p class="dateline">
            <a href="posts/python-r-and-tsql-basic/" rel="bookmark">
            <time class="published dt-published" datetime="2019-03-16T00:00:00Z" itemprop="datePublished" title="2019-03-16 00:00">2019-03-16 00:00</time><span class="updated"> (updated
                    <time class="dt-updated" datetime="2019-05-05T08:10:00Z" itemprop="dateUpdated" title="2019-05-05 08:10">2019-05-05 08:10</time>)</span>
            </a>
            </p>
        </div>
    </header><div class="p-summary entry-summary">
    <div>
<p>This is the first part of a series of articles showing data wrangling code in Python, R and TSQL that produces equivalent result. In this article I show some basic operations. <br></p>
<p class="more"><a href="posts/python-r-and-tsql-basic/">Read more…</a></p>
</div>
    </div>
    </article>
</div>





        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script><!--End of body content--><footer id="footer">
            Contents © 2019         <a href="mailto:henric.sundberg@gmail.com">Henric Sundberg</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>          - Theme          <a href="https://bootswatch.com/yeti/" rel="nofollow">Yeti</a>
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script src="assets/js/moment-with-locales.min.js"></script><!-- fancy dates --><script>
        moment.locale("en");
        fancydates(2, "YYYY-MM-DD HH:mm");
        </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
