<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>R - Cleaning excel files from the International Monetary Fund | Henric Sundberg</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://htp84.github.io/blog/posts/r-cleaning-excel-files-from-imf/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Henric Sundberg">
<link rel="prev" href="../python-cleaning-excel-files-from-imf/" title="Python - Cleaning excel files from the International Monetary Fund" type="text/html">
<meta property="og:site_name" content="Henric Sundberg">
<meta property="og:title" content="R - Cleaning excel files from the International Monetary Fund">
<meta property="og:url" content="https://htp84.github.io/blog/posts/r-cleaning-excel-files-from-imf/">
<meta property="og:description" content="Often when I browse different publically available datasets on for example Kaggle I find most of them are already tidy. Sure, to use the data for machine learning you must do feature engineering, but ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-06-29T00:00:00Z">
<meta property="article:tag" content="dplyr">
<meta property="article:tag" content="R">
<meta property="article:tag" content="tidyr">
<meta property="article:tag" content="tidyverse">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="https://htp84.github.io/blog/">

            <span id="blog-title">Henric Sundberg</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../index.html" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="../../pages/about-me/" class="nav-link">About me</a>
                </li>
<li class="nav-item">
<a href="https://github.com/htp84" class="nav-link">Github</a>
                </li>
<li class="nav-item">
<a href="https://www.linkedin.com/in/henric-sundberg-65260913b/" class="nav-link">LinkedIn</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="../../categories/index.html" class="nav-link">Tags</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">R - Cleaning excel files from the International Monetary Fund</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Henric Sundberg
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-06-29T00:00:00Z" itemprop="datePublished" title="2019-06-29 00:00">2019-06-29 00:00</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Often when I browse different publically available datasets on for example Kaggle I find most of them are already tidy. Sure, to use the data for machine learning you must do feature engineering, but most of the data cleaning is already done. I believe that this bad, since most of the data in the "real" world is messy. So, in this post, I will use R to clean messy data from the IMF data homepage (International Financial Statistics) with the ultimate goal of producing a tidy dataframe. I will use the same data as I used in the post <a href="https://htp84.github.io/blog/posts/python-cleaning-excel-files-from-imf/">Python - Cleaning excel files from the International Monetary Fund</a>. 
<!-- TEASER_END --></p>
<p>I have downloaded 8 excel files and they contain the following data:</p>
<ul>
<li>Financial Market Prices, Equities, End of Period, Index</li>
<li>Prices, Consumer Price Index, All items, Index</li>
<li>Prices, Producer Price Index, All Commodities, Index</li>
<li>Economic Activity, Industrial Production, Index</li>
<li>Labor Force, Persons, Number of</li>
<li>Unemployment, Persons, Number of</li>
<li>Employment, Persons, Number of</li>
<li>Labor Markets, Unemployment Rate, Percent</li>
</ul>
<p>The post consists of the following four parts:</p>
<ol>
<li>Setup and the first glance at a file</li>
<li>Parse and clean all files</li>
<li>Merge with external data</li>
<li>Save data</li>
</ol>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.-Setup-and-a-first-look-at-one-file">1. Setup and a first look at one file<a class="anchor-link" href="#1.-Setup-and-a-first-look-at-one-file">¶</a>
</h3>
<p>First I load the libraries I need. Below I list som examples of what I use the libraries for in this post. Follow the links to see more use cases.</p>
<ul>
<li>
<a href="https://dplyr.tidyverse.org/">dplyr</a> is used manipulate data, e.g. add new variables and select variables.</li>
<li>
<a href="https://tidyr.tidyverse.org/">tidyr</a> is used to create tidy data. </li>
<li>
<a href="https://stringr.tidyverse.org/">stringr</a> consists of functions that make working with strings as easy as possible.</li>
<li><a href="https://purrr.tidyverse.org/">purrr</a></li>
<li><a href="https://tibble.tidyverse.org/">tibble</a></li>
<li>
<a href="https://readxl.tidyverse.org/">readxl</a> makes it easy to get data out of Excel and into R.</li>
<li><a href="https://readr.tidyverse.org/">readr</a></li>
<li>
<a href="https://github.com/sfirke/janitor">janitor</a> is used to format column names.</li>
</ul>
<p>I also create a custom cat (print) function to add newlines. This is used to add explanations to output.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">purrr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tibble</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">janitor</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">catn</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
    <span class="nf">cat</span><span class="p">(</span><span class="s">"\n\n"</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s">"\n\n"</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">""</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">shape</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">df</span><span class="p">){</span>
    <span class="nf">cat</span><span class="p">(</span><span class="s">"\n\n"</span><span class="p">,</span> <span class="nf">dim</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="n">[1]</span><span class="p">,</span><span class="s">","</span><span class="p">,</span> <span class="nf">dim</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="n">[2]</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To see which excel files I have in the current directory I use the <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/list.files.html">list.files</a> function. The files are named poorly, as seen below. However, I know there is information in the files that will help to identify them. Therefore, I parse the first file in files. I view its first 10 rows using the head function.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="nf">catn</span><span class="p">(</span><span class="s">"Files:"</span><span class="p">)</span>
<span class="n">files</span> <span class="o">&lt;-</span> <span class="nf">list.files</span><span class="p">(</span><span class="n">pattern</span> <span class="o">=</span> <span class="s">"\\.xlsx$"</span><span class="p">)</span>
<span class="n">files</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Data from the first file:"</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="nf">read_excel</span><span class="p">(</span><span class="n">files[1]</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Files:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<ol class="list-inline">
<li>'Prices_Production_and_Labor (1).xlsx'</li>
	<li>'Prices_Production_and_Labor (2).xlsx'</li>
	<li>'Prices_Production_and_Labor (3).xlsx'</li>
	<li>'Prices_Production_and_Labor (4).xlsx'</li>
	<li>'Prices_Production_and_Labor (5).xlsx'</li>
	<li>'Prices_Production_and_Labor (6).xlsx'</li>
	<li>'Prices_Production_and_Labor (7).xlsx'</li>
	<li>'Prices_Production_and_Labor.xlsx'</li>
</ol>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Data from the first file:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>New names:
* `` -&gt; ...2
* `` -&gt; ...3
* `` -&gt; ...4
* `` -&gt; ...5
* `` -&gt; ...6
* … and 99 more problems
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 6 × 105</caption>
<thead>
<tr>
<th scope="col">Prices, Production and Labor selected indicators</th>
<th scope="col">...2</th>
<th scope="col">...3</th>
<th scope="col">...4</th>
<th scope="col">...5</th>
<th scope="col">...6</th>
<th scope="col">...7</th>
<th scope="col">...8</th>
<th scope="col">...9</th>
<th scope="col">...10</th>
<th scope="col">⋯</th>
<th scope="col">...96</th>
<th scope="col">...97</th>
<th scope="col">...98</th>
<th scope="col">...99</th>
<th scope="col">...100</th>
<th scope="col">...101</th>
<th scope="col">...102</th>
<th scope="col">...103</th>
<th scope="col">...104</th>
<th scope="col">...105</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">⋯</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Prices, Consumer Price Index, All items, Index  </td>
<td>getSelectionEl(0,1,"Indicator")</td>
<td>getSelectionEl(0,1,"Indicator")</td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>⋯</td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA              </td>
<td>NA              </td>
<td>NA    </td>
<td>NA                </td>
<td>NA                </td>
<td>NA     </td>
</tr>
<tr>
<td>NA                                              </td>
<td>NA                             </td>
<td>NA                             </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>⋯</td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA              </td>
<td>NA              </td>
<td>NA    </td>
<td>NA                </td>
<td>NA                </td>
<td>NA     </td>
</tr>
<tr>
<td>Source: International Financial Statistics (IFS)</td>
<td>NA                             </td>
<td>NA                             </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>⋯</td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA              </td>
<td>NA              </td>
<td>NA    </td>
<td>NA                </td>
<td>NA                </td>
<td>NA     </td>
</tr>
<tr>
<td>NA                                              </td>
<td>NA                             </td>
<td>NA                             </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>NA              </td>
<td>⋯</td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA              </td>
<td>NA              </td>
<td>NA    </td>
<td>NA                </td>
<td>NA                </td>
<td>NA     </td>
</tr>
<tr>
<td>Country                                         </td>
<td>Scale                          </td>
<td>Base Year                      </td>
<td>2013            </td>
<td>2013Q1          </td>
<td>2013M01         </td>
<td>2013M02         </td>
<td>2013M03         </td>
<td>2013Q2          </td>
<td>2013M04         </td>
<td>⋯</td>
<td>2018M05           </td>
<td>2018M06           </td>
<td>2018Q3            </td>
<td>2018M07           </td>
<td>2018M08         </td>
<td>2018M09         </td>
<td>2018Q4</td>
<td>2018M10           </td>
<td>2018M11           </td>
<td>2018M12</td>
</tr>
<tr>
<td>Afghanistan, Islamic Republic of                </td>
<td>Units                          </td>
<td>2010=100                       </td>
<td>127.795223073732</td>
<td>125.223096076787</td>
<td>125.191195214315</td>
<td>125.515928270858</td>
<td>124.962164745187</td>
<td>126.716990862207</td>
<td>126.997097858061</td>
<td>⋯</td>
<td>145.34294838289301</td>
<td>145.19114224173501</td>
<td>145.51246349769201</td>
<td>145.38508863027101</td>
<td>145.297193117007</td>
<td>145.855108745797</td>
<td>...   </td>
<td>147.25501270754501</td>
<td>148.21762074521999</td>
<td>...    </td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The interesting data starts at index 5 in the Unnamed:1 column. The first column does not include data so it is unnecessary. The row at index 5 is the header. Also, the KPI ID is at index 1 column Unnamed:1. This information is useful.</p>
<p>I will import the data again and then clean the dataframe. In the cell below I explain the purpose of every line.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">read_excel</span><span class="p">(</span><span class="n">files[1]</span><span class="p">)</span> <span class="c1"># parse the excel file</span>
<span class="n">kpi</span> <span class="o">&lt;-</span> <span class="nf">str_c</span><span class="p">(</span><span class="n">data[1</span><span class="p">,</span> <span class="m">1</span><span class="n">]</span><span class="p">)</span>  <span class="c1"># get the kpi name</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">data[</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">),</span><span class="n">]</span> <span class="c1"># get the data</span>
<span class="n">cols</span> <span class="o">&lt;-</span> <span class="n">data[5</span><span class="p">,</span><span class="n">]</span> <span class="c1"># get columnnames</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">=</span> <span class="n">cols</span> <span class="c1"># set columnnames</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">add_column</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="n">.after</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="c1"># add kpi at position 1</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Cleaned data v1 (one file) and shape:"</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nf">shape</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>New names:
* `` -&gt; ...2
* `` -&gt; ...3
* `` -&gt; ...4
* `` -&gt; ...5
* `` -&gt; ...6
* … and 99 more problems
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Cleaned data v1 (one file) and shape:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 6 × 106</caption>
<thead>
<tr>
<th scope="col">Country</th>
<th scope="col">kpi</th>
<th scope="col">Scale</th>
<th scope="col">Base Year</th>
<th scope="col">2013</th>
<th scope="col">2013Q1</th>
<th scope="col">2013M01</th>
<th scope="col">2013M02</th>
<th scope="col">2013M03</th>
<th scope="col">2013Q2</th>
<th scope="col">⋯</th>
<th scope="col">2018M05</th>
<th scope="col">2018M06</th>
<th scope="col">2018Q3</th>
<th scope="col">2018M07</th>
<th scope="col">2018M08</th>
<th scope="col">2018M09</th>
<th scope="col">2018Q4</th>
<th scope="col">2018M10</th>
<th scope="col">2018M11</th>
<th scope="col">2018M12</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">⋯</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Afghanistan, Islamic Republic of</td>
<td>Prices, Consumer Price Index, All items, Index</td>
<td>Units</td>
<td>2010=100</td>
<td>127.795223073732  </td>
<td>125.223096076787  </td>
<td>125.191195214315  </td>
<td>125.515928270858  </td>
<td>124.962164745187  </td>
<td>126.716990862207  </td>
<td>⋯</td>
<td>145.34294838289301</td>
<td>145.19114224173501</td>
<td>145.51246349769201</td>
<td>145.38508863027101</td>
<td>145.297193117007  </td>
<td>145.855108745797  </td>
<td>...               </td>
<td>147.25501270754501</td>
<td>148.21762074521999</td>
<td>...               </td>
</tr>
<tr>
<td>Albania                         </td>
<td>Prices, Consumer Price Index, All items, Index</td>
<td>Units</td>
<td>2010=100</td>
<td>107.58166295471401</td>
<td>108.46325167037899</td>
<td>107.57238307349699</td>
<td>108.79732739420901</td>
<td>109.02004454343   </td>
<td>107.943578322197  </td>
<td>⋯</td>
<td>116.843122494432  </td>
<td>116.777638084633  </td>
<td>116.844479955457  </td>
<td>116.470825167038  </td>
<td>116.896940979955  </td>
<td>117.165673719376  </td>
<td>117.18271752041601</td>
<td>116.963307349666  </td>
<td>116.67275055679301</td>
<td>117.91209465478801</td>
</tr>
<tr>
<td>Algeria                         </td>
<td>Prices, Consumer Price Index, All items, Index</td>
<td>Units</td>
<td>2010=100</td>
<td>117.52183806797299</td>
<td>117.773862830018  </td>
<td>117.69067019012   </td>
<td>117.514497540923  </td>
<td>118.11642075901101</td>
<td>117.345665418777  </td>
<td>⋯</td>
<td>149.533876532335  </td>
<td>151.15613301035   </td>
<td>148.865888570799  </td>
<td>148.25662482566301</td>
<td>148.93195331424801</td>
<td>149.409087572488  </td>
<td>...               </td>
<td>151.19283564559899</td>
<td>150.51750715701399</td>
<td>...               </td>
</tr>
<tr>
<td>Angola                          </td>
<td>Prices, Consumer Price Index, All items, Index</td>
<td>Units</td>
<td>2010=100</td>
<td>136.13117928470399</td>
<td>132.31043006940899</td>
<td>131.29906311983601</td>
<td>132.378692172749  </td>
<td>133.253534915644  </td>
<td>135.11455434111701</td>
<td>⋯</td>
<td>329.14408793675602</td>
<td>332.96174100655298</td>
<td>342.88282726555701</td>
<td>337.05145577843803</td>
<td>341.11130241019299</td>
<td>350.48572360804201</td>
<td>...               </td>
<td>355.286581821288  </td>
<td>360.20852718653498</td>
<td>...               </td>
</tr>
<tr>
<td>Anguilla                        </td>
<td>Prices, Consumer Price Index, All items, Index</td>
<td>Units</td>
<td>2010=100</td>
<td>106.355019921305  </td>
<td>106.065480462273  </td>
<td>...               </td>
<td>...               </td>
<td>...               </td>
<td>106.62971120295001</td>
<td>⋯</td>
<td>...               </td>
<td>...               </td>
<td>...               </td>
<td>...               </td>
<td>...               </td>
<td>...               </td>
<td>...               </td>
<td>...               </td>
<td>...               </td>
<td>...               </td>
</tr>
<tr>
<td>Antigua and Barbuda             </td>
<td>Prices, Consumer Price Index, All items, Index</td>
<td>Units</td>
<td>2010=100</td>
<td>108.083497160332  </td>
<td>108.14220183486201</td>
<td>108.232306684142  </td>
<td>108.346985583224  </td>
<td>107.847313237222  </td>
<td>108.073940585408  </td>
<td>⋯</td>
<td>113.83519003931799</td>
<td>113.990825688073  </td>
<td>114.05362603757099</td>
<td>113.83519003931799</td>
<td>114.162844036697  </td>
<td>114.162844036697  </td>
<td>...               </td>
<td>...               </td>
<td>...               </td>
<td>...               </td>
</tr>
</tbody>
</table>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

203,106</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As can be seen in the last row above, missing data is coded with three dots (...). This must be replaced with NaN. Also, in my opinion, the kpi column and all column names will look better if comma and spaces were replaced with underscores and if they were set to lowercase. Since I have added the kpi column I need to remove it again before renaming the columns. Otherwise, there will be a Value Error since there is a length mismatch between the cols list and the df columns. I reset the kpi column using the kpi variable set in the previous code cell. To clean the column names I use the <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html">make_clean_names and clean_names</a> functions from janitor.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="s">"kpi"</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">clean_names</span><span class="p">()</span>
<span class="n">kpi</span> <span class="o">&lt;-</span> <span class="n">kpi</span> <span class="o">%&gt;%</span> <span class="nf">make_clean_names</span><span class="p">()</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">add_column</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="n">.after</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">na_if</span><span class="p">(</span><span class="s">"..."</span><span class="p">)</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Cleaned data v2 (one file):"</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Cleaned data v2 (one file):

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 6 × 106</caption>
<thead>
<tr>
<th scope="col">country</th>
<th scope="col">kpi</th>
<th scope="col">scale</th>
<th scope="col">base_year</th>
<th scope="col">x2013</th>
<th scope="col">x2013q1</th>
<th scope="col">x2013m01</th>
<th scope="col">x2013m02</th>
<th scope="col">x2013m03</th>
<th scope="col">x2013q2</th>
<th scope="col">⋯</th>
<th scope="col">x2018m05</th>
<th scope="col">x2018m06</th>
<th scope="col">x2018q3</th>
<th scope="col">x2018m07</th>
<th scope="col">x2018m08</th>
<th scope="col">x2018m09</th>
<th scope="col">x2018q4</th>
<th scope="col">x2018m10</th>
<th scope="col">x2018m11</th>
<th scope="col">x2018m12</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">⋯</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Afghanistan, Islamic Republic of</td>
<td>prices_consumer_price_index_all_items_index</td>
<td>Units</td>
<td>2010=100</td>
<td>127.795223073732  </td>
<td>125.223096076787  </td>
<td>125.191195214315  </td>
<td>125.515928270858  </td>
<td>124.962164745187  </td>
<td>126.716990862207  </td>
<td>⋯</td>
<td>145.34294838289301</td>
<td>145.19114224173501</td>
<td>145.51246349769201</td>
<td>145.38508863027101</td>
<td>145.297193117007  </td>
<td>145.855108745797  </td>
<td>NA                </td>
<td>147.25501270754501</td>
<td>148.21762074521999</td>
<td>NA                </td>
</tr>
<tr>
<td>Albania                         </td>
<td>prices_consumer_price_index_all_items_index</td>
<td>Units</td>
<td>2010=100</td>
<td>107.58166295471401</td>
<td>108.46325167037899</td>
<td>107.57238307349699</td>
<td>108.79732739420901</td>
<td>109.02004454343   </td>
<td>107.943578322197  </td>
<td>⋯</td>
<td>116.843122494432  </td>
<td>116.777638084633  </td>
<td>116.844479955457  </td>
<td>116.470825167038  </td>
<td>116.896940979955  </td>
<td>117.165673719376  </td>
<td>117.18271752041601</td>
<td>116.963307349666  </td>
<td>116.67275055679301</td>
<td>117.91209465478801</td>
</tr>
<tr>
<td>Algeria                         </td>
<td>prices_consumer_price_index_all_items_index</td>
<td>Units</td>
<td>2010=100</td>
<td>117.52183806797299</td>
<td>117.773862830018  </td>
<td>117.69067019012   </td>
<td>117.514497540923  </td>
<td>118.11642075901101</td>
<td>117.345665418777  </td>
<td>⋯</td>
<td>149.533876532335  </td>
<td>151.15613301035   </td>
<td>148.865888570799  </td>
<td>148.25662482566301</td>
<td>148.93195331424801</td>
<td>149.409087572488  </td>
<td>NA                </td>
<td>151.19283564559899</td>
<td>150.51750715701399</td>
<td>NA                </td>
</tr>
<tr>
<td>Angola                          </td>
<td>prices_consumer_price_index_all_items_index</td>
<td>Units</td>
<td>2010=100</td>
<td>136.13117928470399</td>
<td>132.31043006940899</td>
<td>131.29906311983601</td>
<td>132.378692172749  </td>
<td>133.253534915644  </td>
<td>135.11455434111701</td>
<td>⋯</td>
<td>329.14408793675602</td>
<td>332.96174100655298</td>
<td>342.88282726555701</td>
<td>337.05145577843803</td>
<td>341.11130241019299</td>
<td>350.48572360804201</td>
<td>NA                </td>
<td>355.286581821288  </td>
<td>360.20852718653498</td>
<td>NA                </td>
</tr>
<tr>
<td>Anguilla                        </td>
<td>prices_consumer_price_index_all_items_index</td>
<td>Units</td>
<td>2010=100</td>
<td>106.355019921305  </td>
<td>106.065480462273  </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>106.62971120295001</td>
<td>⋯</td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
</tr>
<tr>
<td>Antigua and Barbuda             </td>
<td>prices_consumer_price_index_all_items_index</td>
<td>Units</td>
<td>2010=100</td>
<td>108.083497160332  </td>
<td>108.14220183486201</td>
<td>108.232306684142  </td>
<td>108.346985583224  </td>
<td>107.847313237222  </td>
<td>108.073940585408  </td>
<td>⋯</td>
<td>113.83519003931799</td>
<td>113.990825688073  </td>
<td>114.05362603757099</td>
<td>113.83519003931799</td>
<td>114.162844036697  </td>
<td>114.162844036697  </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.-Parse-and-clean-all-files">2. Parse and clean all files<a class="anchor-link" href="#2.-Parse-and-clean-all-files">¶</a>
</h3>
<p>Now the dataframe looks pretty good. But I have only imported one excel file. Let's summarise the steps above in one cell and parse all excel files. This can be done with a for loop iterating over the files list.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">financial_data</span> <span class="o">&lt;-</span> <span class="nf">tibble</span><span class="p">()</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="n">files</span><span class="p">){</span>
  <span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">read_excel</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="n">kpi</span> <span class="o">&lt;-</span> <span class="nf">str_c</span><span class="p">(</span><span class="n">data[1</span><span class="p">,</span> <span class="m">1</span><span class="n">]</span><span class="p">)</span> <span class="o">%&gt;%</span> 
    <span class="nf">make_clean_names</span><span class="p">()</span>
  <span class="n">cols</span> <span class="o">&lt;-</span> <span class="n">data[5</span><span class="p">,</span><span class="n">]</span> <span class="o">%&gt;%</span> 
    <span class="nf">make_clean_names</span><span class="p">()</span>
  <span class="nf">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">=</span> <span class="n">cols</span>
  <span class="n">df</span> <span class="o">&lt;-</span> <span class="n">data[</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">),</span><span class="n">]</span> <span class="o">%&gt;%</span> 
    <span class="nf">add_column</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="n">.after</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span> 
    <span class="nf">na_if</span><span class="p">(</span><span class="s">"..."</span><span class="p">)</span>
  <span class="n">financial_data</span> <span class="o">&lt;-</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">financial_data</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
  <span class="c1">#head(df)</span>
<span class="p">}</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">financial_data</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Cleaned data v1 (all files) and shape:"</span><span class="p">)</span>
<span class="nf">sample_n</span><span class="p">(</span><span class="n">financial_data</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
<span class="nf">shape</span><span class="p">(</span><span class="n">financial_data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>New names:
* `` -&gt; ...2
* `` -&gt; ...3
* `` -&gt; ...4
* `` -&gt; ...5
* `` -&gt; ...6
* … and 99 more problems
New names:
* `` -&gt; ...2
* `` -&gt; ...3
* `` -&gt; ...4
* `` -&gt; ...5
* `` -&gt; ...6
* … and 99 more problems
New names:
* `` -&gt; ...2
* `` -&gt; ...3
* `` -&gt; ...4
* `` -&gt; ...5
* `` -&gt; ...6
* … and 99 more problems
New names:
* `` -&gt; ...2
* `` -&gt; ...3
* `` -&gt; ...4
* `` -&gt; ...5
* `` -&gt; ...6
* … and 99 more problems
New names:
* `` -&gt; ...2
* `` -&gt; ...3
* `` -&gt; ...4
* `` -&gt; ...5
* `` -&gt; ...6
* … and 99 more problems
New names:
* `` -&gt; ...2
* `` -&gt; ...3
* `` -&gt; ...4
* `` -&gt; ...5
* `` -&gt; ...6
* … and 99 more problems
New names:
* `` -&gt; ...2
* `` -&gt; ...3
* `` -&gt; ...4
* `` -&gt; ...5
* `` -&gt; ...6
* … and 99 more problems
New names:
* `` -&gt; ...2
* `` -&gt; ...3
* `` -&gt; ...4
* `` -&gt; ...5
* `` -&gt; ...6
* … and 99 more problems
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Cleaned data v1 (all files) and shape:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 10 × 106</caption>
<thead>
<tr>
<th scope="col">country</th>
<th scope="col">kpi</th>
<th scope="col">scale</th>
<th scope="col">base_year</th>
<th scope="col">x2013</th>
<th scope="col">x2013q1</th>
<th scope="col">x2013m01</th>
<th scope="col">x2013m02</th>
<th scope="col">x2013m03</th>
<th scope="col">x2013q2</th>
<th scope="col">⋯</th>
<th scope="col">x2018m05</th>
<th scope="col">x2018m06</th>
<th scope="col">x2018q3</th>
<th scope="col">x2018m07</th>
<th scope="col">x2018m08</th>
<th scope="col">x2018m09</th>
<th scope="col">x2018q4</th>
<th scope="col">x2018m10</th>
<th scope="col">x2018m11</th>
<th scope="col">x2018m12</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">⋯</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Eswatini, Kingdom of</td>
<td>prices_consumer_price_index_all_items_index</td>
<td>Units    </td>
<td>2010=100</td>
<td>122.09040253117   </td>
<td>119.99946309364501</td>
<td>118.83976446277801</td>
<td>120.505386215811  </td>
<td>120.653238602345  </td>
<td>121.737608003397  </td>
<td>⋯</td>
<td>163.94451474232901</td>
<td>163.81407877331799</td>
<td>164.13674707866201</td>
<td>163.991001789319  </td>
<td>164.08477454748501</td>
<td>164.334464899181  </td>
<td>164.96166674413999</td>
<td>164.75101432130799</td>
<td>165.01966920170699</td>
<td>165.11431670940399</td>
</tr>
<tr>
<td>Germany             </td>
<td>labor_force_persons_number_of              </td>
<td>Thousands</td>
<td>NA      </td>
<td>44453.416666666701</td>
<td>44265             </td>
<td>44259             </td>
<td>44318             </td>
<td>44218             </td>
<td>44352.666666666701</td>
<td>⋯</td>
<td>46139             </td>
<td>46228             </td>
<td>NA                </td>
<td>46184             </td>
<td>46274             </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
</tr>
<tr>
<td>United Arab Emirates</td>
<td>prices_consumer_price_index_all_items_index</td>
<td>Units    </td>
<td>2010=100</td>
<td>102.663561221631  </td>
<td>102.03838610255001</td>
<td>102.097926590081  </td>
<td>101.95082656206201</td>
<td>102.066405155506  </td>
<td>102.31507425049   </td>
<td>⋯</td>
<td>116.71336508826001</td>
<td>117.15349274632401</td>
<td>116.971577834285  </td>
<td>117.094607503872  </td>
<td>117.264857792177  </td>
<td>116.55526820680601</td>
<td>115.65137520430901</td>
<td>115.99923245229201</td>
<td>115.65452337187899</td>
<td>115.300369788757  </td>
</tr>
<tr>
<td>Curaçao             </td>
<td>unemployment_persons_number_of             </td>
<td>Thousands</td>
<td>NA      </td>
<td>10                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>⋯</td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
</tr>
<tr>
<td>Russian Federation  </td>
<td>employment_persons_number_of               </td>
<td>Thousands</td>
<td>NA      </td>
<td>71391.666666666701</td>
<td>70900             </td>
<td>70700             </td>
<td>71000             </td>
<td>71000             </td>
<td>71400             </td>
<td>⋯</td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
</tr>
<tr>
<td>United Kingdom      </td>
<td>employment_persons_number_of               </td>
<td>Thousands</td>
<td>NA      </td>
<td>30050.568500000001</td>
<td>29777.089333333297</td>
<td>29771.93          </td>
<td>29750.279999999999</td>
<td>29809.058000000001</td>
<td>29872.7103333333  </td>
<td>⋯</td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
</tr>
<tr>
<td>Tanzania            </td>
<td>employment_persons_number_of               </td>
<td>Thousands</td>
<td>NA      </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>⋯</td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
</tr>
<tr>
<td>Mali                </td>
<td>employment_persons_number_of               </td>
<td>Thousands</td>
<td>NA      </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>⋯</td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
</tr>
<tr>
<td>New Zealand         </td>
<td>prices_consumer_price_index_all_items_index</td>
<td>Units    </td>
<td>2010=100</td>
<td>106.323136529614  </td>
<td>105.670575668258  </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>105.85059131603499</td>
<td>⋯</td>
<td>NA                </td>
<td>NA                </td>
<td>112.999462590446  </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>113.109813628132  </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
</tr>
<tr>
<td>Ethiopia            </td>
<td>prices_consumer_price_index_all_items_index</td>
<td>Units    </td>
<td>2010=100</td>
<td>178.75916348807201</td>
<td>171.74952788105901</td>
<td>170.689608653693  </td>
<td>171.74758279661   </td>
<td>172.81139219287201</td>
<td>175.606073211601  </td>
<td>⋯</td>
<td>278.91831824393802</td>
<td>284.54405927008997</td>
<td>288.59064492047997</td>
<td>285.72842580191099</td>
<td>288.39325049850902</td>
<td>291.65025846101798</td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
<td>NA                </td>
</tr>
</tbody>
</table>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

860,106</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All excel files are now parsed and appended to the financial_data dataframe. But the dataframe is still not easy to analyze. Every period has its own column. Period is a variable so it should only be one column. Hence, the dataframe must be unpivoted/melted/gathered. This can be done with the <a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a> function from tidyr. I also use the unique function to see which periods are included.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">cols</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">"country"</span><span class="p">,</span> <span class="s">"kpi"</span><span class="p">,</span> <span class="s">"scale"</span><span class="p">,</span> <span class="s">"base_year"</span><span class="p">)</span>
<span class="n">financial_data</span> <span class="o">&lt;-</span> <span class="n">financial_data</span> <span class="o">%&gt;%</span> <span class="nf">gather</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">"period"</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"value"</span><span class="p">,</span> <span class="o">-</span><span class="n">cols</span><span class="p">)</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Unique periods:"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">financial_data</span><span class="o">$</span><span class="n">period</span><span class="p">))</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Cleaned data v2 (all files) and shape:"</span><span class="p">)</span>
<span class="nf">sample_n</span><span class="p">(</span><span class="n">financial_data</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
<span class="nf">shape</span><span class="p">(</span><span class="n">financial_data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Unique periods:

  [1] "x2013"    "x2013q1"  "x2013m01" "x2013m02" "x2013m03" "x2013q2" 
  [7] "x2013m04" "x2013m05" "x2013m06" "x2013q3"  "x2013m07" "x2013m08"
 [13] "x2013m09" "x2013q4"  "x2013m10" "x2013m11" "x2013m12" "x2014"   
 [19] "x2014q1"  "x2014m01" "x2014m02" "x2014m03" "x2014q2"  "x2014m04"
 [25] "x2014m05" "x2014m06" "x2014q3"  "x2014m07" "x2014m08" "x2014m09"
 [31] "x2014q4"  "x2014m10" "x2014m11" "x2014m12" "x2015"    "x2015q1" 
 [37] "x2015m01" "x2015m02" "x2015m03" "x2015q2"  "x2015m04" "x2015m05"
 [43] "x2015m06" "x2015q3"  "x2015m07" "x2015m08" "x2015m09" "x2015q4" 
 [49] "x2015m10" "x2015m11" "x2015m12" "x2016"    "x2016q1"  "x2016m01"
 [55] "x2016m02" "x2016m03" "x2016q2"  "x2016m04" "x2016m05" "x2016m06"
 [61] "x2016q3"  "x2016m07" "x2016m08" "x2016m09" "x2016q4"  "x2016m10"
 [67] "x2016m11" "x2016m12" "x2017"    "x2017q1"  "x2017m01" "x2017m02"
 [73] "x2017m03" "x2017q2"  "x2017m04" "x2017m05" "x2017m06" "x2017q3" 
 [79] "x2017m07" "x2017m08" "x2017m09" "x2017q4"  "x2017m10" "x2017m11"
 [85] "x2017m12" "x2018"    "x2018q1"  "x2018m01" "x2018m02" "x2018m03"
 [91] "x2018q2"  "x2018m04" "x2018m05" "x2018m06" "x2018q3"  "x2018m07"
 [97] "x2018m08" "x2018m09" "x2018q4"  "x2018m10" "x2018m11" "x2018m12"


Cleaned data v2 (all files) and shape:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 10 × 6</caption>
<thead>
<tr>
<th scope="col">country</th>
<th scope="col">kpi</th>
<th scope="col">scale</th>
<th scope="col">base_year</th>
<th scope="col">period</th>
<th scope="col">value</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Slovak Republic                    </td>
<td>prices_consumer_price_index_all_items_index      </td>
<td>Units    </td>
<td>2010=100</td>
<td>x2016m03</td>
<td>108.032596041909  </td>
</tr>
<tr>
<td>Venezuela, Republica Bolivariana de</td>
<td>prices_consumer_price_index_all_items_index      </td>
<td>Units    </td>
<td>2010=100</td>
<td>x2016m02</td>
<td>1480.6272575103501</td>
</tr>
<tr>
<td>Tunisia                            </td>
<td>labor_markets_unemployment_rate_percent          </td>
<td>Units    </td>
<td>NA      </td>
<td>x2015m02</td>
<td>NA                </td>
</tr>
<tr>
<td>Italy                              </td>
<td>prices_producer_price_index_all_commodities_index</td>
<td>Units    </td>
<td>2010=100</td>
<td>x2015m09</td>
<td>103.77194507213601</td>
</tr>
<tr>
<td>Mongolia                           </td>
<td>labor_force_persons_number_of                    </td>
<td>Thousands</td>
<td>NA      </td>
<td>x2013m05</td>
<td>NA                </td>
</tr>
<tr>
<td>Moldova                            </td>
<td>labor_markets_unemployment_rate_percent          </td>
<td>Units    </td>
<td>NA      </td>
<td>x2014m04</td>
<td>NA                </td>
</tr>
<tr>
<td>Palau                              </td>
<td>prices_consumer_price_index_all_items_index      </td>
<td>Units    </td>
<td>2010=100</td>
<td>x2016q4 </td>
<td>117.204819277108  </td>
</tr>
<tr>
<td>South Africa                       </td>
<td>prices_consumer_price_index_all_items_index      </td>
<td>Units    </td>
<td>2010=100</td>
<td>x2014m09</td>
<td>126.091586794462  </td>
</tr>
<tr>
<td>Slovak Republic                    </td>
<td>prices_consumer_price_index_all_items_index      </td>
<td>Units    </td>
<td>2010=100</td>
<td>x2018m09</td>
<td>112.755695992017  </td>
</tr>
<tr>
<td>Japan                              </td>
<td>prices_producer_price_index_all_commodities_index</td>
<td>Units    </td>
<td>2010=100</td>
<td>x2018m09</td>
<td>NA                </td>
</tr>
</tbody>
</table>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

87720,6</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The periods include quarters (e.g. 2013q1), year (e.g. 2015) and months (e.g. 2018m06). There is one problem, ther is a 'x' in front of all rows in period column. This problem is caused by gather but is easily fixed with <a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a> from stringr.  I also set the value column to numeric and count the number of null values in the value column.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">financial_data</span> <span class="o">&lt;-</span> <span class="n">financial_data</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">period</span> <span class="o">=</span> <span class="nf">str_replace</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="s">"x"</span><span class="p">,</span> <span class="s">""</span><span class="p">))</span>
<span class="n">financial_data</span><span class="o">$</span><span class="n">value</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">financial_data</span><span class="o">$</span><span class="n">value</span><span class="p">)</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Control periods:"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">financial_data</span><span class="o">$</span><span class="n">period</span><span class="p">))</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Number of nulls in the value column:"</span><span class="p">)</span>
<span class="nf">sum</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">financial_data</span><span class="o">$</span><span class="n">value</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Control periods:

  [1] "2013"    "2013q1"  "2013m01" "2013m02" "2013m03" "2013q2"  "2013m04"
  [8] "2013m05" "2013m06" "2013q3"  "2013m07" "2013m08" "2013m09" "2013q4" 
 [15] "2013m10" "2013m11" "2013m12" "2014"    "2014q1"  "2014m01" "2014m02"
 [22] "2014m03" "2014q2"  "2014m04" "2014m05" "2014m06" "2014q3"  "2014m07"
 [29] "2014m08" "2014m09" "2014q4"  "2014m10" "2014m11" "2014m12" "2015"   
 [36] "2015q1"  "2015m01" "2015m02" "2015m03" "2015q2"  "2015m04" "2015m05"
 [43] "2015m06" "2015q3"  "2015m07" "2015m08" "2015m09" "2015q4"  "2015m10"
 [50] "2015m11" "2015m12" "2016"    "2016q1"  "2016m01" "2016m02" "2016m03"
 [57] "2016q2"  "2016m04" "2016m05" "2016m06" "2016q3"  "2016m07" "2016m08"
 [64] "2016m09" "2016q4"  "2016m10" "2016m11" "2016m12" "2017"    "2017q1" 
 [71] "2017m01" "2017m02" "2017m03" "2017q2"  "2017m04" "2017m05" "2017m06"
 [78] "2017q3"  "2017m07" "2017m08" "2017m09" "2017q4"  "2017m10" "2017m11"
 [85] "2017m12" "2018"    "2018q1"  "2018m01" "2018m02" "2018m03" "2018q2" 
 [92] "2018m04" "2018m05" "2018m06" "2018q3"  "2018m07" "2018m08" "2018m09"
 [99] "2018q4"  "2018m10" "2018m11" "2018m12"


Number of nulls in the value column:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
32141
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are 32141 rows with null values. One should always be careful when handling null values. But in this case, they are just in the way, so I will drop them and then control if there are any left.</p>
<p>The period column is not optimal, it would be nice if one easily could distinguish the time period. Also, it would be nice if year and period (month, quarter) were separate columns. This can be accomplished with the custom functions.</p>
<p>I do all the above operations based on the period column. Then I replace the old period column with the new column that specifies the current month/quarter. NaN is set if the data is yearly.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">columns</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">"country"</span><span class="p">,</span> <span class="s">"kpi"</span><span class="p">,</span> <span class="s">"value"</span><span class="p">)</span>
<span class="n">year</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">financial_data</span><span class="o">$</span><span class="n">period</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>

<span class="n">extract_time_period_value</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">if </span><span class="p">(</span><span class="nf">grepl</span><span class="p">(</span><span class="s">"q"</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">time_period</span> <span class="o">&lt;-</span> <span class="nf">str_sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="m">-1</span><span class="p">)</span>
  <span class="p">}</span> <span class="n">else</span> <span class="nf">if </span><span class="p">(</span><span class="nf">grepl</span><span class="p">(</span><span class="s">"m"</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">time_period</span> <span class="o">&lt;-</span> <span class="nf">str_sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="m">-2</span><span class="p">)</span>
  <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
    <span class="n">time_period</span> <span class="o">&lt;-</span> <span class="kc">NA</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">extract_time_period</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">if </span><span class="p">(</span><span class="nf">grepl</span><span class="p">(</span><span class="s">"q"</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">time_period</span> <span class="o">&lt;-</span> <span class="s">"quarter"</span>
  <span class="p">}</span> <span class="n">else</span> <span class="nf">if </span><span class="p">(</span><span class="nf">grepl</span><span class="p">(</span><span class="s">"m"</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">time_period</span> <span class="o">&lt;-</span> <span class="s">"month"</span>
  <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
    <span class="n">time_period</span> <span class="o">&lt;-</span> <span class="s">"year"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">period</span> <span class="o">&lt;-</span> <span class="nf">map_chr</span><span class="p">(</span><span class="n">financial_data</span><span class="o">$</span><span class="n">period</span><span class="p">,</span> <span class="n">extract_time_period_value</span><span class="p">)</span>
<span class="n">time_period</span> <span class="o">&lt;-</span> <span class="nf">map_chr</span><span class="p">(</span><span class="n">financial_data</span><span class="o">$</span><span class="n">period</span><span class="p">,</span> <span class="n">extract_time_period</span><span class="p">)</span>

<span class="n">financial_data</span> <span class="o">&lt;-</span> <span class="n">financial_data</span> <span class="o">%&gt;%</span>
  <span class="nf">select</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">add_column</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">.after</span><span class="o">=</span><span class="m">2</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">add_column</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">.after</span><span class="o">=</span><span class="m">3</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">add_column</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">.after</span><span class="o">=</span><span class="m">4</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">drop_na</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="n">financial_data</span><span class="o">$</span><span class="n">value</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">financial_data</span><span class="o">$</span><span class="n">value</span><span class="p">)</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Cleaned data v3 (all files):"</span><span class="p">)</span>
<span class="nf">sample_n</span><span class="p">(</span><span class="n">financial_data</span><span class="p">,</span><span class="m">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Cleaned data v3 (all files):

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 10 × 6</caption>
<thead>
<tr>
<th scope="col">country</th>
<th scope="col">kpi</th>
<th scope="col">year</th>
<th scope="col">period</th>
<th scope="col">time_period</th>
<th scope="col">value</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Latvia                </td>
<td>unemployment_persons_number_of                      </td>
<td>2018</td>
<td>08</td>
<td>month  </td>
<td>  71.00000</td>
</tr>
<tr>
<td>Iceland               </td>
<td>labor_force_persons_number_of                       </td>
<td>2015</td>
<td>NA</td>
<td>year   </td>
<td> 191.36667</td>
</tr>
<tr>
<td>Bosnia and Herzegovina</td>
<td>prices_producer_price_index_all_commodities_index   </td>
<td>2017</td>
<td>01</td>
<td>month  </td>
<td> 103.57303</td>
</tr>
<tr>
<td>Greece                </td>
<td>employment_persons_number_of                        </td>
<td>2015</td>
<td>09</td>
<td>month  </td>
<td>3634.55836</td>
</tr>
<tr>
<td>Montenegro            </td>
<td>labor_markets_unemployment_rate_percent             </td>
<td>2015</td>
<td>1 </td>
<td>quarter</td>
<td>  18.16065</td>
</tr>
<tr>
<td>Singapore             </td>
<td>financial_market_prices_equities_end_of_period_index</td>
<td>2015</td>
<td>01</td>
<td>month  </td>
<td> 114.76333</td>
</tr>
<tr>
<td>Israel                </td>
<td>economic_activity_industrial_production_index       </td>
<td>2016</td>
<td>1 </td>
<td>quarter</td>
<td> 112.43409</td>
</tr>
<tr>
<td>Vietnam               </td>
<td>prices_consumer_price_index_all_items_index         </td>
<td>2017</td>
<td>07</td>
<td>month  </td>
<td> 154.46347</td>
</tr>
<tr>
<td>Tunisia               </td>
<td>prices_producer_price_index_all_commodities_index   </td>
<td>2018</td>
<td>06</td>
<td>month  </td>
<td> 145.95121</td>
</tr>
<tr>
<td>Euro Area             </td>
<td>prices_producer_price_index_all_commodities_index   </td>
<td>2016</td>
<td>2 </td>
<td>quarter</td>
<td> 101.30793</td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now there are two steps left until the dataframe is tidy. First, the kpi column needs to be spread/pivoted. This because the kpi column contains multiple kpis and every kpi is a variable. For this, I will use the <a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a> function from tidyr.</p>
<p>Also, the dataframe contains three different time periods (year, month, quarter). The time periods need to be split into three separate dataframes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="3.-Merge-with-external-data">3. Merge with external data<a class="anchor-link" href="#3.-Merge-with-external-data">¶</a>
</h3>
<p>However, it would help the analysis if the dataframe contained more information about the country, for example, region. This link contains a csv with countries and their region. Let's look at the data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">region</span> <span class="o">&lt;-</span> <span class="nf">read_csv</span><span class="p">(</span><span class="s">"https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv"</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">clean_names</span><span class="p">()</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Regions:"</span><span class="p">)</span>
<span class="nf">sample_n</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Regions and sub-regions:"</span><span class="p">)</span>
<span class="n">region</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="s">"region"</span><span class="p">,</span> <span class="s">"sub_region"</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">distinct</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">arrange</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">sub_region</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>Parsed with column specification:
cols(
  name = <span class="ansi-red-fg">col_character()</span>,
  `alpha-2` = <span class="ansi-red-fg">col_character()</span>,
  `alpha-3` = <span class="ansi-red-fg">col_character()</span>,
  `country-code` = <span class="ansi-red-fg">col_character()</span>,
  `iso_3166-2` = <span class="ansi-red-fg">col_character()</span>,
  region = <span class="ansi-red-fg">col_character()</span>,
  `sub-region` = <span class="ansi-red-fg">col_character()</span>,
  `intermediate-region` = <span class="ansi-red-fg">col_character()</span>,
  `region-code` = <span class="ansi-red-fg">col_character()</span>,
  `sub-region-code` = <span class="ansi-red-fg">col_character()</span>,
  `intermediate-region-code` = <span class="ansi-red-fg">col_character()</span>
)
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Regions:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A spec_tbl_df: 10 × 11</caption>
<thead>
<tr>
<th scope="col">name</th>
<th scope="col">alpha_2</th>
<th scope="col">alpha_3</th>
<th scope="col">country_code</th>
<th scope="col">iso_3166_2</th>
<th scope="col">region</th>
<th scope="col">sub_region</th>
<th scope="col">intermediate_region</th>
<th scope="col">region_code</th>
<th scope="col">sub_region_code</th>
<th scope="col">intermediate_region_code</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cuba                                                </td>
<td>CU</td>
<td>CUB</td>
<td>192</td>
<td>ISO 3166-2:CU</td>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
<td>Caribbean      </td>
<td>019</td>
<td>419</td>
<td>029</td>
</tr>
<tr>
<td>Sudan                                               </td>
<td>SD</td>
<td>SDN</td>
<td>729</td>
<td>ISO 3166-2:SD</td>
<td>Africa  </td>
<td>Northern Africa                </td>
<td>NA             </td>
<td>002</td>
<td>015</td>
<td>NA </td>
</tr>
<tr>
<td>United Kingdom of Great Britain and Northern Ireland</td>
<td>GB</td>
<td>GBR</td>
<td>826</td>
<td>ISO 3166-2:GB</td>
<td>Europe  </td>
<td>Northern Europe                </td>
<td>NA             </td>
<td>150</td>
<td>154</td>
<td>NA </td>
</tr>
<tr>
<td>British Indian Ocean Territory                      </td>
<td>IO</td>
<td>IOT</td>
<td>086</td>
<td>ISO 3166-2:IO</td>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
<td>Eastern Africa </td>
<td>002</td>
<td>202</td>
<td>014</td>
</tr>
<tr>
<td>Lesotho                                             </td>
<td>LS</td>
<td>LSO</td>
<td>426</td>
<td>ISO 3166-2:LS</td>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
<td>Southern Africa</td>
<td>002</td>
<td>202</td>
<td>018</td>
</tr>
<tr>
<td>Sint Maarten (Dutch part)                           </td>
<td>SX</td>
<td>SXM</td>
<td>534</td>
<td>ISO 3166-2:SX</td>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
<td>Caribbean      </td>
<td>019</td>
<td>419</td>
<td>029</td>
</tr>
<tr>
<td>Paraguay                                            </td>
<td>PY</td>
<td>PRY</td>
<td>600</td>
<td>ISO 3166-2:PY</td>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
<td>South America  </td>
<td>019</td>
<td>419</td>
<td>005</td>
</tr>
<tr>
<td>Sao Tome and Principe                               </td>
<td>ST</td>
<td>STP</td>
<td>678</td>
<td>ISO 3166-2:ST</td>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
<td>Middle Africa  </td>
<td>002</td>
<td>202</td>
<td>017</td>
</tr>
<tr>
<td>Bonaire, Sint Eustatius and Saba                    </td>
<td>BQ</td>
<td>BES</td>
<td>535</td>
<td>ISO 3166-2:BQ</td>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
<td>Caribbean      </td>
<td>019</td>
<td>419</td>
<td>029</td>
</tr>
<tr>
<td>Dominica                                            </td>
<td>DM</td>
<td>DMA</td>
<td>212</td>
<td>ISO 3166-2:DM</td>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
<td>Caribbean      </td>
<td>019</td>
<td>419</td>
<td>029</td>
</tr>
</tbody>
</table>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Regions and sub-regions:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A spec_tbl_df: 18 × 2</caption>
<thead>
<tr>
<th scope="col">region</th>
<th scope="col">sub_region</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Africa  </td>
<td>Northern Africa                </td>
</tr>
<tr>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
</tr>
<tr>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
</tr>
<tr>
<td>Americas</td>
<td>Northern America               </td>
</tr>
<tr>
<td>Asia    </td>
<td>Central Asia                   </td>
</tr>
<tr>
<td>Asia    </td>
<td>Eastern Asia                   </td>
</tr>
<tr>
<td>Asia    </td>
<td>South-eastern Asia             </td>
</tr>
<tr>
<td>Asia    </td>
<td>Southern Asia                  </td>
</tr>
<tr>
<td>Asia    </td>
<td>Western Asia                   </td>
</tr>
<tr>
<td>Europe  </td>
<td>Eastern Europe                 </td>
</tr>
<tr>
<td>Europe  </td>
<td>Northern Europe                </td>
</tr>
<tr>
<td>Europe  </td>
<td>Southern Europe                </td>
</tr>
<tr>
<td>Europe  </td>
<td>Western Europe                 </td>
</tr>
<tr>
<td>Oceania </td>
<td>Australia and New Zealand      </td>
</tr>
<tr>
<td>Oceania </td>
<td>Melanesia                      </td>
</tr>
<tr>
<td>Oceania </td>
<td>Micronesia                     </td>
</tr>
<tr>
<td>Oceania </td>
<td>Polynesia                      </td>
</tr>
<tr>
<td>NA      </td>
<td>NA                             </td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are many columns, but I find the name, region and sub-region columns most interesting. The name column can be used as a key when joining with the financial_data dataframe. Optimal would have been if the original data had contained one of the other columns since it would have increased the likelihood for a perfect match. But I have to take what I have got and deal with it.</p>
<p>So, I filter the columns in the region dataframe and rename the name column to country. Then I use the <a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a> method from dplyr to join the financial_data and region dataframes using country as key. I create a new dataframe called financial_data2. This is a temporary dataframe, I will use it to see which countries in financial_data that do not have a match in the region dataframe.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">region</span> <span class="o">&lt;-</span> <span class="n">region</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"region"</span><span class="p">,</span> <span class="s">"sub_region"</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">rename</span><span class="p">(</span><span class="n">country</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Cleaned region data:"</span><span class="p">)</span>
<span class="nf">sample_n</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>

<span class="n">financial_data2</span> <span class="o">&lt;-</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">financial_data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">"country"</span><span class="p">))</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Countries with no match in region dataframe:"</span><span class="p">)</span>
<span class="n">financial_data2</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">filter_all</span><span class="p">(</span><span class="nf">any_vars</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">.)</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="nf">distinct</span><span class="p">()</span> <span class="o">%&gt;%</span> 
  <span class="nf">rownames_to_column</span><span class="p">(</span><span class="s">"index"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Cleaned region data:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A spec_tbl_df: 10 × 3</caption>
<thead>
<tr>
<th scope="col">country</th>
<th scope="col">region</th>
<th scope="col">sub_region</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Venezuela (Bolivarian Republic of)          </td>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
</tr>
<tr>
<td>Saint Helena, Ascension and Tristan da Cunha</td>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
</tr>
<tr>
<td>Congo                                       </td>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
</tr>
<tr>
<td>Ethiopia                                    </td>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
</tr>
<tr>
<td>Barbados                                    </td>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
</tr>
<tr>
<td>South Georgia and the South Sandwich Islands</td>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
</tr>
<tr>
<td>Equatorial Guinea                           </td>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
</tr>
<tr>
<td>Maldives                                    </td>
<td>Asia    </td>
<td>Southern Asia                  </td>
</tr>
<tr>
<td>Korea, Republic of                          </td>
<td>Asia    </td>
<td>Eastern Asia                   </td>
</tr>
<tr>
<td>Spain                                       </td>
<td>Europe  </td>
<td>Southern Europe                </td>
</tr>
</tbody>
</table>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Countries with no match in region dataframe:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 48 × 3</caption>
<thead>
<tr>
<th scope="col">index</th>
<th scope="col">country</th>
<th scope="col">region</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 </td>
<td>Afghanistan, Islamic Republic of                    </td>
<td>NA</td>
</tr>
<tr>
<td>2 </td>
<td>Armenia, Republic of                                </td>
<td>NA</td>
</tr>
<tr>
<td>3 </td>
<td>Azerbaijan, Republic of                             </td>
<td>NA</td>
</tr>
<tr>
<td>4 </td>
<td>Bahamas, The                                        </td>
<td>NA</td>
</tr>
<tr>
<td>5 </td>
<td>Bahrain, Kingdom of                                 </td>
<td>NA</td>
</tr>
<tr>
<td>6 </td>
<td>Bolivia                                             </td>
<td>NA</td>
</tr>
<tr>
<td>7 </td>
<td>China, P.R.: Hong Kong                              </td>
<td>NA</td>
</tr>
<tr>
<td>8 </td>
<td>China, P.R.: Macao                                  </td>
<td>NA</td>
</tr>
<tr>
<td>9 </td>
<td>China, P.R.: Mainland                               </td>
<td>NA</td>
</tr>
<tr>
<td>10</td>
<td>Congo, Democratic Republic of                       </td>
<td>NA</td>
</tr>
<tr>
<td>11</td>
<td>Congo, Republic of                                  </td>
<td>NA</td>
</tr>
<tr>
<td>12</td>
<td>Czech Republic                                      </td>
<td>NA</td>
</tr>
<tr>
<td>13</td>
<td>Eswatini, Kingdom of                                </td>
<td>NA</td>
</tr>
<tr>
<td>14</td>
<td>French Territories: New Caledonia                   </td>
<td>NA</td>
</tr>
<tr>
<td>15</td>
<td>Gambia, The                                         </td>
<td>NA</td>
</tr>
<tr>
<td>16</td>
<td>Iran, Islamic Republic of                           </td>
<td>NA</td>
</tr>
<tr>
<td>17</td>
<td>Kosovo, Republic of                                 </td>
<td>NA</td>
</tr>
<tr>
<td>18</td>
<td>Kyrgyz Republic                                     </td>
<td>NA</td>
</tr>
<tr>
<td>19</td>
<td>Macedonia, FYR                                      </td>
<td>NA</td>
</tr>
<tr>
<td>20</td>
<td>Micronesia, Federated States of                     </td>
<td>NA</td>
</tr>
<tr>
<td>21</td>
<td>Moldova                                             </td>
<td>NA</td>
</tr>
<tr>
<td>22</td>
<td>São Tomé and Príncipe                               </td>
<td>NA</td>
</tr>
<tr>
<td>23</td>
<td>Serbia, Republic of                                 </td>
<td>NA</td>
</tr>
<tr>
<td>24</td>
<td>Sint Maarten                                        </td>
<td>NA</td>
</tr>
<tr>
<td>25</td>
<td>Slovak Republic                                     </td>
<td>NA</td>
</tr>
<tr>
<td>26</td>
<td>St. Kitts and Nevis                                 </td>
<td>NA</td>
</tr>
<tr>
<td>27</td>
<td>St. Lucia                                           </td>
<td>NA</td>
</tr>
<tr>
<td>28</td>
<td>St. Vincent and the Grenadines                      </td>
<td>NA</td>
</tr>
<tr>
<td>29</td>
<td>Tanzania                                            </td>
<td>NA</td>
</tr>
<tr>
<td>30</td>
<td>Timor-Leste, Dem. Rep. of                           </td>
<td>NA</td>
</tr>
<tr>
<td>31</td>
<td>United Kingdom                                      </td>
<td>NA</td>
</tr>
<tr>
<td>32</td>
<td>United States                                       </td>
<td>NA</td>
</tr>
<tr>
<td>33</td>
<td>Venezuela, Republica Bolivariana de                 </td>
<td>NA</td>
</tr>
<tr>
<td>34</td>
<td>Vietnam                                             </td>
<td>NA</td>
</tr>
<tr>
<td>35</td>
<td>West Bank and Gaza                                  </td>
<td>NA</td>
</tr>
<tr>
<td>36</td>
<td>Yemen, Republic of                                  </td>
<td>NA</td>
</tr>
<tr>
<td>37</td>
<td>Advanced Economies                                  </td>
<td>NA</td>
</tr>
<tr>
<td>38</td>
<td>CIS                                                 </td>
<td>NA</td>
</tr>
<tr>
<td>39</td>
<td>Emerging and Developing Asia                        </td>
<td>NA</td>
</tr>
<tr>
<td>40</td>
<td>Emerging and Developing Countries                   </td>
<td>NA</td>
</tr>
<tr>
<td>41</td>
<td>Emerging and Developing Europe                      </td>
<td>NA</td>
</tr>
<tr>
<td>42</td>
<td>Europe                                              </td>
<td>NA</td>
</tr>
<tr>
<td>43</td>
<td>Middle East, North Africa, Afghanistan, and Pakistan</td>
<td>NA</td>
</tr>
<tr>
<td>44</td>
<td>Sub-Saharan Africa                                  </td>
<td>NA</td>
</tr>
<tr>
<td>45</td>
<td>Western Hemisphere                                  </td>
<td>NA</td>
</tr>
<tr>
<td>46</td>
<td>World                                               </td>
<td>NA</td>
</tr>
<tr>
<td>47</td>
<td>Euro Area                                           </td>
<td>NA</td>
</tr>
<tr>
<td>48</td>
<td>Netherlands Antilles                                </td>
<td>NA</td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are 48 "countries" that do not have a match. But, as can be seen above, the "countries" from index 37 to 47 are not countries. They are regions. These can be removed. This is done in the missing dataframe below.</p>
<p>Also, many of the countries in the financial_data dataframe that have no match in the region dataframe have longer names, often split by a comma, e.g. Bahamas, The. Therefore I create a new column in the missing dataframe called country2 where I split the country name on comma (,).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">missing</span> <span class="o">&lt;-</span> <span class="n">financial_data2</span> <span class="o">%&gt;%</span>
  <span class="nf">select</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">filter_all</span><span class="p">(</span><span class="nf">any_vars</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">.)</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="nf">distinct</span><span class="p">()</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="n">country</span><span class="p">)</span>
  
<span class="n">missing</span> <span class="o">&lt;-</span> <span class="n">missing</span> <span class="o">%&gt;%</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">missing</span> <span class="o">%&gt;%</span> <span class="nf">separate</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">"country2"</span><span class="p">),</span> <span class="s">","</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="nf">rownames_to_column</span><span class="p">(</span><span class="s">"index"</span><span class="p">)</span> 
<span class="n">missing</span><span class="o">$</span><span class="n">index</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">missing</span><span class="o">$</span><span class="n">index</span><span class="p">)</span>
  
<span class="n">missing</span> <span class="o">&lt;-</span> <span class="n">missing</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="m">37</span> <span class="o">|</span> <span class="n">index</span><span class="o">==</span><span class="m">48</span><span class="p">)</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Countries with no match v2:"</span><span class="p">)</span>
<span class="n">missing</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Countries with no match v2:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 37 × 3</caption>
<thead>
<tr>
<th scope="col">index</th>
<th scope="col">country</th>
<th scope="col">country2</th>
</tr>
<tr>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td> 1</td>
<td>Afghanistan, Islamic Republic of   </td>
<td>Afghanistan                      </td>
</tr>
<tr>
<td> 2</td>
<td>Armenia, Republic of               </td>
<td>Armenia                          </td>
</tr>
<tr>
<td> 3</td>
<td>Azerbaijan, Republic of            </td>
<td>Azerbaijan                       </td>
</tr>
<tr>
<td> 4</td>
<td>Bahamas, The                       </td>
<td>Bahamas                          </td>
</tr>
<tr>
<td> 5</td>
<td>Bahrain, Kingdom of                </td>
<td>Bahrain                          </td>
</tr>
<tr>
<td> 6</td>
<td>Bolivia                            </td>
<td>Bolivia                          </td>
</tr>
<tr>
<td> 7</td>
<td>China, P.R.: Hong Kong             </td>
<td>China                            </td>
</tr>
<tr>
<td> 8</td>
<td>China, P.R.: Macao                 </td>
<td>China                            </td>
</tr>
<tr>
<td> 9</td>
<td>China, P.R.: Mainland              </td>
<td>China                            </td>
</tr>
<tr>
<td>10</td>
<td>Congo, Democratic Republic of      </td>
<td>Congo                            </td>
</tr>
<tr>
<td>11</td>
<td>Congo, Republic of                 </td>
<td>Congo                            </td>
</tr>
<tr>
<td>12</td>
<td>Czech Republic                     </td>
<td>Czech Republic                   </td>
</tr>
<tr>
<td>13</td>
<td>Eswatini, Kingdom of               </td>
<td>Eswatini                         </td>
</tr>
<tr>
<td>14</td>
<td>French Territories: New Caledonia  </td>
<td>French Territories: New Caledonia</td>
</tr>
<tr>
<td>15</td>
<td>Gambia, The                        </td>
<td>Gambia                           </td>
</tr>
<tr>
<td>16</td>
<td>Iran, Islamic Republic of          </td>
<td>Iran                             </td>
</tr>
<tr>
<td>17</td>
<td>Kosovo, Republic of                </td>
<td>Kosovo                           </td>
</tr>
<tr>
<td>18</td>
<td>Kyrgyz Republic                    </td>
<td>Kyrgyz Republic                  </td>
</tr>
<tr>
<td>19</td>
<td>Macedonia, FYR                     </td>
<td>Macedonia                        </td>
</tr>
<tr>
<td>20</td>
<td>Micronesia, Federated States of    </td>
<td>Micronesia                       </td>
</tr>
<tr>
<td>21</td>
<td>Moldova                            </td>
<td>Moldova                          </td>
</tr>
<tr>
<td>22</td>
<td>São Tomé and Príncipe              </td>
<td>São Tomé and Príncipe            </td>
</tr>
<tr>
<td>23</td>
<td>Serbia, Republic of                </td>
<td>Serbia                           </td>
</tr>
<tr>
<td>24</td>
<td>Sint Maarten                       </td>
<td>Sint Maarten                     </td>
</tr>
<tr>
<td>25</td>
<td>Slovak Republic                    </td>
<td>Slovak Republic                  </td>
</tr>
<tr>
<td>26</td>
<td>St. Kitts and Nevis                </td>
<td>St. Kitts and Nevis              </td>
</tr>
<tr>
<td>27</td>
<td>St. Lucia                          </td>
<td>St. Lucia                        </td>
</tr>
<tr>
<td>28</td>
<td>St. Vincent and the Grenadines     </td>
<td>St. Vincent and the Grenadines   </td>
</tr>
<tr>
<td>29</td>
<td>Tanzania                           </td>
<td>Tanzania                         </td>
</tr>
<tr>
<td>30</td>
<td>Timor-Leste, Dem. Rep. of          </td>
<td>Timor-Leste                      </td>
</tr>
<tr>
<td>31</td>
<td>United Kingdom                     </td>
<td>United Kingdom                   </td>
</tr>
<tr>
<td>32</td>
<td>United States                      </td>
<td>United States                    </td>
</tr>
<tr>
<td>33</td>
<td>Venezuela, Republica Bolivariana de</td>
<td>Venezuela                        </td>
</tr>
<tr>
<td>34</td>
<td>Vietnam                            </td>
<td>Vietnam                          </td>
</tr>
<tr>
<td>35</td>
<td>West Bank and Gaza                 </td>
<td>West Bank and Gaza               </td>
</tr>
<tr>
<td>36</td>
<td>Yemen, Republic of                 </td>
<td>Yemen                            </td>
</tr>
<tr>
<td>48</td>
<td>Netherlands Antilles               </td>
<td>Netherlands Antilles             </td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now I probably will get a match on for example Afghanistan, but many of the countries in the missing dataframe did not have a comma, hence I will not find a match for them. To solve this problem I will use the <a href="https://www.rdocumentation.org/packages/base/versions/3.6.0/topics/agrep">agrep</a> function. This functions searches for approximate matches and returns a list of the best matches.</p>
<p>I map the result of agrep to a new column, country3, in the missing dataframe.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">matches</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">()</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="n">missing</span><span class="o">$</span><span class="n">country2</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">row</span> <span class="o">&lt;-</span> <span class="nf">agrep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="p">)</span><span class="n">[1]</span>
  <span class="n">matches</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">region</span><span class="o">$</span><span class="n">country[row]</span><span class="p">)</span>
<span class="p">}</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Matched countries:"</span><span class="p">)</span>
<span class="n">matches</span>

<span class="n">missing</span> <span class="o">&lt;-</span> <span class="n">missing</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">country3</span> <span class="o">=</span> <span class="n">matches</span><span class="p">)</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Countries with no match v3:"</span><span class="p">)</span>
<span class="n">missing</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Matched countries:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<ol class="list-inline">
<li>'Afghanistan'</li>
	<li>'Armenia'</li>
	<li>'Azerbaijan'</li>
	<li>'Bahamas'</li>
	<li>'Bahrain'</li>
	<li>'Bolivia (Plurinational State of)'</li>
	<li>'China'</li>
	<li>'China'</li>
	<li>'China'</li>
	<li>'Congo'</li>
	<li>'Congo'</li>
	<li>NA</li>
	<li>'Eswatini'</li>
	<li>NA</li>
	<li>'Gambia'</li>
	<li>'France'</li>
	<li>NA</li>
	<li>NA</li>
	<li>'North Macedonia'</li>
	<li>'Micronesia (Federated States of)'</li>
	<li>'Moldova, Republic of'</li>
	<li>'Sao Tome and Principe'</li>
	<li>'Serbia'</li>
	<li>'Sint Maarten (Dutch part)'</li>
	<li>NA</li>
	<li>'Saint Kitts and Nevis'</li>
	<li>NA</li>
	<li>'Saint Vincent and the Grenadines'</li>
	<li>'Tanzania, United Republic of'</li>
	<li>'Timor-Leste'</li>
	<li>'United Kingdom of Great Britain and Northern Ireland'</li>
	<li>'United States of America'</li>
	<li>'Venezuela (Bolivarian Republic of)'</li>
	<li>NA</li>
	<li>NA</li>
	<li>'Yemen'</li>
	<li>NA</li>
</ol>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Countries with no match v3:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 37 × 4</caption>
<thead>
<tr>
<th scope="col">index</th>
<th scope="col">country</th>
<th scope="col">country2</th>
<th scope="col">country3</th>
</tr>
<tr>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td> 1</td>
<td>Afghanistan, Islamic Republic of   </td>
<td>Afghanistan                      </td>
<td>Afghanistan                                         </td>
</tr>
<tr>
<td> 2</td>
<td>Armenia, Republic of               </td>
<td>Armenia                          </td>
<td>Armenia                                             </td>
</tr>
<tr>
<td> 3</td>
<td>Azerbaijan, Republic of            </td>
<td>Azerbaijan                       </td>
<td>Azerbaijan                                          </td>
</tr>
<tr>
<td> 4</td>
<td>Bahamas, The                       </td>
<td>Bahamas                          </td>
<td>Bahamas                                             </td>
</tr>
<tr>
<td> 5</td>
<td>Bahrain, Kingdom of                </td>
<td>Bahrain                          </td>
<td>Bahrain                                             </td>
</tr>
<tr>
<td> 6</td>
<td>Bolivia                            </td>
<td>Bolivia                          </td>
<td>Bolivia (Plurinational State of)                    </td>
</tr>
<tr>
<td> 7</td>
<td>China, P.R.: Hong Kong             </td>
<td>China                            </td>
<td>China                                               </td>
</tr>
<tr>
<td> 8</td>
<td>China, P.R.: Macao                 </td>
<td>China                            </td>
<td>China                                               </td>
</tr>
<tr>
<td> 9</td>
<td>China, P.R.: Mainland              </td>
<td>China                            </td>
<td>China                                               </td>
</tr>
<tr>
<td>10</td>
<td>Congo, Democratic Republic of      </td>
<td>Congo                            </td>
<td>Congo                                               </td>
</tr>
<tr>
<td>11</td>
<td>Congo, Republic of                 </td>
<td>Congo                            </td>
<td>Congo                                               </td>
</tr>
<tr>
<td>12</td>
<td>Czech Republic                     </td>
<td>Czech Republic                   </td>
<td>NA                                                  </td>
</tr>
<tr>
<td>13</td>
<td>Eswatini, Kingdom of               </td>
<td>Eswatini                         </td>
<td>Eswatini                                            </td>
</tr>
<tr>
<td>14</td>
<td>French Territories: New Caledonia  </td>
<td>French Territories: New Caledonia</td>
<td>NA                                                  </td>
</tr>
<tr>
<td>15</td>
<td>Gambia, The                        </td>
<td>Gambia                           </td>
<td>Gambia                                              </td>
</tr>
<tr>
<td>16</td>
<td>Iran, Islamic Republic of          </td>
<td>Iran                             </td>
<td>France                                              </td>
</tr>
<tr>
<td>17</td>
<td>Kosovo, Republic of                </td>
<td>Kosovo                           </td>
<td>NA                                                  </td>
</tr>
<tr>
<td>18</td>
<td>Kyrgyz Republic                    </td>
<td>Kyrgyz Republic                  </td>
<td>NA                                                  </td>
</tr>
<tr>
<td>19</td>
<td>Macedonia, FYR                     </td>
<td>Macedonia                        </td>
<td>North Macedonia                                     </td>
</tr>
<tr>
<td>20</td>
<td>Micronesia, Federated States of    </td>
<td>Micronesia                       </td>
<td>Micronesia (Federated States of)                    </td>
</tr>
<tr>
<td>21</td>
<td>Moldova                            </td>
<td>Moldova                          </td>
<td>Moldova, Republic of                                </td>
</tr>
<tr>
<td>22</td>
<td>São Tomé and Príncipe              </td>
<td>São Tomé and Príncipe            </td>
<td>Sao Tome and Principe                               </td>
</tr>
<tr>
<td>23</td>
<td>Serbia, Republic of                </td>
<td>Serbia                           </td>
<td>Serbia                                              </td>
</tr>
<tr>
<td>24</td>
<td>Sint Maarten                       </td>
<td>Sint Maarten                     </td>
<td>Sint Maarten (Dutch part)                           </td>
</tr>
<tr>
<td>25</td>
<td>Slovak Republic                    </td>
<td>Slovak Republic                  </td>
<td>NA                                                  </td>
</tr>
<tr>
<td>26</td>
<td>St. Kitts and Nevis                </td>
<td>St. Kitts and Nevis              </td>
<td>Saint Kitts and Nevis                               </td>
</tr>
<tr>
<td>27</td>
<td>St. Lucia                          </td>
<td>St. Lucia                        </td>
<td>NA                                                  </td>
</tr>
<tr>
<td>28</td>
<td>St. Vincent and the Grenadines     </td>
<td>St. Vincent and the Grenadines   </td>
<td>Saint Vincent and the Grenadines                    </td>
</tr>
<tr>
<td>29</td>
<td>Tanzania                           </td>
<td>Tanzania                         </td>
<td>Tanzania, United Republic of                        </td>
</tr>
<tr>
<td>30</td>
<td>Timor-Leste, Dem. Rep. of          </td>
<td>Timor-Leste                      </td>
<td>Timor-Leste                                         </td>
</tr>
<tr>
<td>31</td>
<td>United Kingdom                     </td>
<td>United Kingdom                   </td>
<td>United Kingdom of Great Britain and Northern Ireland</td>
</tr>
<tr>
<td>32</td>
<td>United States                      </td>
<td>United States                    </td>
<td>United States of America                            </td>
</tr>
<tr>
<td>33</td>
<td>Venezuela, Republica Bolivariana de</td>
<td>Venezuela                        </td>
<td>Venezuela (Bolivarian Republic of)                  </td>
</tr>
<tr>
<td>34</td>
<td>Vietnam                            </td>
<td>Vietnam                          </td>
<td>NA                                                  </td>
</tr>
<tr>
<td>35</td>
<td>West Bank and Gaza                 </td>
<td>West Bank and Gaza               </td>
<td>NA                                                  </td>
</tr>
<tr>
<td>36</td>
<td>Yemen, Republic of                 </td>
<td>Yemen                            </td>
<td>Yemen                                               </td>
</tr>
<tr>
<td>48</td>
<td>Netherlands Antilles               </td>
<td>Netherlands Antilles             </td>
<td>NA                                                  </td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now it looks pretty good. But it is not perfect. There are some NA's and one error (Iran is not the same as France). I set the errors to NA. Then I create a new dataframe called corrected which contains all corrected countries. I then overwrite the missing dataframe with the countries that do have NaN in the country3 column.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">missing[16</span><span class="p">,</span> <span class="m">4</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="kc">NA</span> <span class="c1">#Iran</span>
<span class="n">corrected</span> <span class="o">&lt;-</span> <span class="nf">drop_na</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
<span class="n">missing</span> <span class="o">&lt;-</span> <span class="n">missing</span> <span class="o">%&gt;%</span>  <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">country3</span><span class="p">))</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Corrected:"</span><span class="p">)</span>
<span class="n">corrected</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Countries with no match v4:"</span><span class="p">)</span>
<span class="n">missing</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Corrected:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 27 × 4</caption>
<thead>
<tr>
<th scope="col">index</th>
<th scope="col">country</th>
<th scope="col">country2</th>
<th scope="col">country3</th>
</tr>
<tr>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td> 1</td>
<td>Afghanistan, Islamic Republic of   </td>
<td>Afghanistan                   </td>
<td>Afghanistan                                         </td>
</tr>
<tr>
<td> 2</td>
<td>Armenia, Republic of               </td>
<td>Armenia                       </td>
<td>Armenia                                             </td>
</tr>
<tr>
<td> 3</td>
<td>Azerbaijan, Republic of            </td>
<td>Azerbaijan                    </td>
<td>Azerbaijan                                          </td>
</tr>
<tr>
<td> 4</td>
<td>Bahamas, The                       </td>
<td>Bahamas                       </td>
<td>Bahamas                                             </td>
</tr>
<tr>
<td> 5</td>
<td>Bahrain, Kingdom of                </td>
<td>Bahrain                       </td>
<td>Bahrain                                             </td>
</tr>
<tr>
<td> 6</td>
<td>Bolivia                            </td>
<td>Bolivia                       </td>
<td>Bolivia (Plurinational State of)                    </td>
</tr>
<tr>
<td> 7</td>
<td>China, P.R.: Hong Kong             </td>
<td>China                         </td>
<td>China                                               </td>
</tr>
<tr>
<td> 8</td>
<td>China, P.R.: Macao                 </td>
<td>China                         </td>
<td>China                                               </td>
</tr>
<tr>
<td> 9</td>
<td>China, P.R.: Mainland              </td>
<td>China                         </td>
<td>China                                               </td>
</tr>
<tr>
<td>10</td>
<td>Congo, Democratic Republic of      </td>
<td>Congo                         </td>
<td>Congo                                               </td>
</tr>
<tr>
<td>11</td>
<td>Congo, Republic of                 </td>
<td>Congo                         </td>
<td>Congo                                               </td>
</tr>
<tr>
<td>13</td>
<td>Eswatini, Kingdom of               </td>
<td>Eswatini                      </td>
<td>Eswatini                                            </td>
</tr>
<tr>
<td>15</td>
<td>Gambia, The                        </td>
<td>Gambia                        </td>
<td>Gambia                                              </td>
</tr>
<tr>
<td>19</td>
<td>Macedonia, FYR                     </td>
<td>Macedonia                     </td>
<td>North Macedonia                                     </td>
</tr>
<tr>
<td>20</td>
<td>Micronesia, Federated States of    </td>
<td>Micronesia                    </td>
<td>Micronesia (Federated States of)                    </td>
</tr>
<tr>
<td>21</td>
<td>Moldova                            </td>
<td>Moldova                       </td>
<td>Moldova, Republic of                                </td>
</tr>
<tr>
<td>22</td>
<td>São Tomé and Príncipe              </td>
<td>São Tomé and Príncipe         </td>
<td>Sao Tome and Principe                               </td>
</tr>
<tr>
<td>23</td>
<td>Serbia, Republic of                </td>
<td>Serbia                        </td>
<td>Serbia                                              </td>
</tr>
<tr>
<td>24</td>
<td>Sint Maarten                       </td>
<td>Sint Maarten                  </td>
<td>Sint Maarten (Dutch part)                           </td>
</tr>
<tr>
<td>26</td>
<td>St. Kitts and Nevis                </td>
<td>St. Kitts and Nevis           </td>
<td>Saint Kitts and Nevis                               </td>
</tr>
<tr>
<td>28</td>
<td>St. Vincent and the Grenadines     </td>
<td>St. Vincent and the Grenadines</td>
<td>Saint Vincent and the Grenadines                    </td>
</tr>
<tr>
<td>29</td>
<td>Tanzania                           </td>
<td>Tanzania                      </td>
<td>Tanzania, United Republic of                        </td>
</tr>
<tr>
<td>30</td>
<td>Timor-Leste, Dem. Rep. of          </td>
<td>Timor-Leste                   </td>
<td>Timor-Leste                                         </td>
</tr>
<tr>
<td>31</td>
<td>United Kingdom                     </td>
<td>United Kingdom                </td>
<td>United Kingdom of Great Britain and Northern Ireland</td>
</tr>
<tr>
<td>32</td>
<td>United States                      </td>
<td>United States                 </td>
<td>United States of America                            </td>
</tr>
<tr>
<td>33</td>
<td>Venezuela, Republica Bolivariana de</td>
<td>Venezuela                     </td>
<td>Venezuela (Bolivarian Republic of)                  </td>
</tr>
<tr>
<td>36</td>
<td>Yemen, Republic of                 </td>
<td>Yemen                         </td>
<td>Yemen                                               </td>
</tr>
</tbody>
</table>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Countries with no match v4:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 10 × 4</caption>
<thead>
<tr>
<th scope="col">index</th>
<th scope="col">country</th>
<th scope="col">country2</th>
<th scope="col">country3</th>
</tr>
<tr>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>12</td>
<td>Czech Republic                   </td>
<td>Czech Republic                   </td>
<td>NA</td>
</tr>
<tr>
<td>14</td>
<td>French Territories: New Caledonia</td>
<td>French Territories: New Caledonia</td>
<td>NA</td>
</tr>
<tr>
<td>16</td>
<td>Iran, Islamic Republic of        </td>
<td>Iran                             </td>
<td>NA</td>
</tr>
<tr>
<td>17</td>
<td>Kosovo, Republic of              </td>
<td>Kosovo                           </td>
<td>NA</td>
</tr>
<tr>
<td>18</td>
<td>Kyrgyz Republic                  </td>
<td>Kyrgyz Republic                  </td>
<td>NA</td>
</tr>
<tr>
<td>25</td>
<td>Slovak Republic                  </td>
<td>Slovak Republic                  </td>
<td>NA</td>
</tr>
<tr>
<td>27</td>
<td>St. Lucia                        </td>
<td>St. Lucia                        </td>
<td>NA</td>
</tr>
<tr>
<td>34</td>
<td>Vietnam                          </td>
<td>Vietnam                          </td>
<td>NA</td>
</tr>
<tr>
<td>35</td>
<td>West Bank and Gaza               </td>
<td>West Bank and Gaza               </td>
<td>NA</td>
</tr>
<tr>
<td>48</td>
<td>Netherlands Antilles             </td>
<td>Netherlands Antilles             </td>
<td>NA</td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are only 10 countries left. Below I try to find a match using the <a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a> function from stringr..  This functions works similarly to the LIKE keyword in SQL. I will only use the first 4 letters in the country2 column. The matches are stored in a character vector named matches. Then I replace the country3 column in the missing dataframe with this vector.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">matches</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">()</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="n">missing</span><span class="o">$</span><span class="n">country2</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">i_</span> <span class="o">&lt;-</span> <span class="nf">str_sub</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">)</span>
  <span class="n">row</span> <span class="o">&lt;-</span> <span class="nf">agrep</span><span class="p">(</span><span class="n">i_</span><span class="p">,</span> <span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="p">,)</span><span class="n">[1]</span>
  <span class="n">matches</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">region</span><span class="o">$</span><span class="n">country[row]</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">missing</span> <span class="o">&lt;-</span> <span class="n">missing</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">country3</span><span class="o">=</span><span class="n">matches</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">index</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">rownames_to_column</span><span class="p">(</span><span class="s">"index"</span><span class="p">)</span>
<span class="n">missing</span><span class="o">$</span><span class="n">index</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">missing</span><span class="o">$</span><span class="n">index</span><span class="p">)</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Countries with no match v5:"</span><span class="p">)</span>
<span class="n">missing</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Countries with no match v5:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 10 × 4</caption>
<thead>
<tr>
<th scope="col">index</th>
<th scope="col">country</th>
<th scope="col">country2</th>
<th scope="col">country3</th>
</tr>
<tr>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td> 1</td>
<td>Czech Republic                   </td>
<td>Czech Republic                   </td>
<td>Czechia            </td>
</tr>
<tr>
<td> 2</td>
<td>French Territories: New Caledonia</td>
<td>French Territories: New Caledonia</td>
<td>France             </td>
</tr>
<tr>
<td> 3</td>
<td>Iran, Islamic Republic of        </td>
<td>Iran                             </td>
<td>France             </td>
</tr>
<tr>
<td> 4</td>
<td>Kosovo, Republic of              </td>
<td>Kosovo                           </td>
<td>NA                 </td>
</tr>
<tr>
<td> 5</td>
<td>Kyrgyz Republic                  </td>
<td>Kyrgyz Republic                  </td>
<td>Kyrgyzstan         </td>
</tr>
<tr>
<td> 6</td>
<td>Slovak Republic                  </td>
<td>Slovak Republic                  </td>
<td>Slovakia           </td>
</tr>
<tr>
<td> 7</td>
<td>St. Lucia                        </td>
<td>St. Lucia                        </td>
<td>NA                 </td>
</tr>
<tr>
<td> 8</td>
<td>Vietnam                          </td>
<td>Vietnam                          </td>
<td>Viet Nam           </td>
</tr>
<tr>
<td> 9</td>
<td>West Bank and Gaza               </td>
<td>West Bank and Gaza               </td>
<td>Palestine, State of</td>
</tr>
<tr>
<td>10</td>
<td>Netherlands Antilles             </td>
<td>Netherlands Antilles             </td>
<td>Netherlands        </td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the output above it is visible that most countries find a correct match in the country3 column. However, French Territories: New Caledonia and Iran are not France and Netherlands Antilles is not Netherlands. Also, Kosovo and St. Lucia are NA.</p>
<p>I replace the errors with NA and move the correct rows to the corrected dataframe. Then I remove all rows in the missing dataframe except for the NA's.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">missing[2</span><span class="p">,</span> <span class="m">4</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="kc">NA</span>
<span class="n">missing[3</span><span class="p">,</span> <span class="m">4</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="kc">NA</span>
<span class="n">missing[10</span><span class="p">,</span> <span class="m">4</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="kc">NA</span>
<span class="n">corrected</span> <span class="o">&lt;-</span> <span class="n">corrected</span> <span class="o">%&gt;%</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="nf">drop_na</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">index</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">rownames_to_column</span><span class="p">(</span><span class="s">"index"</span><span class="p">)</span>
<span class="n">corrected</span><span class="o">$</span><span class="n">index</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">corrected</span><span class="o">$</span><span class="n">index</span><span class="p">)</span>
  
<span class="n">missing</span> <span class="o">&lt;-</span> <span class="n">missing</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">country3</span><span class="p">))</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Corrected v2:"</span><span class="p">)</span>
<span class="n">corrected</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Countries with no match v6:"</span><span class="p">)</span>
<span class="n">missing</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Corrected v2:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 32 × 4</caption>
<thead>
<tr>
<th scope="col">index</th>
<th scope="col">country</th>
<th scope="col">country2</th>
<th scope="col">country3</th>
</tr>
<tr>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td> 1</td>
<td>Afghanistan, Islamic Republic of   </td>
<td>Afghanistan                   </td>
<td>Afghanistan                                         </td>
</tr>
<tr>
<td> 2</td>
<td>Armenia, Republic of               </td>
<td>Armenia                       </td>
<td>Armenia                                             </td>
</tr>
<tr>
<td> 3</td>
<td>Azerbaijan, Republic of            </td>
<td>Azerbaijan                    </td>
<td>Azerbaijan                                          </td>
</tr>
<tr>
<td> 4</td>
<td>Bahamas, The                       </td>
<td>Bahamas                       </td>
<td>Bahamas                                             </td>
</tr>
<tr>
<td> 5</td>
<td>Bahrain, Kingdom of                </td>
<td>Bahrain                       </td>
<td>Bahrain                                             </td>
</tr>
<tr>
<td> 6</td>
<td>Bolivia                            </td>
<td>Bolivia                       </td>
<td>Bolivia (Plurinational State of)                    </td>
</tr>
<tr>
<td> 7</td>
<td>China, P.R.: Hong Kong             </td>
<td>China                         </td>
<td>China                                               </td>
</tr>
<tr>
<td> 8</td>
<td>China, P.R.: Macao                 </td>
<td>China                         </td>
<td>China                                               </td>
</tr>
<tr>
<td> 9</td>
<td>China, P.R.: Mainland              </td>
<td>China                         </td>
<td>China                                               </td>
</tr>
<tr>
<td>10</td>
<td>Congo, Democratic Republic of      </td>
<td>Congo                         </td>
<td>Congo                                               </td>
</tr>
<tr>
<td>11</td>
<td>Congo, Republic of                 </td>
<td>Congo                         </td>
<td>Congo                                               </td>
</tr>
<tr>
<td>12</td>
<td>Eswatini, Kingdom of               </td>
<td>Eswatini                      </td>
<td>Eswatini                                            </td>
</tr>
<tr>
<td>13</td>
<td>Gambia, The                        </td>
<td>Gambia                        </td>
<td>Gambia                                              </td>
</tr>
<tr>
<td>14</td>
<td>Macedonia, FYR                     </td>
<td>Macedonia                     </td>
<td>North Macedonia                                     </td>
</tr>
<tr>
<td>15</td>
<td>Micronesia, Federated States of    </td>
<td>Micronesia                    </td>
<td>Micronesia (Federated States of)                    </td>
</tr>
<tr>
<td>16</td>
<td>Moldova                            </td>
<td>Moldova                       </td>
<td>Moldova, Republic of                                </td>
</tr>
<tr>
<td>17</td>
<td>São Tomé and Príncipe              </td>
<td>São Tomé and Príncipe         </td>
<td>Sao Tome and Principe                               </td>
</tr>
<tr>
<td>18</td>
<td>Serbia, Republic of                </td>
<td>Serbia                        </td>
<td>Serbia                                              </td>
</tr>
<tr>
<td>19</td>
<td>Sint Maarten                       </td>
<td>Sint Maarten                  </td>
<td>Sint Maarten (Dutch part)                           </td>
</tr>
<tr>
<td>20</td>
<td>St. Kitts and Nevis                </td>
<td>St. Kitts and Nevis           </td>
<td>Saint Kitts and Nevis                               </td>
</tr>
<tr>
<td>21</td>
<td>St. Vincent and the Grenadines     </td>
<td>St. Vincent and the Grenadines</td>
<td>Saint Vincent and the Grenadines                    </td>
</tr>
<tr>
<td>22</td>
<td>Tanzania                           </td>
<td>Tanzania                      </td>
<td>Tanzania, United Republic of                        </td>
</tr>
<tr>
<td>23</td>
<td>Timor-Leste, Dem. Rep. of          </td>
<td>Timor-Leste                   </td>
<td>Timor-Leste                                         </td>
</tr>
<tr>
<td>24</td>
<td>United Kingdom                     </td>
<td>United Kingdom                </td>
<td>United Kingdom of Great Britain and Northern Ireland</td>
</tr>
<tr>
<td>25</td>
<td>United States                      </td>
<td>United States                 </td>
<td>United States of America                            </td>
</tr>
<tr>
<td>26</td>
<td>Venezuela, Republica Bolivariana de</td>
<td>Venezuela                     </td>
<td>Venezuela (Bolivarian Republic of)                  </td>
</tr>
<tr>
<td>27</td>
<td>Yemen, Republic of                 </td>
<td>Yemen                         </td>
<td>Yemen                                               </td>
</tr>
<tr>
<td>28</td>
<td>Czech Republic                     </td>
<td>Czech Republic                </td>
<td>Czechia                                             </td>
</tr>
<tr>
<td>29</td>
<td>Kyrgyz Republic                    </td>
<td>Kyrgyz Republic               </td>
<td>Kyrgyzstan                                          </td>
</tr>
<tr>
<td>30</td>
<td>Slovak Republic                    </td>
<td>Slovak Republic               </td>
<td>Slovakia                                            </td>
</tr>
<tr>
<td>31</td>
<td>Vietnam                            </td>
<td>Vietnam                       </td>
<td>Viet Nam                                            </td>
</tr>
<tr>
<td>32</td>
<td>West Bank and Gaza                 </td>
<td>West Bank and Gaza            </td>
<td>Palestine, State of                                 </td>
</tr>
</tbody>
</table>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Countries with no match v6:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 5 × 4</caption>
<thead>
<tr>
<th scope="col">index</th>
<th scope="col">country</th>
<th scope="col">country2</th>
<th scope="col">country3</th>
</tr>
<tr>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td> 2</td>
<td>French Territories: New Caledonia</td>
<td>French Territories: New Caledonia</td>
<td>NA</td>
</tr>
<tr>
<td> 3</td>
<td>Iran, Islamic Republic of        </td>
<td>Iran                             </td>
<td>NA</td>
</tr>
<tr>
<td> 4</td>
<td>Kosovo, Republic of              </td>
<td>Kosovo                           </td>
<td>NA</td>
</tr>
<tr>
<td> 7</td>
<td>St. Lucia                        </td>
<td>St. Lucia                        </td>
<td>NA</td>
</tr>
<tr>
<td>10</td>
<td>Netherlands Antilles             </td>
<td>Netherlands Antilles             </td>
<td>NA</td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Only 5 countries left! Now I will use agrep again, but instead of looping over all rows I will do one at a time.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="nf">catn</span><span class="p">(</span><span class="s">"New Caledonia"</span><span class="p">)</span>
<span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="nf">[agrep</span><span class="p">(</span><span class="s">"Caled"</span><span class="p">,</span> <span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="p">)</span><span class="n">]</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Iran"</span><span class="p">)</span>
<span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="nf">[agrep</span><span class="p">(</span><span class="s">"Iran"</span><span class="p">,</span> <span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="p">)</span><span class="n">]</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Kosovo"</span><span class="p">)</span>
<span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="nf">[agrep</span><span class="p">(</span><span class="s">"Kos"</span><span class="p">,</span> <span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="p">)</span><span class="n">]</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"St.Lucia"</span><span class="p">)</span>
<span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="nf">[agrep</span><span class="p">(</span><span class="s">"Luci"</span><span class="p">,</span> <span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="p">)</span><span class="n">]</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Antilles 1"</span><span class="p">)</span>
<span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="nf">[agrep</span><span class="p">(</span><span class="s">"Antill"</span><span class="p">,</span> <span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="p">)</span><span class="n">]</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Antilles 2"</span><span class="p">)</span>
<span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="nf">[agrep</span><span class="p">(</span><span class="s">"Cura"</span><span class="p">,</span> <span class="n">region</span><span class="o">$</span><span class="n">country</span><span class="p">)</span><span class="n">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

New Caledonia

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
'New Caledonia'
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Iran

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<ol class="list-inline">
<li>'France'</li>
	<li>'Iran (Islamic Republic of)'</li>
	<li>'Iraq'</li>
</ol>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Kosovo

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<ol class="list-inline">
<li>'Barbados'</li>
	<li>'Bosnia and Herzegovina'</li>
	<li>'Cocos (Keeling) Islands'</li>
	<li>'Comoros'</li>
	<li>'Costa Rica'</li>
	<li>'Hong Kong'</li>
	<li>'Korea (Democratic People\'s Republic of)'</li>
	<li>'Korea, Republic of'</li>
	<li>'Turks and Caicos Islands'</li>
</ol>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

St.Lucia

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
'Saint Lucia'
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Antilles 1

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Antilles 2

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<ol class="list-inline">
<li>'Cuba'</li>
	<li>'Curaçao'</li>
	<li>'Honduras'</li>
</ol>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are matches on all countries except Kosovo and Antilles 1. In antilles 2 I use Curacao since it is the  main island. For Kosovo I use Serbia as proxy. This is good alternative since I only use the country3 as a key to join the financial_data dataframe with the region dataframe.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">missing[1</span><span class="p">,</span> <span class="m">4</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="s">"New Caledonia"</span>
<span class="n">missing[2</span><span class="p">,</span> <span class="m">4</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="s">"Iran (Islamic Republic of)"</span>
<span class="n">missing[3</span><span class="p">,</span> <span class="m">4</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="s">"Serbia"</span>
<span class="n">missing[4</span><span class="p">,</span> <span class="m">4</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="s">"Saint Lucia"</span>
<span class="n">missing[5</span><span class="p">,</span> <span class="m">4</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="s">"Curaçao"</span>

<span class="n">corrected</span> <span class="o">&lt;-</span> <span class="n">corrected</span> <span class="o">%&gt;%</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="nf">drop_na</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">index</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">rownames_to_column</span><span class="p">(</span><span class="s">"index"</span><span class="p">)</span>
<span class="n">corrected</span><span class="o">$</span><span class="n">index</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">corrected</span><span class="o">$</span><span class="n">index</span><span class="p">)</span>

<span class="n">missing</span> <span class="o">&lt;-</span> <span class="n">missing</span> <span class="o">%&gt;%</span>  <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">country3</span><span class="p">))</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Corrected v3:"</span><span class="p">)</span>
<span class="n">corrected</span>
<span class="nf">catn</span><span class="p">(</span><span class="s">"Countries with no match v7:"</span><span class="p">)</span>
<span class="n">missing</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Corrected v3:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 37 × 4</caption>
<thead>
<tr>
<th scope="col">index</th>
<th scope="col">country</th>
<th scope="col">country2</th>
<th scope="col">country3</th>
</tr>
<tr>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td> 1</td>
<td>Afghanistan, Islamic Republic of   </td>
<td>Afghanistan                      </td>
<td>Afghanistan                                         </td>
</tr>
<tr>
<td> 2</td>
<td>Armenia, Republic of               </td>
<td>Armenia                          </td>
<td>Armenia                                             </td>
</tr>
<tr>
<td> 3</td>
<td>Azerbaijan, Republic of            </td>
<td>Azerbaijan                       </td>
<td>Azerbaijan                                          </td>
</tr>
<tr>
<td> 4</td>
<td>Bahamas, The                       </td>
<td>Bahamas                          </td>
<td>Bahamas                                             </td>
</tr>
<tr>
<td> 5</td>
<td>Bahrain, Kingdom of                </td>
<td>Bahrain                          </td>
<td>Bahrain                                             </td>
</tr>
<tr>
<td> 6</td>
<td>Bolivia                            </td>
<td>Bolivia                          </td>
<td>Bolivia (Plurinational State of)                    </td>
</tr>
<tr>
<td> 7</td>
<td>China, P.R.: Hong Kong             </td>
<td>China                            </td>
<td>China                                               </td>
</tr>
<tr>
<td> 8</td>
<td>China, P.R.: Macao                 </td>
<td>China                            </td>
<td>China                                               </td>
</tr>
<tr>
<td> 9</td>
<td>China, P.R.: Mainland              </td>
<td>China                            </td>
<td>China                                               </td>
</tr>
<tr>
<td>10</td>
<td>Congo, Democratic Republic of      </td>
<td>Congo                            </td>
<td>Congo                                               </td>
</tr>
<tr>
<td>11</td>
<td>Congo, Republic of                 </td>
<td>Congo                            </td>
<td>Congo                                               </td>
</tr>
<tr>
<td>12</td>
<td>Eswatini, Kingdom of               </td>
<td>Eswatini                         </td>
<td>Eswatini                                            </td>
</tr>
<tr>
<td>13</td>
<td>Gambia, The                        </td>
<td>Gambia                           </td>
<td>Gambia                                              </td>
</tr>
<tr>
<td>14</td>
<td>Macedonia, FYR                     </td>
<td>Macedonia                        </td>
<td>North Macedonia                                     </td>
</tr>
<tr>
<td>15</td>
<td>Micronesia, Federated States of    </td>
<td>Micronesia                       </td>
<td>Micronesia (Federated States of)                    </td>
</tr>
<tr>
<td>16</td>
<td>Moldova                            </td>
<td>Moldova                          </td>
<td>Moldova, Republic of                                </td>
</tr>
<tr>
<td>17</td>
<td>São Tomé and Príncipe              </td>
<td>São Tomé and Príncipe            </td>
<td>Sao Tome and Principe                               </td>
</tr>
<tr>
<td>18</td>
<td>Serbia, Republic of                </td>
<td>Serbia                           </td>
<td>Serbia                                              </td>
</tr>
<tr>
<td>19</td>
<td>Sint Maarten                       </td>
<td>Sint Maarten                     </td>
<td>Sint Maarten (Dutch part)                           </td>
</tr>
<tr>
<td>20</td>
<td>St. Kitts and Nevis                </td>
<td>St. Kitts and Nevis              </td>
<td>Saint Kitts and Nevis                               </td>
</tr>
<tr>
<td>21</td>
<td>St. Vincent and the Grenadines     </td>
<td>St. Vincent and the Grenadines   </td>
<td>Saint Vincent and the Grenadines                    </td>
</tr>
<tr>
<td>22</td>
<td>Tanzania                           </td>
<td>Tanzania                         </td>
<td>Tanzania, United Republic of                        </td>
</tr>
<tr>
<td>23</td>
<td>Timor-Leste, Dem. Rep. of          </td>
<td>Timor-Leste                      </td>
<td>Timor-Leste                                         </td>
</tr>
<tr>
<td>24</td>
<td>United Kingdom                     </td>
<td>United Kingdom                   </td>
<td>United Kingdom of Great Britain and Northern Ireland</td>
</tr>
<tr>
<td>25</td>
<td>United States                      </td>
<td>United States                    </td>
<td>United States of America                            </td>
</tr>
<tr>
<td>26</td>
<td>Venezuela, Republica Bolivariana de</td>
<td>Venezuela                        </td>
<td>Venezuela (Bolivarian Republic of)                  </td>
</tr>
<tr>
<td>27</td>
<td>Yemen, Republic of                 </td>
<td>Yemen                            </td>
<td>Yemen                                               </td>
</tr>
<tr>
<td>28</td>
<td>Czech Republic                     </td>
<td>Czech Republic                   </td>
<td>Czechia                                             </td>
</tr>
<tr>
<td>29</td>
<td>Kyrgyz Republic                    </td>
<td>Kyrgyz Republic                  </td>
<td>Kyrgyzstan                                          </td>
</tr>
<tr>
<td>30</td>
<td>Slovak Republic                    </td>
<td>Slovak Republic                  </td>
<td>Slovakia                                            </td>
</tr>
<tr>
<td>31</td>
<td>Vietnam                            </td>
<td>Vietnam                          </td>
<td>Viet Nam                                            </td>
</tr>
<tr>
<td>32</td>
<td>West Bank and Gaza                 </td>
<td>West Bank and Gaza               </td>
<td>Palestine, State of                                 </td>
</tr>
<tr>
<td>33</td>
<td>French Territories: New Caledonia  </td>
<td>French Territories: New Caledonia</td>
<td>New Caledonia                                       </td>
</tr>
<tr>
<td>34</td>
<td>Iran, Islamic Republic of          </td>
<td>Iran                             </td>
<td>Iran (Islamic Republic of)                          </td>
</tr>
<tr>
<td>35</td>
<td>Kosovo, Republic of                </td>
<td>Kosovo                           </td>
<td>Serbia                                              </td>
</tr>
<tr>
<td>36</td>
<td>St. Lucia                          </td>
<td>St. Lucia                        </td>
<td>Saint Lucia                                         </td>
</tr>
<tr>
<td>37</td>
<td>Netherlands Antilles               </td>
<td>Netherlands Antilles             </td>
<td>Curaçao                                             </td>
</tr>
</tbody>
</table>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Countries with no match v7:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 0 × 4</caption>
<thead>
<tr>
<th scope="col">index</th>
<th scope="col">country</th>
<th scope="col">country2</th>
<th scope="col">country3</th>
</tr>
<tr>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To get correct regions* in the region dataframe, I join the corrected dataframe with the region dataframe. I join country3 in corrected on country in region</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">corrected</span> <span class="o">&lt;-</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">corrected</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">"country3"</span> <span class="o">=</span> <span class="s">"country"</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">sub_region</span><span class="p">)</span>

<span class="n">region</span> <span class="o">&lt;-</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">corrected</span><span class="p">)</span>

<span class="nf">sample_n</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="m">20</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A spec_tbl_df: 20 × 3</caption>
<thead>
<tr>
<th scope="col">country</th>
<th scope="col">region</th>
<th scope="col">sub_region</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Palestine, State of       </td>
<td>Asia    </td>
<td>Western Asia                   </td>
</tr>
<tr>
<td>New Zealand               </td>
<td>Oceania </td>
<td>Australia and New Zealand      </td>
</tr>
<tr>
<td>Serbia, Republic of       </td>
<td>Europe  </td>
<td>Southern Europe                </td>
</tr>
<tr>
<td>Egypt                     </td>
<td>Africa  </td>
<td>Northern Africa                </td>
</tr>
<tr>
<td>United States             </td>
<td>Americas</td>
<td>Northern America               </td>
</tr>
<tr>
<td>Costa Rica                </td>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
</tr>
<tr>
<td>Eswatini                  </td>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
</tr>
<tr>
<td>Mozambique                </td>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
</tr>
<tr>
<td>Botswana                  </td>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
</tr>
<tr>
<td>Nauru                     </td>
<td>Oceania </td>
<td>Micronesia                     </td>
</tr>
<tr>
<td>Iran (Islamic Republic of)</td>
<td>Asia    </td>
<td>Southern Asia                  </td>
</tr>
<tr>
<td>Libya                     </td>
<td>Africa  </td>
<td>Northern Africa                </td>
</tr>
<tr>
<td>Kosovo, Republic of       </td>
<td>Europe  </td>
<td>Southern Europe                </td>
</tr>
<tr>
<td>Taiwan, Province of China </td>
<td>Asia    </td>
<td>Eastern Asia                   </td>
</tr>
<tr>
<td>Myanmar                   </td>
<td>Asia    </td>
<td>South-eastern Asia             </td>
</tr>
<tr>
<td>Afghanistan               </td>
<td>Asia    </td>
<td>Southern Asia                  </td>
</tr>
<tr>
<td>Cocos (Keeling) Islands   </td>
<td>Oceania </td>
<td>Australia and New Zealand      </td>
</tr>
<tr>
<td>Malaysia                  </td>
<td>Asia    </td>
<td>South-eastern Asia             </td>
</tr>
<tr>
<td>Armenia                   </td>
<td>Asia    </td>
<td>Western Asia                   </td>
</tr>
<tr>
<td>Denmark                   </td>
<td>Europe  </td>
<td>Northern Europe                </td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now the region dataframe is cleaned. I join the financial dataframe with the region dataframe. Then I control that there are no missing countries. As can be seen below there are none except for those regions we purposely left out.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">financial_data2</span> <span class="o">&lt;-</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">financial_data</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">"country"</span><span class="p">))</span>

<span class="nf">catn</span><span class="p">(</span><span class="s">"Countries with no match in region dataframe:"</span><span class="p">)</span>
<span class="n">financial_data2</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">filter_all</span><span class="p">(</span><span class="nf">any_vars</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">.)</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="nf">distinct</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>

Countries with no match in region dataframe:

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 11 × 2</caption>
<thead>
<tr>
<th scope="col">country</th>
<th scope="col">region</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Advanced Economies                                  </td>
<td>NA</td>
</tr>
<tr>
<td>CIS                                                 </td>
<td>NA</td>
</tr>
<tr>
<td>Emerging and Developing Asia                        </td>
<td>NA</td>
</tr>
<tr>
<td>Emerging and Developing Countries                   </td>
<td>NA</td>
</tr>
<tr>
<td>Emerging and Developing Europe                      </td>
<td>NA</td>
</tr>
<tr>
<td>Europe                                              </td>
<td>NA</td>
</tr>
<tr>
<td>Middle East, North Africa, Afghanistan, and Pakistan</td>
<td>NA</td>
</tr>
<tr>
<td>Sub-Saharan Africa                                  </td>
<td>NA</td>
</tr>
<tr>
<td>Western Hemisphere                                  </td>
<td>NA</td>
</tr>
<tr>
<td>World                                               </td>
<td>NA</td>
</tr>
<tr>
<td>Euro Area                                           </td>
<td>NA</td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now I need to spread the financial dataframe to get all the kpis in separate columns. I only use the time period month. Personally, I like to have a column that contains both year and period. Therefore I create a new column called year_period. This column is based on the year and month column. To do thies I use the <a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a> function from dplyr in combination with the <a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a> function from tidyr.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="n">imf</span> <span class="o">&lt;-</span> <span class="n">financial_data2</span> <span class="o">%&gt;%</span> <span class="nf">spread</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="n">kpi</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">filter</span><span class="p">(</span><span class="n">time_period</span> <span class="o">==</span> <span class="s">"month"</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">time_period</span><span class="p">)</span>
<span class="n">year_period</span> <span class="o">&lt;-</span> <span class="nf">pull</span><span class="p">(</span><span class="n">imf</span> <span class="o">%&gt;%</span> <span class="nf">unite</span><span class="p">(</span><span class="n">year_period</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">"-"</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="n">year_period</span><span class="p">))</span>


<span class="n">imf</span> <span class="o">&lt;-</span> <span class="n">imf</span> <span class="o">%&gt;%</span> <span class="nf">add_column</span><span class="p">(</span><span class="n">year_period</span><span class="p">,</span> <span class="n">.after</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">sample_n</span><span class="p">(</span><span class="n">imf</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table>
<caption>A tibble: 10 × 14</caption>
<thead>
<tr>
<th scope="col">country</th>
<th scope="col">year</th>
<th scope="col">period</th>
<th scope="col">year_period</th>
<th scope="col">region</th>
<th scope="col">sub_region</th>
<th scope="col">economic_activity_industrial_production_index</th>
<th scope="col">employment_persons_number_of</th>
<th scope="col">financial_market_prices_equities_end_of_period_index</th>
<th scope="col">labor_force_persons_number_of</th>
<th scope="col">labor_markets_unemployment_rate_percent</th>
<th scope="col">prices_consumer_price_index_all_items_index</th>
<th scope="col">prices_producer_price_index_all_commodities_index</th>
<th scope="col">unemployment_persons_number_of</th>
</tr>
<tr>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;chr&gt;</th>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;dbl&gt;</th>
<th scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Paraguay                        </td>
<td>2018</td>
<td>09</td>
<td>2018-09</td>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
<td>NA</td>
<td>NA</td>
<td>      NA</td>
<td>NA</td>
<td>NA</td>
<td>140.4316</td>
<td>      NA</td>
<td>  NA</td>
</tr>
<tr>
<td>Timor-Leste, Dem. Rep. of       </td>
<td>2016</td>
<td>03</td>
<td>2016-03</td>
<td>Asia    </td>
<td>South-eastern Asia             </td>
<td>NA</td>
<td>NA</td>
<td>      NA</td>
<td>NA</td>
<td>NA</td>
<td>141.1412</td>
<td>      NA</td>
<td>  NA</td>
</tr>
<tr>
<td>Curaçao                         </td>
<td>2015</td>
<td>03</td>
<td>2015-03</td>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
<td>NA</td>
<td>NA</td>
<td>      NA</td>
<td>NA</td>
<td>NA</td>
<td>107.0632</td>
<td>      NA</td>
<td>  NA</td>
</tr>
<tr>
<td>Suriname                        </td>
<td>2013</td>
<td>07</td>
<td>2013-07</td>
<td>Americas</td>
<td>Latin America and the Caribbean</td>
<td>NA</td>
<td>NA</td>
<td>      NA</td>
<td>NA</td>
<td>NA</td>
<td>126.6754</td>
<td>      NA</td>
<td>  NA</td>
</tr>
<tr>
<td>Cameroon                        </td>
<td>2015</td>
<td>02</td>
<td>2015-02</td>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
<td>NA</td>
<td>NA</td>
<td>      NA</td>
<td>NA</td>
<td>NA</td>
<td>111.8387</td>
<td>      NA</td>
<td>  NA</td>
</tr>
<tr>
<td>Armenia, Republic of            </td>
<td>2015</td>
<td>04</td>
<td>2015-04</td>
<td>Asia    </td>
<td>Western Asia                   </td>
<td>NA</td>
<td>NA</td>
<td>      NA</td>
<td>NA</td>
<td>NA</td>
<td>127.1319</td>
<td>134.4266</td>
<td>74.2</td>
</tr>
<tr>
<td>Slovak Republic                 </td>
<td>2018</td>
<td>12</td>
<td>2018-12</td>
<td>Europe  </td>
<td>Eastern Europe                 </td>
<td>NA</td>
<td>NA</td>
<td>      NA</td>
<td>NA</td>
<td>NA</td>
<td>112.6227</td>
<td>      NA</td>
<td>  NA</td>
</tr>
<tr>
<td>Burundi                         </td>
<td>2013</td>
<td>11</td>
<td>2013-11</td>
<td>Africa  </td>
<td>Sub-Saharan Africa             </td>
<td>NA</td>
<td>NA</td>
<td>      NA</td>
<td>NA</td>
<td>NA</td>
<td>141.7430</td>
<td>      NA</td>
<td>  NA</td>
</tr>
<tr>
<td>Lao People's Democratic Republic</td>
<td>2017</td>
<td>12</td>
<td>2017-12</td>
<td>Asia    </td>
<td>South-eastern Asia             </td>
<td>NA</td>
<td>NA</td>
<td>      NA</td>
<td>NA</td>
<td>NA</td>
<td>129.4961</td>
<td>      NA</td>
<td>  NA</td>
</tr>
<tr>
<td>Sri Lanka                       </td>
<td>2014</td>
<td>12</td>
<td>2014-12</td>
<td>Asia    </td>
<td>Southern Asia                  </td>
<td>NA</td>
<td>NA</td>
<td>109.9924</td>
<td>NA</td>
<td>NA</td>
<td>130.3358</td>
<td>      NA</td>
<td>  NA</td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now the dataframe is tidy. Now I need to save it.</p>
<h3 id="4.-Save-data">4. Save data<a class="anchor-link" href="#4.-Save-data">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="nf">write.csv</span><span class="p">(</span><span class="n">imf</span><span class="p">,</span> <span class="s">"imf_monthly_r.csv"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/dplyr/" rel="tag">dplyr</a></li>
            <li><a class="tag p-category" href="../../categories/r/" rel="tag">R</a></li>
            <li><a class="tag p-category" href="../../categories/tidyr/" rel="tag">tidyr</a></li>
            <li><a class="tag p-category" href="../../categories/tidyverse/" rel="tag">tidyverse</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../python-cleaning-excel-files-from-imf/" rel="prev" title="Python - Cleaning excel files from the International Monetary Fund">Previous post</a>
            </li>
        </ul></nav></aside><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script></article><!--End of body content--><footer id="footer">
            Contents © 2019         <a href="mailto:henric.sundberg@gmail.com">Henric Sundberg</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>          - Theme          <a href="https://bootswatch.com/yeti/" rel="nofollow">Yeti</a>
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script src="../../assets/js/moment-with-locales.min.js"></script><!-- fancy dates --><script>
        moment.locale("en");
        fancydates(2, "YYYY-MM-DD HH:mm");
        </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
