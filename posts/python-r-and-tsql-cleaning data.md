<!--
.. title: Python, R and TSQL comparison - Cleaning data
.. slug: python-r-tsql-comparison-cleaning-data
.. date: 2019-04-19 06:00:00 UTC
.. tags: Python, R, TSQL
.. category: 
.. link: 
.. description: 
.. type: text
.. updated: 2019-05-02 08:10:00 UTC
-->

This is the third and last part of a series of posts showing data wrangling code in Python, R and TSQL. This part show different options for cleaning data.
<!-- TEASER_END -->
The table below includes the methods that I use the most. However, each language have many more ways tho clean data. I list links below to some pages that have more information about them.

**Python**

* [Pandas homepage](https://pandas.pydata.org/)
* [Data wrangling cheat sheet pdf](https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf)

**R**

* [R studio guide to data wrangling](https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/)
* [Data wrangling cheat sheet pdf](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)
* [tidyr](https://tidyr.tidyverse.org/)
* [dplyr](https://dplyr.tidyverse.org/)
      
| Purpose                   | **Python**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | **R**                                                                                                                                                                                                                                                                                                                                                    | **TSQL**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| :------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Data**                  | <code>pip install gapminder<br>from gapminder import gapminder</code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>install.packages("gapminder")<br>library(gapminder)</code>                                                                                                                                                                                                                                                                                         | *the gapminder dataset is inserted into a<br>table called gapminder on a local MSSQL server.<br>This is done via the pandas method [to_sql](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_sql.html)*                                                                                                                                                                                                                                                                                                                                                                                 |
| **Filter**                | <code>gapminder.query("continent=='Asia' & year==1972")</code><br><br>or<br><br><code>gapminder[(gapminder["continent"]=="Asia") & (gapminder["year"]==1972)]<code><br><br>[query](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.query.html)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>gapminder %>%<br>&nbsp;&nbsp;filter(continent=="Asia", year==1972))</code><br><br>[filter](https://dplyr.tidyverse.org/reference/filter.html)                                                                                                                                                                                                      | <code>SELECT * FROM gapminder <br>WHERE continent='Asia'<br>AND year=1972<code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Sort**                  | <code>gapminder.sort_values(by=["year"], ascending=False)</code><br><br>[sort_values](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_values.html)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | <code>gapminder %>%<br>&nbsp;&nbsp;arrange(desc(year))</code><br><br>[arrange](https://dplyr.tidyverse.org/reference/arrange.html)                                                                                                                                                                                                                       | <code>SELECT * FROM gapminder<br>ORDER BY year DESC</code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Pivot, spread**         | <code>gapminder2 = gapminder[["country", "lifeExp", "year"]]<br><br>gapminder3 = pd.DataFrame(gapminder2.pivot(index="country", columns='year',<br>values="lifeExp").to_records())</code><br><br>or<br><br><code>pip install neat_panda<br>from neat_panda import spread<br><br>gapminder3 = spread(df=gapminder2, key="year", value="lifeExp")<code><br><br>[pivot](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pivot.html)<br>[spread](https://github.com/htp84/neat_panda)                                                                                                                                                                                                                                                                                                                                                                                                  | <code>gapminder3 <- gapminder %>%<br>&nbsp;&nbsp;select(country, lifeExp, year) %>%<br>&nbsp;&nbsp;spread(key=year, value=lifeExp)<code><br><br>[spread](https://tidyr.tidyverse.org/reference/spread.html)                                                                                                                                              | <code>SELECT country, [1952], [1957], [1962], [1967], [1972], [1977], [1982], [1987], [1992], [1997], [2002], [2007] FROM (<br>SELECT country, lifeExp, year FROM gapminder) AS gap<br>PIVOT<br>(<br>sum(lifeExp)<br>FOR year in ([1952], [1957], [1962], [1967],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1972], [1977], [1982], [1987],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1992], [1997], [2002], [2007])<br>) AS pvt<code><br><br>[PIVOT](https://docs.microsoft.com/en-us/sql/t-sql/queries/from-using-pivot-and-unpivot) |
| **Unpivot, melt, gather** | *gapminder3 is generated as above*<br><br><code>id_columns = ['country']<br>value_columns = ["1952", "1957", "1962", "1967", "1972", "1977", "1982", "1987", "1992", "1997", "2002", "2007"]<br><br>pd.melt(gapminder3, id_vars=id_columns,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_vars=value_columns,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var_name="year",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_name="lifeExp")&nbsp;</code><br><br>or<br><br><code>pip install neat_panda<br>from neat_panda import gather<br><br>gather(gapminder3, key="year",value="lifeExp",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;columns=["country"],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invert_columns=True)</code><br><br>[melt](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html)<br>[gather](https://github.com/htp84/neat_panda) | *gapminder3 is generated as above*<br><br><code>value_columns <- c("1952", "1957", "1962", "1967","1972", "1977","1982", "1987", "1992", "1997", "2002", "2007")<br>gather(gapminder3, value_columns, key="year",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value="lifeExp")<code><br><br>[gather](https://tidyr.tidyverse.org/reference/gather.html) | *the table gapminder_pvt is generated via the PIVOT above*<br><br><code>SELECT country, [year], lifeExp<br>FROM (<br>SELECT country, [1952], [1957], [1962], [1967], [1972], [1977],<br>[1982], [1987], [1992], [1997], [2002], [2007]<br>FROM gapminder_pvt) AS gap<br>UNPIVOT<br>(lifeExp FOR [year] IN ([1952], [1957], [1962], [1967], [1972], [1977],<br>[1982], [1987], [1992], [1997], [2002], [2007])<br>) AS unpvt<code><br><br>[UNPIVOT](https://docs.microsoft.com/en-us/sql/t-sql/queries/from-using-pivot-and-unpivot)                                                                                   |
| **Alter column**          | <code>gapminder["year"] = gapminder["year"] - 1<code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>gapminder <- mutate(year = year - 1) <code><br><br>[mutate](https://dplyr.tidyverse.org/reference/mutate.html)                                                                                                                                                                                                                                     | <code>SELECT country, continent, year - 1 AS year,<br>lifeExp, pop, gdpPercap FROM gapminder</code><br><br>*this do not alter the original table,<br>it only changes the returned output*                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Add column**            | <code>gapminder["gdp"] = gapminder["gdpPercap"] * gapminder["pop"]<code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>gapminder <- mutate(gdp = gdpPercap * pop)<code>                                                                                                                                                                                                                                                                                                   | <code>SELECT country, continent, year, lifeExp, pop, gdpPercap, pop * gdpPercap AS gdp<br>FROM gapminder</code><br><br>*this do not alter the original table,<br>it only changes the returned output*                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Group by**              | <code>aggregations = \{"pop" :\{"totalPop":"sum"\},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"lifeExp": \{"meanLifeExp": "mean"\}<br><br>gapminder.groupby(["year","continent"]).agg(aggregations)<br></code>*# returns a multiindex dataframe*<code><br><br>[groupby](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html)<br>[agg](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.agg.html)                                                                                                                                                                                                                                                                                                                                                                                      | <code>gapminder %>% <br>&nbsp;&nbsp;group_by(year, continent) %>% <br>&nbsp;&nbsp;summarise(totalPop = sum(as.numeric(pop)),<br>&nbsp;&nbsp;&nbsp;&nbsp;meanLifeExp = mean(lifeExp))<code><br><br>[group_by](https://dplyr.tidyverse.org/reference/group_by.html)<br>[summarise](https://dplyr.tidyverse.org/reference/summarise.html)                   | <code>SELECT continent, year, sum(pop) AS totalPop, avg(lifeExp) AS meanLifeExp<br>FROM gapminder<br>GROUP BY continent, year</code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
